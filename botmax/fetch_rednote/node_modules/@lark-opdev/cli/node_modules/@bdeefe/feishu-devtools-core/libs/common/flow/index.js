"use strict";var __awaiter=this&&this.__awaiter||function(t,e,o,a){return new(o||(o=Promise))((function(i,r){function n(t){try{l(a.next(t))}catch(t){r(t)}}function s(t){try{l(a.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(n,s)}l((a=a.apply(t,e||[])).next())}))},__importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});const path_1=__importDefault(require("path")),commonData_1=require("../../types/commonData"),Runner_1=__importDefault(require("./Runner")),mobileUtils_1=require("./help/mobileUtils"),h5Utils_1=require("./help/h5Utils"),blockUtils_1=require("./help/blockUtils"),initProject_1=__importDefault(require("./storage/initProject")),initBlock_1=__importDefault(require("./storage/initBlock")),get_1=require("./storage/get"),set_1=require("./storage/set"),protocol_1=require("../../types/protocol"),protocol_2=require("../../protocol"),functional_1=require("../../utils/functional"),initH5Offline_1=__importDefault(require("./storage/initH5Offline")),initH5InBlock_1=__importDefault(require("./storage/initH5InBlock")),sdk_1=require("../../modules/static/item/sdk"),noop=()=>{},sdkList=sdk_1.JSSDKDefault.map(({name:t})=>t);Runner_1.default.use(commonData_1.AppTypeEnum.Gadget,{isApp:mobileUtils_1.checkAppType,fetchSdkList(){return __awaiter(this,void 0,void 0,(function*(){try{const t=yield this.execute(protocol_1.ModuleName.static,protocol_2.StaticCmdEnum.GetItem,t=>sdkList.includes(t.name));return t?t.sort((t,e)=>-(0,functional_1.versionCompare)(t.name,e.name)).map(t=>({type:t.type,version:t.version,url:t.uri,larkVersion:t.meta.larkVersion})):Promise.resolve([])}catch(t){return Promise.resolve([])}}))},listCompilePaths(){const t=this.execute(protocol_1.ModuleName.storage,protocol_2.StorageCmdEnum.Get,"projects")||{};return Object.keys(t).map(e=>({compilePath:e,type:commonData_1.AppTypeEnum.Gadget,projectName:(0,mobileUtils_1.getProjectName)(e),lastOpen:t[e].lastOpen}))},getStorageKey:t=>"config"===t?"simulatorConfig":"projects",getHtmlName:()=>"simulator",initProjectData:initProject_1.default,getProjectData:get_1.getProjectData,setProjectData:(0,set_1.setFactory)(commonData_1.AppTypeEnum.Gadget),saveProject:set_1.saveProject}),Runner_1.default.use(commonData_1.AppTypeEnum.Block,{isApp:blockUtils_1.isBlock,fetchSdkList:noop,listCompilePaths(){const t=this.execute(protocol_1.ModuleName.storage,protocol_2.StorageCmdEnum.Get,"blocks");return Object.keys(t).map(e=>({compilePath:e,type:commonData_1.AppTypeEnum.Block,projectName:(0,mobileUtils_1.getProjectName)(e),lastOpen:t[e].lastOpen}))},getStorageKey:()=>"blocks",getHtmlName:()=>"",initProjectData:initBlock_1.default,getProjectData:get_1.getBlockData,setProjectData:(0,set_1.setFactory)(commonData_1.AppTypeEnum.Block),saveProject:set_1.saveBlock}),Runner_1.default.use(commonData_1.AppTypeEnum.H5,{isApp:h5Utils_1.isApp,fetchSdkList:noop,listCompilePaths:()=>[],getStorageKey:()=>commonData_1.AppTypeEnum.H5,getHtmlName:h5Utils_1.getHtmlName,initProjectData:noop,getProjectData:noop,setProjectData:noop,saveProject:noop}),Runner_1.default.use(commonData_1.AppTypeEnum.H5Offline,{isApp:h5Utils_1.isApp,fetchSdkList:noop,listCompilePaths(){const t=this.execute(protocol_1.ModuleName.storage,protocol_2.StorageCmdEnum.Get,"h5OfflineList")||{};return Object.keys(t).map(e=>({compilePath:e,type:commonData_1.AppTypeEnum.H5Offline,projectName:e.split(path_1.default.sep).pop()||"unknown projectName",lastOpen:t[e].lastOpen}))},getStorageKey:()=>"h5OfflineList",getHtmlName:h5Utils_1.getHtmlName,initProjectData:initH5Offline_1.default,getProjectData:get_1.getH5OfflineData,setProjectData:(0,set_1.setFactory)(commonData_1.AppTypeEnum.H5Offline),saveProject:set_1.saveH5Offline}),Runner_1.default.use(commonData_1.AppTypeEnum.H5InBlock,{isApp:blockUtils_1.isH5Block,fetchSdkList:noop,listCompilePaths(){const t=this.execute(protocol_1.ModuleName.storage,protocol_2.StorageCmdEnum.Get,"h5InBlockList")||{};return Object.keys(t).map(e=>({compilePath:e,type:commonData_1.AppTypeEnum.H5InBlock,projectName:e.split(path_1.default.sep).pop()||"unknown projectName",lastOpen:t[e].lastOpen}))},getStorageKey:()=>"h5InBlockList",getHtmlName:h5Utils_1.getHtmlName,initProjectData:initH5InBlock_1.default,getProjectData:get_1.getH5InBlockData,setProjectData:(0,set_1.setFactory)(commonData_1.AppTypeEnum.H5InBlock),saveProject:set_1.saveH5InBlock}),exports.default=Runner_1.default;