"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.OnEvent = exports.WithEventBus = void 0;
const tslib_1 = require("tslib");
const di_1 = require("@opensumi/di");
const ide_utils_1 = require("@opensumi/ide-utils");
const event_bus_types_1 = require("./event-bus-types");
const EVENT_TOKEN = Symbol('EVENT_TOKEN');
class WithEventBus extends ide_utils_1.Disposable {
    constructor(...args) {
        super(...args);
        const map = Reflect.getMetadata(EVENT_TOKEN, this) || new Map();
        for (const [key, Constructor] of map.entries()) {
            const dispose = this.eventBus.on(Constructor, (event) => this[key](event));
            this.addDispose(dispose);
        }
    }
}
tslib_1.__decorate([
    (0, di_1.Autowired)(event_bus_types_1.IEventBus),
    tslib_1.__metadata("design:type", Object)
], WithEventBus.prototype, "eventBus", void 0);
exports.WithEventBus = WithEventBus;
function OnEvent(Constructor) {
    return (target, key, descriptor) => {
        const map = Reflect.getMetadata(EVENT_TOKEN, target) || new Map();
        map.set(key, Constructor);
        Reflect.defineMetadata(EVENT_TOKEN, map, target);
    };
}
exports.OnEvent = OnEvent;
//# sourceMappingURL=event-decorator.js.map