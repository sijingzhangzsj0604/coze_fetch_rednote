"use strict";var __awaiter=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(r,o){function a(t){try{u(s.next(t))}catch(t){o(t)}}function n(t){try{u(s.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,n)}u((s=s.apply(t,e||[])).next())}))},__importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});const fs_extra_1=__importDefault(require("fs-extra")),tapable_1=require("tapable");class Generator{constructor({template:t,tempDir:e,projectPath:i,ui:s,plugins:r,lang:o,execute:a,environment:n,domain:u}){this.state={},this.absoluteProjectDir="",this.tempDir="",this._plugins=[],this.hooks={start:new tapable_1.AsyncSeriesHook(["generator"]),prompt:new tapable_1.AsyncSeriesHook(["generator","ui"]),render:new tapable_1.AsyncSeriesHook(["generator"]),output:new tapable_1.AsyncSeriesHook(["generator"]),afterOutput:new tapable_1.AsyncSeriesHook(["generator"])},this.template=t,this.tempDir=e,this.absoluteProjectDir=i,this.ui=s,this.lang=o,this.execute=a,this.environment=n,this.domain=u,this.addPlugins(r)}_applyPlugins(){this._plugins.forEach(t=>t.apply(this))}_output(){return __awaiter(this,void 0,void 0,(function*(){yield fs_extra_1.default.copy(this.tempDir,this.absoluteProjectDir),yield fs_extra_1.default.remove(this.tempDir)}))}run(){return __awaiter(this,void 0,void 0,(function*(){this._applyPlugins(),yield this.hooks.start.promise(this),yield this.hooks.prompt.promise(this,this.ui),yield this.hooks.render.promise(this),yield this.hooks.output.promise(this),yield this._output(),yield this.hooks.afterOutput.promise(this)}))}setState(t){this.state=Object.assign(Object.assign({},this.state),t)}getState(){return this.state}addPlugins(t){this._plugins.push(...t)}}exports.default=Generator;