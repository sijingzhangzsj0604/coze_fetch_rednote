import test from 'ava';
import { DEFAULT_ATTR_NAME } from '../action';
import { findElementWithAttributeByParents, getActionName, getActionNameByAttribute, getDomPath, isSupportsElementClosest, } from '../action/util';
var browserEnv = require('browser-env');
test.before(function () {
    browserEnv();
    // eslint-disable-next-line compat/compat
    document.body.innerHTML = "\n<div>\n  <span id=\"username\">username</span>\n  <button id=\"button\">button</button>\n  <input id=\"input\" />\n</div>";
});
test.serial('getDomPath', function (t) {
    t.is(getDomPath(document.getElementById('test')), undefined);
    t.is(getDomPath(document.getElementById('button')), 'BODY>DIV>BUTTON#button');
});
test.serial('isSupportsElementClosest should be true when closest in HTMLElement.prototype', function (t) {
    t.true(isSupportsElementClosest());
});
test('findElementWithAttributeByParents', function (t) {
    // eslint-disable-next-line compat/compat
    document.body.innerHTML = "\n<div>\n  <button id=\"button\" data-apm-action=\"button-action-name\">\n    <div>\n      <span id=\"button-span\">this is button-span</span>\n    </div>\n  </button>\n</div>";
    var button = document.getElementById('button');
    var buttonSpan = document.getElementById('button-span');
    t.deepEqual(button, findElementWithAttributeByParents(buttonSpan, 'data-apm-action'));
    t.falsy(findElementWithAttributeByParents(buttonSpan, 'data-apm-action', 1));
});
test('getActionNameByAttribute', function (t) {
    var actionName = 'button-action-name';
    var spanActionName = 'span-action-name';
    // eslint-disable-next-line compat/compat
    document.body.innerHTML = "\n<div>\n  <button id=\"button\" data-apm-action=\"" + actionName + "\">\n    <div id=\"button-div\">\n      <span id=\"button-span\">this is button-span</span>\n    </div>\n  </button>\n  <span id=\"span-lonely\">this is a lonely span</span>\n  <span id=\"span-attr\"  data-apm-action=\"" + spanActionName + "\">this is span with action name</span>\n</div>";
    var button = document.getElementById('button');
    var buttonDiv = document.getElementById('button-div');
    var buttonSpan = document.getElementById('button-span');
    var spanLonely = document.getElementById('span-lonely');
    var spanWithAttr = document.getElementById('span-attr');
    t.is(getActionNameByAttribute(button, DEFAULT_ATTR_NAME), actionName);
    t.is(getActionNameByAttribute(buttonDiv, DEFAULT_ATTR_NAME), actionName);
    t.is(getActionNameByAttribute(buttonSpan, DEFAULT_ATTR_NAME), actionName);
    t.is(getActionNameByAttribute(spanLonely, DEFAULT_ATTR_NAME), undefined);
    t.is(getActionNameByAttribute(spanWithAttr, DEFAULT_ATTR_NAME), spanActionName);
});
test('getActionName', function (t) {
    var actionName_1 = 'button-action-name_1';
    var actionName_3 = 'button-action-name_3';
    // eslint-disable-next-line compat/compat
    document.body.innerHTML = "\n<div>\n  <button id=\"button_1\" data-apm-action=\"" + actionName_1 + "\">\n    <div>\n      <span id=\"button-span_1\">this is button-span_1</span>\n    </div>\n  </button>\n  <button id=\"button_2\">\n      <span id=\"button-span_2\">this is button-span_2</span>\n  </button>\n  <button id=\"button_3\">\n      <span id=\"button-span_3\" data-apm-action=\"" + actionName_3 + "\">this is button-span_2</span>\n  </button>\n</div>";
    var span_1 = document.getElementById('button-span_1');
    var span_2 = document.getElementById('button-span_2');
    var span_3 = document.getElementById('button-span_3');
    // hack for current test
    span_2.innerText = span_2.innerHTML;
    t.is(getActionName(span_1, DEFAULT_ATTR_NAME), actionName_1);
    t.is(getActionName(span_2, DEFAULT_ATTR_NAME), 'this is button-span_2');
    t.is(getActionName(span_3, DEFAULT_ATTR_NAME), actionName_3);
});
//# sourceMappingURL=action.spec.js.map