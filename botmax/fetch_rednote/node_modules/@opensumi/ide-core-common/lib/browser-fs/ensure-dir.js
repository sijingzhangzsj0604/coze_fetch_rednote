"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ensureDir = void 0;
const tslib_1 = require("tslib");
const fs_1 = tslib_1.__importDefault(require("fs"));
const util_1 = require("./util");
const PATH_SEPARATOR = '/';
function fsExistsAsync(path) {
    return new Promise((resolve) => {
        fs_1.default.exists(path, (exists) => {
            resolve(exists);
        });
    });
}
class DefaultFsImpl {
    access(path) {
        return new Promise((resolve) => {
            fs_1.default.exists(path, (exists) => {
                resolve(exists);
            });
        });
    }
    mkdir(path) {
        return (0, util_1.promisify)(fs_1.default.mkdir)(path);
    }
}
const defaultFsImpl = new DefaultFsImpl();
async function ensureDir(path, fsLikeImpl = defaultFsImpl) {
    const pathList = (path.startsWith(PATH_SEPARATOR) ? path.slice(0) : path).split(PATH_SEPARATOR);
    let i = 0;
    while (i < pathList.length) {
        const targetPath = PATH_SEPARATOR + pathList.slice(0, i + 1).join(PATH_SEPARATOR);
        if (!(await fsLikeImpl.access(targetPath))) {
            await fsLikeImpl.mkdir(PATH_SEPARATOR + targetPath);
        }
        i = i + 1;
    }
}
exports.ensureDir = ensureDir;
//# sourceMappingURL=ensure-dir.js.map