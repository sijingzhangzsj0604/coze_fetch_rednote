"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const proxySchema_1=require("./proxySchema"),iframeTask_1=__importDefault(require("./iframeTask")),DATA_PROTOCOL="data:text/html,";function resolveUrl(e,t){if(void 0===t)return e;const r=JSON.stringify(t);if(0===e.indexOf(DATA_PROTOCOL)){const t=decodeURIComponent(e.slice(DATA_PROTOCOL.length));return"data:text/html,"+encodeURIComponent(t.replace("<head>",`<head><script>;window[${proxySchema_1.IframeQuery}] = JSON.parse(${r});<\/script>`))}{const t=new URL(e);return t.search+=(t.search?"&":"?")+`${proxySchema_1.IframeQuery}=${encodeURIComponent(r)}`,t.toString()}}function createIframe(e,t="body"){const r=document.createElement("iframe");return r.frameBorder="0",r.width="100%",r.height="100%",r.src=e,document.querySelector(t).appendChild(r),r}function init(e,t=!0){const r=acquireVsCodeApi(),a=createIframe(resolveUrl(e,r.getState())),o=a.contentWindow,n=new iframeTask_1.default(a,t);n.postMessge((0,proxySchema_1.sendCssVar)(document.querySelector("html").style.cssText)),window.addEventListener("message",e=>{if(e.source===o){if((0,proxySchema_1.isSetState)(e.data))return void r.setState(e.data.data);if((0,proxySchema_1.Console)(e.data))return;r.postMessage(e.data),t&&console.warn("iframe send data to extension",e.data)}else e.source!==window&&n.postMessge(e.data)})}exports.default=init;