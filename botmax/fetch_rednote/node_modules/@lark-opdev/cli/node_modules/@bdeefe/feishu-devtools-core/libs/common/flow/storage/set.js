"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.setFactory=exports.saveH5InBlock=exports.saveH5Offline=exports.saveBlock=exports.saveProject=void 0;const Runner_1=__importDefault(require("../Runner")),utils_1=require("../../../modules/storage/help/utils"),commonData_1=require("../../../types/commonData");function saveProject(e,t,o){const n=Runner_1.default.run(commonData_1.AppTypeEnum.Gadget,"getStorageKey","root");let a=Object.assign({},o.get(n)||{});if(t){const{appId:o,appData:n,simulatorConfig:s,accountInfo:r,devtoolConfig:c,blockUrl:l,editorConfig:u,lastOpen:p,panelConfig:i}=t,f=Object.assign({appData:n,appId:o,simulatorConfig:s,devtoolConfig:c,blockUrl:l,editorConfig:u,lastOpen:p,panelConfig:i},r?{accountInfo:r}:{}),m=Object.keys(a);a=m.reduce((t,o)=>(o!==e&&(t[o]=a[o]),t),{[e]:f})}else delete a[e];o.set(n,a)}function saveBlock(e,t,o){const n=Runner_1.default.run(commonData_1.AppTypeEnum.Block,"getStorageKey","root"),a=Object.assign({},o.get(n)||{});t?a[e]=t:delete a[e],o.set(n,a)}function saveH5Offline(e,t,o){const n=Runner_1.default.run(commonData_1.AppTypeEnum.H5Offline,"getStorageKey","root"),a=Object.assign({},o.get(n)||{});t?a[e]=t:delete a[e],o.set(n,a)}function saveH5InBlock(e,t,o){const n=Runner_1.default.run(commonData_1.AppTypeEnum.H5InBlock,"getStorageKey","root"),a=Object.assign({},o.get(n)||{});t?a[e]=t:delete a[e],o.set(n,a)}function setFactory(e){let t;switch(e){case commonData_1.AppTypeEnum.Gadget:t=saveProject;break;case commonData_1.AppTypeEnum.Block:t=saveBlock;break;case commonData_1.AppTypeEnum.H5Offline:t=saveH5Offline;break;case commonData_1.AppTypeEnum.H5InBlock:t=saveH5InBlock;break;default:t=()=>{}}return function(o,n,a,s){const r=s[Runner_1.default.run(e,"getStorageKey","root")][o];if(!r)return[];const c=(0,utils_1.diff)(a,r[n]);return r[n]=a,t(o,r,this),c}}exports.saveProject=saveProject,exports.saveBlock=saveBlock,exports.saveH5Offline=saveH5Offline,exports.saveH5InBlock=saveH5InBlock,exports.setFactory=setFactory;