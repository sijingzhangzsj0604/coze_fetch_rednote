"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.I18nNode = void 0;
const env_1 = __importDefault(require("@bdeefe/feishu-devtools-core/libs/config/env"));
const starling_intl_1 = require("@ies/starling_intl");
const index_1 = require("../common/index");
const en_US_json_1 = __importDefault(require("../locales/COMMON/en-US.json"));
const zh_CN_json_1 = __importDefault(require("../locales/COMMON/zh-CN.json"));
__exportStar(require("../common/index"), exports);
const resources = {
    'en-US': {
        translation: en_US_json_1.default,
    },
    'zh-CN': {
        translation: zh_CN_json_1.default,
    },
};
class I18nNode extends index_1.I18nBase {
    constructor(...args) {
        super(...args);
        // 通过监听 store 改变触发 lang 修改。保持 lang 统一
        index_1.i18nStore.onLangChange((lang) => {
            super.setLang(lang);
        });
    }
    static init({ isOversea = env_1.default.oversea, opt = {}, }) {
        const I18nOrigin = new starling_intl_1.I18nConstructor();
        const I18nOpts = Object.assign({ lng: index_1.i18nStore.getLang(), resources, thirdParamFallback: true }, opt);
        I18nOrigin.init(I18nOpts);
        const I18n = new I18nNode(I18nOrigin);
        if (isOversea) {
            const literalToReplace = new Map();
            // 这里有点 hack ，本质上还是需要在多语言时，保留品牌名 {brand} 切换
            literalToReplace.set(/飞书/g, ' Lark ');
            literalToReplace.set(/Feishu/g, 'Lark');
            I18n.setReplaceMap(literalToReplace);
        }
        return I18n;
    }
    setLang(lang) {
        return index_1.i18nStore.setLang(lang);
    }
    onLangChange(fn) {
        index_1.i18nStore.onLangChange(fn);
    }
}
exports.I18nNode = I18nNode;
let I18n;
(() => {
    if (!I18n) {
        I18n = I18nNode.init({});
    }
})();
exports.default = I18n;
