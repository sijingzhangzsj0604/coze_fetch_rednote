{"version":3,"file":"index.esm.js","sources":["../src/batch-sender.ts","../src/types.ts","../src/utils/misc.ts","../src/utils/is.ts","../src/utils/object-array.ts","../src/utils/basic.ts","../src/utils/string.ts","../src/utils/context.ts","../src/utils/hook-object.ts","../src/utils/logger.ts","../src/utils/number.ts","../src/utils/processor.ts","../src/utils/uuid.ts","../src/utils/time.ts","../src/utils/observable.ts","../src/client.ts","../src/plugins/context.ts","../src/plugins/command-array.ts","../src/plugins/logger.ts","../src/plugins/integration.ts","../src/plugins/subject.ts"],"sourcesContent":["import { EventSender, SdkTransport } from './types'\n\nexport type BatchEvent<E> = {\n  ev_type: 'batch'\n  list: E[]\n}\n\nexport type FailureCallbackType = (err: Error, data: string) => void\n\nexport type BatchSender<E> = EventSender<E> & {\n  fail?: (callback: FailureCallbackType) => void\n  getSize: () => number\n  getWait: () => number\n  setSize: (v: number) => void\n  setWait: (v: number) => void\n  getEndpoint: () => string\n  setEndpoint: (v: string) => void\n  flush: () => void\n  getBatchData: () => string\n  clear: () => void\n}\nexport interface BatchSenderConfig {\n  endpoint: string\n  transport: SdkTransport\n  size?: number\n  wait?: number\n}\n\nconst DEFAULT_SIZE = 10\nconst DEFAULT_WAIT = 1000\n\nexport const stringifyBatch = (list: any[]): string =>\n  JSON.stringify({\n    ev_type: 'batch',\n    list,\n  })\n\nexport function createBatchSender<E>(config: BatchSenderConfig): BatchSender<E> {\n  const { transport } = config\n  let { endpoint, size = DEFAULT_SIZE, wait = DEFAULT_WAIT } = config\n  let batch = [] as E[]\n  let tid = 0\n  let fail: FailureCallbackType | undefined\n  const sender = {\n    getSize() {\n      return size\n    },\n    getWait() {\n      return wait\n    },\n    setSize(v: number) {\n      size = v\n    },\n    setWait(v: number) {\n      wait = v\n    },\n    getEndpoint() {\n      return endpoint\n    },\n    setEndpoint(v: string) {\n      endpoint = v\n    },\n    send(e: E) {\n      batch.push(e)\n      if (batch.length >= size) {\n        sendBatch.call(this)\n      }\n      clearTimeout(tid)\n      tid = (setTimeout as Window['setTimeout'])(sendBatch.bind(this), wait)\n    },\n    flush() {\n      clearTimeout(tid)\n      sendBatch.call(this)\n    },\n    getBatchData() {\n      return batch.length ? stringifyBatch(batch) : ''\n    },\n    clear() {\n      clearTimeout(tid)\n      batch = []\n    },\n    fail(cb: FailureCallbackType) {\n      fail = cb\n    },\n  }\n\n  function sendBatch(this: BatchSender<E>) {\n    if (!batch.length) {\n      return\n    }\n    const data = this.getBatchData()\n    transport.post({\n      url: endpoint,\n      data,\n      fail(err: Error) {\n        fail && fail(err, data)\n      },\n    })\n    batch = []\n  }\n\n  return sender\n}\n","export type ReportEventFromClient<C extends AnyClient> = C extends { report: (e: infer R) => void } ? R : never\nexport type SendEventFromClient<C extends AnyClient> = C extends {\n  send: (e: infer R) => void\n}\n  ? R\n  : never\n\nexport interface ConfigManager<Config> {\n  setConfig: (c: Partial<Config>) => Config\n  getConfig: () => Config\n  onChange: (fn: () => void) => void\n  onReady: (fn: () => void) => void\n}\n\nexport interface Client<\n  ReportEvent,\n  SendEvent,\n  Builder extends EventBuilder<ReportEvent, SendEvent>,\n  Sender extends EventSender<SendEvent>,\n  InitConfig,\n  UserConfig,\n  Config,\n> {\n  getBuilder: () => Builder\n  getSender: () => Sender | undefined\n  getPreStartQueue: () => ReportEvent[]\n  /**\n   * passing InitConfig, can only be called once\n   * @param {InitConfig} c\n   */\n  init: (c: InitConfig) => void\n  /**\n   * update common config, can be called multiple times\n   * @param {Partial<UserConfig>} c\n   */\n  config: ConfigAgent<UserConfig, Config>\n  /**\n   * update internal SDKConfig directly without normalization\n   * @param {Partial<Config>} c\n   */\n  set: (c: Partial<Config>) => void\n  /**\n   * called when user finishes configuration and ready to send\n   */\n  start: () => void\n  /**\n   * to report any valid event\n   * @param {ReportEvent} e\n   */\n  report: (e: ReportEvent) => void\n  /**\n   * build the reported event into server-specific format\n   * @param {ReportEvent} e\n   */\n  build: (e: ReportEvent) => void\n  /**\n   * report event in server-specific format\n   * @param {SendEvent} e\n   */\n  send: (e: SendEvent) => void\n  destroy: () => void\n  on: EventToEventHandlerParams<ClientEvent<ReportEvent, SendEvent, Config>>\n  off: EventToEventHandlerParams<ClientEvent<ReportEvent, SendEvent, Config>>\n  /**\n   * mount any value onto the client with name, so as to extend the client APIs\n   * @param {string} name 挂载属性名\n   * @param {any} value 挂载属性值\n   */\n  provide: (k: string, v: any) => void\n}\nexport type AnyClient = Client<any, any, any, any, any, any, any>\nexport type ConfigNormalizer<UserConfig, Config> = (c: Partial<UserConfig>) => Partial<Config>\nexport type ConfigAgent<UserConfig, Config> = {\n  (c?: Partial<UserConfig>): Config | undefined\n}\n\nexport interface EventBuilder<ReportEvent, SendEvent> {\n  build: (d: ReportEvent) => SendEvent | Falsy\n}\n\nexport interface EventSender<SendEvent> {\n  send: (e: SendEvent) => void\n}\n\nexport const EVENTS = [\n  'init',\n  'start',\n  'config',\n  'beforeDestroy',\n  'provide',\n  'beforeReport',\n  'report',\n  'beforeBuild',\n  'build',\n  'beforeSend',\n  'send',\n  'beforeConfig',\n]\nexport interface ClientEvent<ReportEvent, SendEvent, Config> {\n  init: () => void\n  start: () => void\n  config: () => void\n  beforeConfig: Callback<Partial<Config>>\n  beforeDestroy: () => void\n  provide: Callback<string>\n  beforeReport: Processor<ReportEvent>\n  report: Processor<ReportEvent>\n  beforeBuild: Processor<ReportEvent>\n  build: Processor<SendEvent>\n  beforeSend: Processor<SendEvent>\n  send: Callback<SendEvent>\n}\n\nexport interface Processor<E> {\n  (e: E): E | Falsy\n}\n\nexport type Falsy = false | null | undefined\n\nexport interface SdkTransport {\n  get: (options: any) => void\n  post: (options: any) => void\n}\n\ninterface Callback<T> {\n  (arg: T): void\n}\n\nexport type UnionToIntersection<U> = (U extends any ? (k: U) => void : never) extends (k: infer I) => void ? I : never\n\nexport type EventToEventHandlerPair<Event extends ClientEvent<any, any, any>, T extends keyof Event> = T extends any\n  ? (ev: T, handler: Event[T]) => void\n  : never\ntype EventToEventHandlerParams<Event extends ClientEvent<any, any, any>> = UnionToIntersection<\n  EventToEventHandlerPair<Event, keyof Event>\n>\n\nexport type PartialRecursive<T> = T extends { [key: string]: any }\n  ? // eslint-disable-next-line @typescript-eslint/ban-types\n    T extends Function\n    ? T\n    : T extends any[]\n    ? T\n    : { [K in keyof T]?: PartialRecursive<T[K]> }\n  : T\n","export const noop = () => ({} as any)\n\nexport function id<T>(v: T): T {\n  return v\n}\n","// eslint-disable-next-line @typescript-eslint/ban-types\nexport function isObject(o: unknown): o is object {\n  return typeof o === 'object' && o !== null\n}\n\nexport function isInstanceOf(wat: any, base: any): boolean {\n  try {\n    return wat instanceof base\n  } catch (_e) {\n    return false\n  }\n}\n\nconst objProto = Object.prototype\nexport type PlainObject = Record<string | number | symbol, any>\n// https://stackoverflow.com/a/5878101\nexport function isPlainObject(o: unknown): o is PlainObject {\n  if (isObject(o)) {\n    if (typeof Object.getPrototypeOf === 'function') {\n      const proto = Object.getPrototypeOf(o)\n      return proto === objProto || proto === null\n    }\n\n    // cannot test, requires ES3\n    /* istanbul ignore next */\n    return objProto.toString.call(o) === '[object Object]'\n  }\n  return false\n}\n\nexport function isArray<T>(o: unknown): o is Array<T> {\n  return objProto.toString.call(o) === '[object Array]'\n}\n\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport function isFunction(o: unknown): o is Function {\n  return typeof o === 'function'\n}\n\nexport function isBoolean(o: unknown): o is boolean {\n  return typeof o === 'boolean'\n}\n\nexport function isNumber(o: unknown): o is number {\n  return typeof o === 'number'\n}\n\nexport function isString(o: unknown): o is string {\n  return typeof o === 'string'\n}\n\nexport function isEqual(a: any, b: any): boolean {\n  // special\n  if (isNumber(a) && isNaN(a)) {\n    return isNumber(b) && isNaN(b)\n  }\n  // same primitive or same object\n  if (a === b) {\n    return true\n  }\n\n  if (isObject(a)) {\n    if (isPlainObject(a)) {\n      return isPlainObject(b) && isEqualPlainObject(a, b)\n    } else if (isArray(a)) {\n      return isArray(b) && isEqualArray(a, b)\n      //TODO: handle TypedArray, Map, Set, ArrayLike\n    } else {\n      // different object\n      return false\n    }\n  }\n\n  // different primitive\n  return false\n}\nexport function isEqualPlainObject(a: PlainObject, b: PlainObject) {\n  for (const k in a) {\n    if (!isEqual(a[k], b[k])) {\n      return false\n    }\n  }\n  return true\n}\nexport function isEqualArray(a: any[], b: any[]) {\n  if (a.length !== b.length) {\n    return false\n  }\n  return a.every((v, i) => isEqual(v, b[i]))\n}\n\nexport function isError(wat: unknown): boolean {\n  switch (Object.prototype.toString.call(wat)) {\n    case '[object Error]':\n      return true\n    case '[object Exception]':\n      /* istanbul ignore next */\n      return true\n    case '[object DOMError]':\n      return true\n    case '[object DOMException]':\n      /* istanbul ignore next */\n      return true\n    default:\n      /* istanbul ignore next */\n      return wat instanceof Error\n  }\n}\n\nexport function isEvent(wat: any): boolean {\n  return typeof Event !== 'undefined' && isInstanceOf(wat, Event)\n}\n\nexport function isErrorEvent(what: unknown): what is ErrorEvent {\n  return Object.prototype.toString.call(what) === '[object ErrorEvent]'\n}\n\nexport function isPromiseRejectionEvent(what: unknown): what is PromiseRejectionEvent {\n  return Object.prototype.toString.call(what) === '[object PromiseRejectionEvent]'\n}\n","/* eslint-disable @typescript-eslint/prefer-optional-chain */\nimport { isArray, isFunction, isObject, isPlainObject } from './is'\n\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport function omit<T extends object, K extends (keyof T)[]>(\n  object: T,\n  ...keys: K\n): Pick<T, Exclude<keyof T, K[number]>> {\n  if (isObject(object)) {\n    const res = {} as Pick<T, Exclude<keyof T, K[number]>>\n    objectForIn(object, (k, v) => {\n      if (!arrayIncludes(keys, k)) {\n        res[k as any] = v\n      }\n    })\n    return res\n  }\n  return object\n}\n\nexport function hasKey<T>(object: T, key: string): boolean {\n  return Object.prototype.hasOwnProperty.call(object, key)\n}\n\nexport type ObjectForInCallback<O> = (index: keyof O, item: O[keyof O]) => void\nexport function objectForIn<O>(object: O, callback: ObjectForInCallback<O>) {\n  if (isObject(object)) {\n    for (const i in object) {\n      if (hasKey<typeof object>(object, i)) {\n        callback.call(null, i, object[i])\n      }\n    }\n  }\n}\n\nexport function filterObjectValueBy<T>(obj: Record<string, T>, p: (v: T) => boolean) {\n  if (!isObject(obj)) {\n    return obj\n  }\n\n  if (!isFunction(p)) {\n    return obj\n  }\n\n  const res = {} as Record<string, T>\n  objectForIn(obj, (key, value) => {\n    if (p(value)) {\n      res[key] = value\n    }\n  })\n\n  return res\n}\n\n// 把source对象中的内容深度赋给target, 数组覆盖\nexport function mergeDeepCopyArray<T>(...source: Partial<T>[]): T {\n  let result = {} as T\n  let k = 0\n  while (k < source.length) {\n    result = _mergeDeepCopyArray<T>(result, source[k++])\n  }\n\n  return result\n}\n\n// 把source对象中的内容深度赋给target, 数组合并\nexport function mergeDeepConcatArray<T>(...source: Partial<T>[]): T {\n  let result = {} as T\n  let k = 0\n  while (k < source.length) {\n    result = _mergeDeepMergeArray<T>(result, source[k++])\n  }\n\n  return result\n}\n\nfunction _mergeDeepCopyArray<T>(target: Partial<T>, source: Partial<T>): T {\n  const result: T = { ...target } as T\n  for (const key in source) {\n    if (hasKey(source, key) && source[key] !== undefined) {\n      if (isObject(source[key]) && isPlainObject(source[key])) {\n        result[key] = _mergeDeepCopyArray(isObject(target[key]) ? target[key]! : {}, source[key]!)\n      } else if (isArray(source[key])) {\n        result[key] = cloneArray(source[key] as unknown as unknown[]) as unknown as T[Extract<keyof T, string>]\n      } else {\n        result[key] = source[key]!\n      }\n    }\n  }\n  return result\n}\n\n// 递归赋值\nfunction _mergeDeepMergeArray<T>(target: Partial<T>, source: Partial<T>): T {\n  const result: T = { ...target } as T\n  for (const key in source) {\n    if (hasKey(source, key) && source[key] !== undefined) {\n      if (isObject(source[key]) && isPlainObject(source[key])) {\n        result[key] = _mergeDeepMergeArray(isObject(target[key]) ? target[key]! : {}, source[key]!)\n      } else if (isArray(source[key]) && isArray(target[key])) {\n        result[key] = _mergeDeepArray(target[key], source[key]) as unknown as T[Extract<keyof T, string>]\n      } else {\n        result[key] = source[key]!\n      }\n    }\n  }\n  return result\n}\n\nfunction _mergeDeepArray<T, U>(target: T[] | any, source: U[] | any): (T | U)[] {\n  const _target: T[] = isArray(target) ? (target as T[]) : []\n  const _source: U[] = isArray(source) ? (source as U[]) : []\n  return Array.prototype.concat.call(_target, _source).map((v) => {\n    if (v instanceof RegExp) {\n      return v\n    } else if (isObject(v) && isPlainObject(v)) {\n      return _mergeDeepMergeArray({}, v)\n    } else if (isArray(v)) {\n      return _mergeDeepArray([], v)\n    } else {\n      return v\n    }\n  })\n}\n\nexport function cloneArray<T extends any>(array: T[]) {\n  return array.slice()\n}\n\n// 检查数组中是否有元素\nexport function arrayIncludes<T>(array: T[], value: T) {\n  if (!isArray(array)) {\n    return false\n  }\n\n  if (array.length === 0) {\n    return false\n  }\n\n  let k = 0\n  while (k < array.length) {\n    if (array[k] === value) {\n      return true\n    }\n    k++\n  }\n\n  return false\n}\n\nexport const arrayRemove = <T>(arr: T[], e: T) => {\n  if (!isArray(arr)) {\n    return arr\n  }\n  const i = arr.indexOf(e)\n  if (i >= 0) {\n    const arr_ = arr.slice()\n    arr_.splice(i, 1)\n    return arr_\n  }\n  return arr\n}\n\nexport interface Visitor {\n  (target: any, property: string): any\n}\n\n/**\n * 按路径访问对象属性\n * @param target 待访问对象\n * @param property 访问属性路径\n * @param { (target: any, property: string): any } visitor 访问器\n */\nexport const safeVisit = (target: any, path: string, visitor: Visitor) => {\n  const paths = path.split('.')\n  let [method, ...rest] = paths\n  while (target && rest.length > 0) {\n    target = target[method]\n    ;[method, ...rest] = rest\n  }\n  if (!target) {\n    return undefined\n  }\n  return visitor(target, method)\n}\n\nexport const safeSet = (target: any, path: string, value: any) => {\n  safeVisit(target, path, (obj: any, property: string) => {\n    try {\n      obj[property] = value\n    } catch (e) {\n      // ignore\n    }\n  })\n}\n\n/**\n *  按路径调用函数\n * @param target 待调用对象，如 `client`\n * @param methods 待调用方法路径，可能是一级路径 `client.start`, 或者是多级命令 `client.context.set`\n * @param args 调用参数\n */\nexport const safeCall = (target: any, method: string, args: any[]) => {\n  return safeVisit(target, method, (obj: any, property: string) => {\n    if (obj && property in obj && isFunction(obj[property])) {\n      try {\n        return obj[property].apply(obj, args)\n      } catch (err) {\n        // ignore\n        return undefined\n      }\n    }\n  })\n}\n\n/**\n *  按路径调用函数或获取值\n * @param target 待调用对象，如 `client`\n * @param methods 待调用方法路径或属性路径\n * @param args 调用参数\n */\nexport const safeCallOrGet = (target: any, method: string, args?: any[]) => {\n  return safeVisit(target, method, (obj: any, property: string) => {\n    if (obj && property in obj) {\n      // call\n      if ((args && args.length) || isFunction(obj[property])) {\n        try {\n          return obj[property].apply(obj, args)\n        } catch (err) {\n          // ignore\n          return undefined\n        }\n      } else {\n        // get\n        return obj[property]\n      }\n    }\n  })\n}\n\nexport const applyRecord = <K extends keyof any, T>() => {\n  const record: Record<K, T> = {} as any\n  const set = (key: K, val: T) => (record[key] = val)\n  const del = (key: K) => delete record[key]\n\n  return [record, set, del] as const\n}\n\nexport const pick = <T extends Record<string, unknown>, K extends (keyof T)[]>(obj: T, keys: K): Pick<T, K[number]> => {\n  if (!obj || !isObject(obj)) return obj\n\n  return keys.reduce((prev, cur) => {\n    prev[cur] = obj[cur]\n    return prev\n  }, {} as Pick<T, K[number]>)\n}\n","import { EventBuilder, EventSender } from '../types'\n\nimport { id, noop } from './misc'\nimport { mergeDeepConcatArray } from './object-array'\n\nexport const noopSender: EventSender<any> = {\n  send() {},\n}\n\nexport const noopBuilder: EventBuilder<any, any> = {\n  build() {},\n}\n\nexport type DirectBuilder<T> = EventBuilder<T, T>\nexport const directBuilder: DirectBuilder<any> = {\n  build: id,\n}\nexport interface EmptyConfig {}\n\nexport const createBaseConfigManager = <C>(c: C) => {\n  let onChange = noop\n  let config = c\n  return {\n    getConfig() {\n      return config\n    },\n    setConfig(c: Partial<C>) {\n      config = { ...config, ...c }\n      onChange()\n      return config\n    },\n    onChange(fn: () => void) {\n      onChange = fn\n    },\n    onReady(fn: () => void) {\n      fn()\n    },\n  }\n}\n\nexport const createMergeConfigManager = <C>(c: C) => {\n  let onChange = noop\n  let config = c\n  return {\n    getConfig() {\n      return config\n    },\n    setConfig(c: Partial<C>) {\n      config = mergeDeepConcatArray(config, c)\n      onChange()\n      return config\n    },\n    onChange(fn: () => void) {\n      onChange = fn\n    },\n    onReady(fn: () => void) {\n      fn()\n    },\n  }\n}\n","import { isArray, isString, isObject } from './is'\n\nexport type IgnoreRegExp = RegExp | null\nexport type IgnoreList = Array<string | RegExp>\n\nexport const camelToKebab = (str: string) => {\n  return str.replace(/([a-z])([A-Z])/g, (_, a, b) => `${a}-${b.toLowerCase()}`)\n}\n\nexport function getRegexp(ignore: IgnoreList) {\n  if (!isArray(ignore)) {\n    return null\n  }\n\n  return ignore.length ? joinRegExp(ignore) : null\n}\n\nexport function joinRegExp(patterns: IgnoreList) {\n  const sources: string[] = []\n  const len = patterns.length\n\n  for (let i = 0; i < len; i++) {\n    const pattern = patterns[i]\n    if (isString(pattern)) {\n      sources.push((pattern as string).replace(/([.*+?^=!:${}()|[\\]/\\\\])/g, '\\\\$1'))\n    } else if (pattern && (pattern as RegExp).source) {\n      sources.push((pattern as RegExp).source)\n    }\n  }\n  return new RegExp(sources.join('|'), 'i')\n}\n\nexport function safeStringify(a: unknown): string {\n  try {\n    return isString(a) ? a : JSON.stringify(a)\n  } catch (err) {\n    return '[FAILED_TO_STRINGIFY]:' + String(err)\n  }\n}\n\nexport function safeJoin(input: any[], delimiter?: string): string {\n  if (!isArray(input)) {\n    return ''\n  }\n\n  const output = []\n  // eslint-disable-next-line @typescript-eslint/prefer-for-of\n  for (let i = 0; i < input.length; i++) {\n    try {\n      output.push(String(input[i]))\n    } catch (e) {\n      output.push('[value cannot be serialized]')\n    }\n  }\n  return output.join(delimiter)\n}\n/**\n * get query string from map\n * @param  {Record<string | number, string | number>} map\n */\nexport const joinQueryWithMap = (map: Record<string | number, string | number | undefined>) => {\n  return isObject(map)\n    ? Object.keys(map)\n        .reduce((result, currentKey) => {\n          result += `&${currentKey}=${map[currentKey]}`\n          return result\n        }, '')\n        .replace('&', '?')\n    : ''\n}\n","import { safeStringify } from './string'\n\nexport interface ContextAgent {\n  set: (k: string, v: any) => ContextAgent\n  merge: (ctx: Record<string, any>) => ContextAgent\n  delete: (k: string) => ContextAgent\n  clear: () => ContextAgent\n  get: (k: string) => string\n  toString: () => Record<string, string>\n}\n\nexport function createContextAgent(): ContextAgent {\n  let context = {} as Record<string, any>\n  let stringified = {} as Record<string, string>\n\n  const contextAgent = {\n    set(k: string, v: string) {\n      context[k] = v\n      stringified[k] = safeStringify(v)\n      return contextAgent\n    },\n    merge(ctx: Record<string, any>) {\n      context = { ...context, ...ctx }\n      Object.keys(ctx).forEach((key) => {\n        stringified[key] = safeStringify(ctx[key])\n      })\n      return contextAgent\n    },\n    delete(k: string) {\n      delete context[k]\n      delete stringified[k]\n      return contextAgent\n    },\n    clear() {\n      context = {}\n      stringified = {}\n      return contextAgent\n    },\n    get(k: string) {\n      return stringified[k]\n    },\n    toString() {\n      return { ...stringified }\n    },\n  }\n  return contextAgent\n}\n","import { isFunction } from './is'\nimport { noop } from './misc'\n\nexport interface RestoreFunction {\n  (strict?: boolean): void\n}\n\n// eslint-disable-next-line @typescript-eslint/ban-types\n/**\n * You can feel free to restore when you hook a function.\n * But you ought to restore 「in order」 if you hooked a value reference or a real obj reference.Because we not store the last value referent for now.\n * eg: obj.a = 1;\n * const r_1 = hookObjectProperty(obj, 'a',() =>2)()\n * const r_2 = hookObjectProperty(obj, 'a',() =>3)()\n * r_2() // obj.a === 2\n * r_1() // obj.a === 1\n *\n * @template T\n * @template K\n * @template P\n * @param {T} obj\n * @param {K} key\n * @param {(origin: T[K], ...params: P) => T[K]} hookFunc\n * @param {boolean} isCatchError When an error occurs after calling a hooked function, we want to suppress the errors and try to call the original function by default.\n * @return {*}\n */\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport const hookObjectProperty = <T extends {}, K extends keyof T, P extends any[]>(\n  obj: T,\n  key: K,\n  hookFunc: (origin: T[K], ...params: P) => T[K],\n  isCatchError = true,\n) => {\n  return (...params: P) => {\n    if (!obj) {\n      return noop\n    }\n    const origin = obj[key]\n    let hookedUnsafe = hookFunc(origin, ...params)\n    let hooked = hookedUnsafe\n\n    // 给所有 hook 之后的方法包一层 try catch\n    if (isFunction(hooked) && isCatchError) {\n      hooked = function (this: any, ...args: any) {\n        try {\n          return (hookedUnsafe as any).apply(this, args)\n        } catch {\n          return isFunction(origin) && origin.apply(this, args)\n        }\n      } as any as T[K]\n    }\n    obj[key] = hooked\n\n    // strict: is break\n    return (strict?: boolean) => {\n      if (!strict) {\n        hooked === obj[key] ? (obj[key] = origin) : (hookedUnsafe = origin)\n      }\n    }\n  }\n}\n\n/**\n * 劫持对象方法\n * 必须记得给 hookFunc 劫持的方法包 try catch ！\n * 不在本方法里包是为了避免对象原方法被调用两次\n */\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport const hookMethodDangerously = <T extends {}, K extends keyof T, P extends any[]>(\n  obj: T,\n  key: K,\n  hookFunc: (origin: T[K], ...params: P) => T[K],\n) => {\n  return (...params: P) => {\n    if (!obj) {\n      return noop\n    }\n\n    const origin = obj[key]\n    let hookedUnsafe = hookFunc(origin, ...params)\n    let hooked = hookedUnsafe\n\n    if (isFunction(hooked)) {\n      hooked = function (this: any, ...args: any) {\n        return (hookedUnsafe as any).apply(this, args)\n      } as any as T[K]\n    }\n\n    obj[key] = hooked\n    return () => {\n      hooked === obj[key] ? (obj[key] = origin) : (hookedUnsafe = origin)\n    }\n  }\n}\n","export const createLogger = (prefix: string, prefixLen = 20) => {\n  let count = 0\n  return (...args: any[]) => {\n    // eslint-disable-next-line no-console\n    console.log(prefix.padStart(prefixLen, ' '), Date.now(), `${count++}`.padStart(8, ' '), ...args)\n  }\n}\n\nlet count = 0\nexport const log = (...args: any[]) => {\n  // eslint-disable-next-line no-console\n  console.log('[SDK]', Date.now(), `${count++}`.padStart(8, ' '), ...args)\n}\n\nlet errCount = 0\nexport const error = (...args: any[]) => {\n  // eslint-disable-next-line no-console\n  console.error('[SDK]', Date.now(), `${errCount++}`.padStart(8, ' '), ...args)\n}\n\nlet warnCount = 0\nexport const warn = (...args: any[]) => {\n  // eslint-disable-next-line no-console\n  console.warn('[SDK]', Date.now(), `${warnCount++}`.padStart(8, ' '), ...args)\n}\n","export const isHitBySampleRate = (sampleRate: number): boolean => {\n  if (Math.random() < Number(sampleRate)) {\n    return true\n  }\n  return false\n}\n\nexport const isHitByRandom = (random: number, sampleRate: number): boolean => {\n  if (random < Number(sampleRate)) {\n    return true\n  }\n  return false\n}\n","/* eslint-disable @typescript-eslint/prefer-for-of */\nimport { Processor, Falsy } from '../types'\n\nimport { error } from './logger'\n\nexport const runProcessors =\n  <E>(fns: Processor<E>[]) =>\n  (e: E) => {\n    let r: E | Falsy = e\n    for (let i = 0; i < fns.length; i++) {\n      if (r) {\n        try {\n          r = fns[i](r)\n        } catch (err) {\n          error(err)\n        }\n      } else {\n        break\n      }\n    }\n    return r\n  }\n","/**\n * 生成uuid\n * stolen from https://github.com/kelektiv/node-uuid#readme uuid/v4\n *\n * @returns\n */\n\nfunction mathRNG() {\n  const rnds: number[] = new Array(16)\n\n  let r = 0\n\n  for (let i = 0; i < 16; i++) {\n    if ((i & 0x03) === 0) {\n      r = Math.random() * 0x100000000\n    }\n    rnds[i] = (r >>> ((i & 0x03) << 3)) & 0xff\n  }\n\n  return rnds\n}\n\nfunction bytesToUuid(buf: number[]) {\n  const byteToHex = [] as string[]\n  for (let index = 0; index < 256; ++index) {\n    byteToHex[index] = (index + 0x100).toString(16).substr(1)\n  }\n\n  let i = 0\n  const bth = byteToHex\n  // join used to fix memory issue caused by concatenation: https://bugs.chromium.org/p/v8/issues/detail?id=3175#c4\n  return [\n    bth[buf[i++]],\n    bth[buf[i++]],\n    bth[buf[i++]],\n    bth[buf[i++]],\n    '-',\n    bth[buf[i++]],\n    bth[buf[i++]],\n    '-',\n    bth[buf[i++]],\n    bth[buf[i++]],\n    '-',\n    bth[buf[i++]],\n    bth[buf[i++]],\n    '-',\n    bth[buf[i++]],\n    bth[buf[i++]],\n    bth[buf[i++]],\n    bth[buf[i++]],\n    bth[buf[i++]],\n    bth[buf[i++]],\n  ].join('')\n}\n\nfunction uuid() {\n  const rnds: number[] = mathRNG()\n\n  // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n  rnds[6] = (rnds[6] & 0x0f) | 0x40\n  rnds[8] = (rnds[8] & 0x3f) | 0x80\n\n  return bytesToUuid(rnds)\n}\n\nexport { uuid }\n","import { noop } from './misc'\n\nexport const BUFFER_TIME = 300000 // 5分钟\n\nexport const applyBufferTimer = (checkIfNeedCancel: () => boolean, cb: () => void, bufferTime: number) => {\n  let tid = 0\n  if (bufferTime === -1) return noop\n  return () => {\n    if (checkIfNeedCancel()) {\n      tid && clearTimeout(tid)\n      tid = 0\n      return\n    }\n    tid === 0 && (tid = (setTimeout as Window['setTimeout'])(cb, bufferTime))\n  }\n}\n","/* eslint-disable @typescript-eslint/no-invalid-void-type */\nimport { arrayRemove } from './object-array'\nimport { applyBufferTimer, BUFFER_TIME } from './time'\n\nexport type ParametersForFn<T extends (args: any) => any> = T extends (args: infer P) => any ? P : never\n\nexport type Observable<T extends (args: any) => any> = {\n  subscribe: (f: T) => () => void\n  unsubscribe: (f: T) => void\n  next: (args: ParametersForFn<T>) => ReturnType<NextLink<T>>\n  attach: (disconnect: () => void, onSubscribe?: (f: T) => void) => void\n  complete: (f: () => void) => void\n}\n\nexport type SafeObservable<T> = [(f: T) => () => void, (f: T) => void]\n\nexport type Observer<T extends (args: any) => any> = (\n  next: (args: ParametersForFn<T>) => ReturnType<NextLink<T>>,\n  attach: (disconnect: () => void, onSubscribe?: (f: T) => void) => void,\n) => void\n\nexport type NextLink<T extends (args: any) => any> = (args: ParametersForFn<T>, cb: T[]) => NextLink<ReturnType<T>>\n\nexport const nextLink = <T extends (args: any) => any>(args: ParametersForFn<T>, cb: T[]) => {\n  let nextCbs: ReturnType<T>[] = []\n  try {\n    nextCbs = cb.reduce((sum: ReturnType<T>[], s: T) => {\n      try {\n        const nextCb = s(args)\n        typeof nextCb === 'function' && sum.push(nextCb)\n      } catch {\n        // do nothing\n      }\n      return sum\n    }, [])\n  } catch {\n    // do nothing\n  }\n  return (nextArgs: ParametersForFn<ReturnType<T>>) => nextLink(nextArgs, nextCbs)\n}\n\nexport const toObservable = <T extends (args: any) => any>(bufferTime: number = BUFFER_TIME): Observable<T> => {\n  let subscribers: T[] = []\n  const __complete: (() => void)[] = []\n  let closed = false\n  let attachCb: [() => void, ((f: T) => void) | undefined] | undefined\n\n  // 暂缓的自动销毁机制，比如5min 没有人订阅就自动销毁\n  const setCloseIfNeed = applyBufferTimer(\n    () => !!subscribers.length,\n    () => {\n      closed = true\n      attachCb && attachCb[0]()\n      __complete.forEach((e) => e())\n      __complete.length = 0\n      attachCb = undefined\n    },\n    bufferTime,\n  )\n\n  const unsubscribe = (o: T) => {\n    subscribers = arrayRemove(subscribers, o)\n    !closed && setCloseIfNeed()\n  }\n  return {\n    next: (args: ParametersForFn<T>) => {\n      return nextLink(args, subscribers)\n    },\n    complete: (cb) => {\n      __complete.push(cb)\n    },\n    attach: (disconnect: () => void, onSubscribe?: (f: T) => void) => {\n      attachCb = [disconnect, onSubscribe]\n    },\n    subscribe: (o: T) => {\n      if (closed) throw new Error('Observer is closed')\n      subscribers.push(o)\n      attachCb && attachCb[1] && attachCb[1](o)\n      setCloseIfNeed()\n      return () => unsubscribe(o)\n    },\n    unsubscribe,\n  }\n}\n\nexport const createSafeObserver = <T extends (args: any) => any>(\n  observer: Observer<T>,\n  completeCb?: () => void,\n  bufferTime?: number,\n): SafeObservable<T> => {\n  const cur = toObservable<T>(bufferTime)\n  try {\n    observer(cur.next, cur.attach)\n    completeCb && cur.complete(completeCb)\n  } catch {\n    //\n  }\n  return [cur.subscribe, cur.unsubscribe]\n}\n","/* eslint-disable @typescript-eslint/prefer-nullish-coalescing */\nimport {\n  AnyClient,\n  Client,\n  ClientEvent,\n  ConfigManager,\n  ConfigNormalizer,\n  EventBuilder,\n  EVENTS,\n  EventSender,\n} from './types'\nimport { arrayIncludes, arrayRemove, isObject, log, runProcessors, warn } from './utils'\n\nexport type CreateClientConfig<\n  ReportEvent,\n  SendEvent,\n  Builder extends EventBuilder<ReportEvent, SendEvent>,\n  Sender extends EventSender<SendEvent>,\n  InitConfig,\n  UserConfig,\n  Config,\n> = {\n  createDefaultConfig: (c: Partial<InitConfig>) => Config\n  validateInitConfig: (c: InitConfig) => boolean\n  initConfigNormalizer: ConfigNormalizer<InitConfig, Config>\n  userConfigNormalizer: ConfigNormalizer<UserConfig, Config>\n  createConfigManager: (c: Config, clt?: AnyClient) => ConfigManager<Config>\n  createSender: (c: Config) => Sender\n  builder: Builder\n}\n\nexport function createClient<\n  ReportEvent,\n  SendEvent,\n  Builder extends EventBuilder<ReportEvent, SendEvent>,\n  Sender extends EventSender<SendEvent>,\n  InitConfig,\n  UserConfig,\n  Config,\n>(\n  creationConfig: CreateClientConfig<ReportEvent, SendEvent, Builder, Sender, InitConfig, UserConfig, Config>,\n): Client<ReportEvent, SendEvent, Builder, Sender, InitConfig, UserConfig, Config> {\n  const {\n    builder,\n    createSender,\n    createDefaultConfig,\n    createConfigManager,\n    userConfigNormalizer,\n    initConfigNormalizer,\n    validateInitConfig,\n  } = creationConfig\n  let sender: Sender | undefined\n\n  let configManager: ConfigManager<Config> | undefined\n\n  type HandlerMap = ClientEvent<ReportEvent, SendEvent, UserConfig>\n  const handlers = {} as { [T in keyof HandlerMap]: HandlerMap[T][] }\n  EVENTS.forEach((e) => (handlers[e] = []))\n\n  let inited = false\n  let started = false\n  let destroyed = false\n  // 缓存 start 之前 build 的事件\n  let preStartQueue = [] as ReportEvent[]\n  // 禁止通过 provide 挂载的字段名\n  let reservedNames = [] as string[]\n\n  const client: Client<ReportEvent, SendEvent, Builder, Sender, InitConfig, UserConfig, Config> = {\n    getBuilder: () => builder,\n    getSender: () => sender,\n    getPreStartQueue: () => preStartQueue,\n    init: (c: InitConfig) => {\n      if (inited) {\n        warn('already inited')\n        return\n      }\n\n      if (c && isObject(c) && validateInitConfig(c)) {\n        log('[client].init', c)\n\n        log('[client].init createDefaultConfig')\n        const defaultConfig = createDefaultConfig(c)\n        if (!defaultConfig) {\n          throw new Error('defaultConfig missing')\n        }\n\n        const initConfig = initConfigNormalizer(c)\n        log('[client].init createConfigManager', defaultConfig)\n        configManager = createConfigManager(defaultConfig)\n        configManager.setConfig(initConfig)\n        configManager.onChange(() => {\n          log('[configManager].onChange')\n          handle('config')\n        })\n\n        sender = createSender(configManager.getConfig())\n        if (!sender) {\n          throw new Error('sender missing')\n        }\n\n        inited = true\n        handle('init', true)\n        log('[client].init done')\n      } else {\n        throw new Error('invalid InitConfig, init failed')\n      }\n    },\n    set: (c: Partial<Config>) => {\n      if (!inited) {\n        return\n      }\n      if (c && isObject(c)) {\n        handle('beforeConfig', false, c)\n        log('[client].set', c)\n        configManager?.setConfig(c)\n      }\n    },\n    config: (c?: Partial<UserConfig>) => {\n      if (!inited) {\n        return\n      }\n      if (c && isObject(c)) {\n        log('[client].config', c)\n        handle('beforeConfig', false, c)\n        configManager?.setConfig(userConfigNormalizer(c))\n      }\n      return configManager?.getConfig()\n    },\n    provide: function (name: string, value: any) {\n      if (arrayIncludes(reservedNames, name)) {\n        warn(`cannot provide ${name}, reserved`)\n        return\n      }\n      log('[client].provide', name)\n      client[name] = value\n      handle('provide', false, name)\n    },\n    start() {\n      if (!inited) {\n        return\n      }\n      if (started) {\n        return\n      }\n      log('[client].start')\n      configManager?.onReady(() => {\n        log('[configManager].onReady')\n        started = true\n        handle('start', true)\n        log('[client] start consuming preStartQueue')\n        preStartQueue.forEach((e) => this.build(e))\n        preStartQueue = []\n        log('[client] complete consuming preStartQueue')\n      })\n    },\n    report: function (data: ReportEvent) {\n      if (!data) {\n        return\n      }\n      log('[client].beforeReport', data)\n      const preReport = runProcessors(handlers['beforeReport'])(data)\n      if (!preReport) {\n        return\n      }\n      log('[client].report', preReport)\n      const processed = runProcessors(handlers['report'])(preReport)\n      if (!processed) {\n        return\n      }\n      if (started) {\n        this.build(processed)\n      } else {\n        log('[client].report push preStartQueue', processed)\n        preStartQueue.push(processed)\n      }\n    },\n    build: function (data: ReportEvent) {\n      if (!started) {\n        return\n      }\n      log('[client].build', data)\n      const preBuild = runProcessors(handlers['beforeBuild'])(data)\n      if (!preBuild) {\n        return\n      }\n      const built = builder.build(preBuild)\n      if (!built) {\n        return\n      }\n      const processed = runProcessors(handlers['build'])(built)\n      if (!processed) {\n        return\n      }\n      this.send(processed)\n    },\n    send: function (data: SendEvent) {\n      if (!started) {\n        return\n      }\n      log('[client].send', data)\n      const processed = runProcessors(handlers['beforeSend'])(data)\n      if (processed) {\n        sender!.send(processed)\n        handle('send', false, processed)\n        log('[client].send sent', processed)\n      }\n    },\n    destroy() {\n      log('[client].destroy')\n      destroyed = true\n      handle('beforeDestroy', true)\n    },\n    on(ev: keyof HandlerMap, handler: HandlerMap[typeof ev]) {\n      log('[client].on', ev)\n      if (ev === 'init' && inited) {\n        ;(handler as HandlerMap['init'])()\n      } else if (ev === 'start' && started) {\n        ;(handler as HandlerMap['start'])()\n      } else if (ev === 'beforeDestroy' && destroyed) {\n        ;(handler as HandlerMap['beforeDestroy'])()\n      } else if (handlers[ev]) {\n        handlers[ev].push(handler as any)\n      }\n    },\n    off(ev: keyof HandlerMap, handler: HandlerMap[typeof ev]) {\n      log('[client].off', ev)\n      if (handlers[ev]) handlers[ev] = arrayRemove(handlers[ev], handler) as any\n    },\n  }\n\n  reservedNames = Object.keys(client)\n  return client\n\n  function handle(ev: string, once = false, ...args: any) {\n    handlers[ev].forEach((f: any) => {\n      try {\n        f(...args)\n      } catch (_err) {\n        // ignore\n      }\n    })\n    if (once) {\n      handlers[ev].length = 0\n    }\n  }\n}\n","import { AnyClient, Client } from '../types'\nimport { createContextAgent, ContextAgent } from '../utils'\n\nexport type ContextualEvent = {\n  extra?: {\n    context?: Record<string, string>\n  }\n}\nexport type WithContext<C extends AnyClient> = C & {\n  context?: ContextAgent\n}\n\n// manually declare\nexport type WithCommandContext<C extends AnyClient> = C & {\n  'context.set': (k: string, v: any) => ContextAgent\n  'context.merge': (ctx: Record<string, any>) => ContextAgent\n  'context.delete': (k: string) => ContextAgent\n  'context.clear': () => ContextAgent\n  'context.get': (k: string) => string\n  'context.toString': () => Record<string, string>\n}\n\nexport const ContextPlugin = <E extends ContextualEvent>(client: Client<E, any, any, any, any, any, any>) => {\n  const contextAgent = createContextAgent()\n\n  client.provide('context', contextAgent)\n\n  client.on('report', (ev: E) => {\n    if (!ev.extra) {\n      ev.extra = {}\n    }\n    ev.extra.context = contextAgent.toString()\n    return ev\n  })\n}\n","/* eslint-disable @typescript-eslint/prefer-nullish-coalescing */\nimport { AnyClient, ClientEvent, ReportEventFromClient, SendEventFromClient, UnionToIntersection } from '../types'\nimport { hookObjectProperty, log, safeCall } from '../utils'\n\nexport type WithCommandArray<C extends AnyClient> = C & GetCommandFunction<C>\n\nexport const withCommandArray = <C extends AnyClient, CapturedContext>(\n  client: C,\n  captureContext?: (c: C) => CapturedContext,\n  applyArgsWithContext?: (c: C, ctx: CapturedContext, args: any[]) => void,\n) => {\n  type CachedCommand = [CapturedContext, ...any]\n  // 缓存需要异步插件来消费的命令\n  const cache: Record<string, CachedCommand[] | null> = {}\n\n  const newClient = function (...args: any[]) {\n    const methodPath = args[0]\n    if (!methodPath) return\n\n    const method = methodPath.split('.')[0]\n    // 捕获上下文，等异步插件加载后传入\n    if (!(method in newClient)) {\n      log('[command-array] cache command', method, methodPath)\n      const cachedCommands = cache[method] || []\n      // 区分预收集来的上下文与普通上下文\n      const capturedContext = captureContext?.(client) ?? ({} as CapturedContext)\n\n      cachedCommands.push([capturedContext, ...args])\n      cache[method] = cachedCommands\n      return\n    }\n    log('[command-array] safeCall', methodPath)\n    return safeCall(newClient, methodPath, [].slice.call(args, 1))\n  } as WithCommandArray<C>\n\n  hookObjectProperty(client, 'provide', (origin: typeof client['provide']) => {\n    return (name: string, value: any) => {\n      newClient[name] = value\n      origin.call(client, name, value)\n    }\n  })()\n\n  for (const nextKey in client) {\n    // Avoid bugs when hasOwnProperty is shadowed\n    if (Object.prototype.hasOwnProperty.call(client, nextKey)) {\n      newClient[nextKey] = client[nextKey] as any\n    }\n  }\n\n  client.on('provide', (name: string) => {\n    if (cache[name]) {\n      cache[name]!.forEach((cachedCommands: any) => {\n        log('[command-array] execute cached command', name, cachedCommands)\n        const [capturedContext, ...args] = cachedCommands\n        applyArgsWithContext?.(client, capturedContext, args)\n      })\n      cache[name] = null\n    }\n  })\n  return newClient\n}\n\ndeclare type PropertyToFunction<C extends Record<string, any>, P extends keyof C> = P extends infer K\n  ? K extends keyof C\n    ? C[K] extends (...args: any) => any\n      ? (m: K, ...args: Parameters<C[K]>) => ReturnType<C[K]>\n      : C[K] extends ((...args: any) => any) | undefined\n      ? (m: K, ...args: Parameters<NonNullable<C[K]>>) => ReturnType<NonNullable<C[K]>> | undefined\n      : (m: K) => C[K]\n    : never\n  : never\n\ntype Event<C extends AnyClient> = ClientEvent<ReportEventFromClient<C>, SendEventFromClient<C>, any>\ntype EventToOnFunctions<Event extends ClientEvent<any, any, any>, T extends keyof Event> = T extends infer K\n  ? K extends keyof Event\n    ? (m: 'on', ev: K, handler: Event[K]) => void\n    : never\n  : never\ntype EventToOffFunctions<Event extends ClientEvent<any, any, any>, T extends keyof Event> = T extends infer K\n  ? K extends keyof Event\n    ? (m: 'off', ev: K, handler: Event[K]) => void\n    : never\n  : never\ntype EventFunctions<C extends AnyClient> =\n  | EventToOnFunctions<Event<C>, keyof Event<C>>\n  | EventToOffFunctions<Event<C>, keyof Event<C>>\n// eslint-disable-next-line @typescript-eslint/ban-types\ntype GetCommandFunction<C extends AnyClient> = Function &\n  UnionToIntersection<PropertyToFunction<C, Exclude<keyof C, 'on' | 'off'>> | EventFunctions<C>>\n","import { AnyClient, SendEventFromClient } from '../types'\nimport { createLogger } from '../utils'\n\nexport const LOGGER_NAME = 'logger'\n\nconst logFn = createLogger('[LoggerPlugin]')\n\nexport function LoggerPlugin<C extends AnyClient>(client: C) {\n  client.on('send', (ev: SendEventFromClient<C>) => {\n    logFn(ev)\n  })\n}\n","import { AnyClient, Client } from '../types'\nimport { arrayIncludes } from '../utils'\n\nexport interface Integration<T extends AnyClient> {\n  name: string\n  setup: (client: T) => void\n  tearDown?: () => void\n}\n\nexport interface ConfigWithIntegration<T extends AnyClient> {\n  integrations?: Integration<T>[]\n}\n\nexport function IntegrationPlugin<E extends ConfigWithIntegration<any>, T extends ConfigWithIntegration<any>>(\n  client: Client<any, any, any, any, E, any, T>,\n) {\n  client.on('init', () => {\n    const nameList: string[] = []\n    const config = client.config()\n    if (!config || !config.integrations) {\n      return\n    }\n    config.integrations.forEach((integration) => {\n      if (!arrayIncludes(nameList, integration.name)) {\n        nameList.push(integration.name)\n        integration.setup(client)\n        integration.tearDown && client.on('beforeDestroy', integration.tearDown)\n      }\n    })\n  })\n}\n","import { AnyClient } from '../types'\nimport { Observer, createSafeObserver, SafeObservable } from '../utils/observable'\n\nexport type WithSubject<C extends AnyClient> = C & {\n  initSubject: <T extends (args: any) => any>(args: [subjectKey: string, collector: Observer<T>]) => SafeObservable<T>\n  getSubject: (key: string) => SafeObservable<any> | undefined\n  privateSubject: SubjectMap\n}\n\nexport type SubjectMap = { [key: string]: SafeObservable<any> | undefined }\n\nexport function SubjectPlugin(client: AnyClient, globalSubjectMap: SubjectMap | undefined) {\n  const subjectMap: SubjectMap = globalSubjectMap || {}\n  const initSubject = <T extends (args: any) => any>([subjectKey, observer]: [\n    string,\n    Observer<T>,\n  ]): SafeObservable<T> => {\n    if (!subjectMap[subjectKey])\n      subjectMap[subjectKey] = createSafeObserver(observer, () => {\n        subjectMap[subjectKey] = undefined\n      })\n    return subjectMap[subjectKey] as SafeObservable<T>\n  }\n  client.provide('initSubject', initSubject)\n  client.provide('getSubject', (key: string) => subjectMap[key])\n  client.provide('privateSubject', {})\n}\n\n/**\n * 由于 Observer 带有自动销毁机制，意味着subject 只支持同步注册并使用\n */\nexport function initSubjectInGlobal<T extends (args: any) => any>(\n  client: WithSubject<AnyClient>,\n  args: [subjectKey: string, observer: Observer<T>],\n) {\n  return client.initSubject(args)\n}\n\n/**\n * 此方法不会挂载到全局对象上，同时只支持同步注册并使用\n */\nexport function initPrivateSubject<T extends (args: any) => any>(\n  client: WithSubject<AnyClient>,\n  [subjectKey, observer]: [subjectKey: string, observer: Observer<T>],\n  bufferTime?: number,\n) {\n  const subjectMap = client.privateSubject || {}\n  if (!subjectMap[subjectKey])\n    subjectMap[subjectKey] = createSafeObserver(\n      observer,\n      () => {\n        subjectMap[subjectKey] = undefined\n      },\n      bufferTime,\n    )\n  return subjectMap[subjectKey] as SafeObservable<T>\n}\n"],"names":[],"mappings":"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"}