"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const fs_extra_1=__importDefault(require("fs-extra")),path_1=__importDefault(require("path")),commonData_1=require("../../../types/commonData"),compile_1=__importDefault(require("../compile"));class GadgetCompile extends compile_1.default{getPackVersion(){return"upgrade"}start(){const{type:e,sourcePath:t,distPath:a,appInfo:o}=this.options,{pluginRoot:r}=fs_extra_1.default.readJSONSync(path_1.default.join(t,"project.config.json")),p=this.getPackVersion();if(r){const i=path_1.default.join(t,r),c={type:"compile",data:{packVersion:p,type:"plugin",watch:"watch"===e||"live"===e,projectDir:t,outputDir:path_1.default.join(a||i,"../",r),context:{isIDE:!0,compileType:"splits",packageType:o.packageType,remoteDebugUrl:o.remoteDebugUrl,forceMinify:!1,sourceMapType:"INLINE",needComponentList:!0,needSubPackage:!1,showPerformance:!0,disableSafeCheck:!0,compileVersion:"upgrade"===o.frameWorkType?"upgrade":"legacy"}}};this.startProcess(c)}const i={type:"compile",data:{packVersion:p,type:commonData_1.AppTypeEnum.Gadget,watch:"watch"===e||"live"===e,projectDir:t,outputDir:a,context:{isIDE:!0,compileType:"splits",packageType:o.packageType,remoteDebugUrl:o.remoteDebugUrl,forceMinify:!1,sourceMapType:"INLINE",needComponentList:!0,needSubPackage:!1,showPerformance:!0,disableSafeCheck:!0,compileVersion:"upgrade"===o.frameWorkType?"upgrade":"legacy"}}};return this.startProcess(i)}get events(){return{live:{compile:"gadget_preview_compile",first:"gadget_preview_first_compile",watch:"gadget_preview_watch_compile"},force:{compile:"gadget_force_compile",first:"gadget_force_first_compile",watch:"gadget_force_watch_compile"},debug:{compile:"gadget_remote_debug",first:"gadget_remote_debug_first_compile",watch:"gadget_remote_debug_watch_compile"},watch:{compile:"gadget_develop",first:"gadget_develop_first_compile",watch:"gadget_develop_watch_compile"}}[this.compileType]}}exports.default=GadgetCompile;