"use strict";var __rest=this&&this.__rest||function(t,e){var o={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(o[s]=t[s]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(s=Object.getOwnPropertySymbols(t);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(t,s[r])&&(o[s[r]]=t[s[r]])}return o},__importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.setProject=exports.setRoot=void 0;const utils_1=require("./utils"),flow_1=__importDefault(require("../../../common/flow"));function setRoot(t,e,o,s,r){if(void 0===e&&void 0===o[t])return[];const c=(0,utils_1.diff)(e,o[t]);o[t]=e;const n=flow_1.default.run(r,"getStorageKey","root"),i=flow_1.default.run(r,"getStorageKey","config"),f=o[n];if("accountInfo"===t)Object.keys(f).forEach(t=>{f[t].accountInfo||c.push([n,t,"accountInfo"])}),s.set("accountInfo",e);else if("ideConfig"===t){c.some(t=>t[1]===i)&&Object.keys(f).forEach(t=>{c.push([n,t,"simulatorConfig"])});const t=e||{sdkRootPath:""},{sdkRootPath:o}=t,r=__rest(t,["sdkRootPath"]);s.set("ideConfig",r)}else"accountInfoMap"===t?s.set("accountInfoMap",e):"cookies"===t?s.set("cookies",e):"testAccounts"===t?s.set("testAccounts",e):"settings"===t?s.set("settings",e):"history"===t?s.set("history",e):"windowSizeMemory"===t?s.set("windowSizeMemory",e):"usersConfig"===t&&s.set("usersConfig",e);return c}function setProject(t,e,o,s,r){var c;const n=flow_1.default.run(r,"getStorageKey","root");let i=[[n,t]];if(null===(c=null==o?void 0:o[n])||void 0===c?void 0:c[t])if(e){const s=(0,utils_1.diff)(e,o[n][t]),r=o[n],c=Object.keys(r);o[n]=c.reduce((e,o)=>(o!==t&&(e[o]=r[o]),e),{[t]:e}),o.projectIds[e.compileId]=t,i=s}else{const e=o[n],s=t,r=(e[s],__rest(e,["symbol"==typeof s?s:s+""])),c=o.projectIds,i=o[n][t].compileId,f=(c[i],__rest(c,["symbol"==typeof i?i:i+""]));o[n]=r,o.projectIds=f}else if(e){const s=o[n]||{};let r=!1;const c=Object.keys(s);o[n]=c.reduce((c,n)=>(!r&&n.localeCompare(t)>0&&(r=!0,c[t]=e,o.projectIds[e.compileId]=t),c[n]=s[n],c),{}),r||(o[n][t]=e,o.projectIds[e.compileId]=t)}return flow_1.default.run(r,"saveProject",t,o[n][t],s),i}exports.setRoot=setRoot,exports.setProject=setProject;