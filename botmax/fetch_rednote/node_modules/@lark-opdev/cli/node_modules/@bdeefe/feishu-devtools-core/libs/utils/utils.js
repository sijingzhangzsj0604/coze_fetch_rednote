"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,a)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding(t,e,r);return __setModuleDefault(t,e),t},__awaiter=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(a,n){function s(e){try{u(o.next(e))}catch(e){n(e)}}function i(e){try{u(o.throw(e))}catch(e){n(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,i)}u((o=o.apply(e,t||[])).next())}))},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getFullDateNumbers=exports.renameSafe=exports.resolvePath=exports.unzipFile=exports.setClipboardData=exports.getClipboardData=exports.axiosGet=exports.startHTTPServer=exports.startServer=exports.toHash=exports.base64Decode=exports.base64Encode=exports.getRandomString=exports.getDirectorySize=exports.checkCompilePath=exports.getInternalIp=exports.unpackPKGPath=exports.readFileContent=exports.progressMock=exports.removeItem=exports.AccountSplitsDefine=void 0;const path_1=__importDefault(require("path")),fs_1=__importDefault(require("fs")),os_1=__importDefault(require("os")),Error_1=__importStar(require("../common/Error")),fs_extra_1=__importDefault(require("fs-extra")),node_1=__importDefault(require("@lark-opdev/i18n/libs/node")),base64_js_1=__importDefault(require("base64-js")),express_1=__importDefault(require("express")),axios_1=__importDefault(require("axios")),clipboardy_1=__importDefault(require("clipboardy")),extract_zip_1=__importDefault(require("extract-zip"));function removeItem(e,t){const r=e.indexOf(t);return~r&&e.splice(r,1),!!~r}function progressMock(e,t,r=0){const o=Math.floor(e/20),a=setInterval(()=>{const e=r+5;t(e),e>=100&&clearInterval(a)},o);return{stop(){clearInterval(a)}}}function readFileContent(e,t){const r=e+path_1.default.sep+t;return new Promise((e,t)=>{fs_1.default.existsSync(r)?fs_1.default.readFile(r,(r,o)=>{r?t(r):e(JSON.parse(o.toString()))}):t(new Error_1.default({code:Error_1.CoreErrorCode.FILE_NOT_FOUND,message:node_1.default.t("FILE_NOT_FOUND",{filePath:r})}))})}function unpackPKGPath(e){return path_1.default.join(path_1.default.dirname(e),".__temp__")}function getInternalIp(e=!0){const t=Object.values(os_1.default.networkInterfaces()).reduce((e,t)=>e.concat(t),[]).find(e=>"IPv4"===e.family&&"127.0.0.1"!==e.address&&!e.internal);return t?t.address:e?"127.0.0.1":""}function checkCompilePath(e){return!!e&&fs_1.default.existsSync(e)}function getDirectorySize(e){return fs_1.default.existsSync(e)?fs_1.default.statSync(e).isDirectory()?fs_1.default.readdirSync(e).reduce((t,r)=>t+getDirectorySize(path_1.default.join(e,r)),0):fs_1.default.statSync(e).size:0}function getRandomString(){return Math.random().toString(36).slice(2)}function base64Encode(e=""){const t=Buffer.from(e);return base64_js_1.default.fromByteArray(t)}function base64Decode(e=""){const t=e.trim();if(!t)return t;const r=base64_js_1.default.toByteArray(t);return Buffer.from(r).toString()}function toHash(e){let t,r=0;if(0===e.length)return r.toString();for(let o=0,a=e.length;o<a;o+=1)t=e.charCodeAt(o),r=(r<<5)-r+t,r|=0;return r.toString()}function startServer(e,t,r=[]){const o=(0,express_1.default)();o.use(express_1.default.static(e)),r.forEach(e=>o.use(e));const a=o.listen(),n=a.address().port;return{url:`http://${t?getInternalIp():"127.0.0.1"}:${n}/`,server:a}}function startHTTPServer(e,t,r=[]){const{url:o}=startServer(e,t,r);return o}exports.AccountSplitsDefine="*#*",exports.removeItem=removeItem,exports.progressMock=progressMock,exports.readFileContent=readFileContent,exports.unpackPKGPath=unpackPKGPath,exports.getInternalIp=getInternalIp,exports.checkCompilePath=checkCompilePath,exports.getDirectorySize=getDirectorySize,exports.getRandomString=getRandomString,exports.base64Encode=base64Encode,exports.base64Decode=base64Decode,exports.toHash=toHash,exports.startServer=startServer,exports.startHTTPServer=startHTTPServer;const axiosGet=(e,t=500,r={})=>__awaiter(void 0,void 0,void 0,(function*(){const o=axios_1.default.CancelToken.source(),a=setTimeout(()=>o.cancel(`get ${e} timeout`),t),n=yield axios_1.default.get(e,Object.assign({cancelToken:o.token},r));return clearTimeout(a),n}));exports.axiosGet=axiosGet;const getClipboardData=()=>clipboardy_1.default.readSync();exports.getClipboardData=getClipboardData;const setClipboardData=e=>{clipboardy_1.default.writeSync(e)};exports.setClipboardData=setClipboardData;const unzipFile=(e,t)=>__awaiter(void 0,void 0,void 0,(function*(){yield(0,extract_zip_1.default)(e,{dir:t})}));function resolvePath(e){return e||(e="./"),e.includes("://")||path_1.default.isAbsolute(e)?e:path_1.default.resolve(process.cwd(),e)}function renameSafe(e,t,r=0){return __awaiter(this,void 0,void 0,(function*(){try{yield fs_extra_1.default.promises.rename(e,t)}catch(o){if(r>5)throw o;yield new Promise(e=>{setTimeout(e,500)}),yield renameSafe(e,t,r+1)}}))}function getFullDateNumbers(e=new Date){return`${e.getFullYear()}${e.getMonth()+1}${e.getDate()}${e.getHours()}${e.getMinutes()}${e.getSeconds()}${e.getMilliseconds()}`}exports.unzipFile=unzipFile,exports.resolvePath=resolvePath,exports.renameSafe=renameSafe,exports.getFullDateNumbers=getFullDateNumbers;