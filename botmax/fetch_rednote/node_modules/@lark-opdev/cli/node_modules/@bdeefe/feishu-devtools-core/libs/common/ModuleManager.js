"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding(t,e,r);return __setModuleDefault(t,e),t},__awaiter=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(n,a){function u(e){try{_(o.next(e))}catch(e){a(e)}}function i(e){try{_(o.throw(e))}catch(e){a(e)}}function _(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,i)}_((o=o.apply(e,t||[])).next())}))},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const node_1=__importDefault(require("@lark-opdev/i18n/libs/node")),Error_1=__importStar(require("../common/Error")),protocol_1=__importDefault(require("../protocol"));class ModuleManager{constructor(){this.moduleMap=new Map,this.addEventListener=(e,t,r)=>{const o=this.moduleMap.get(e),n=protocol_1.default[e];if(!o||!n.eventNames.includes(t))throw new Error_1.default({code:Error_1.CoreErrorCode.CORE_MODULE_ERROR,message:node_1.default.t("CORE_MODULE_ERROR_NAME_INVALID",{name:t,moduleName:e})});return o.addEventListener(t,r)},this.execute=(e,t,...r)=>{const o=this.moduleMap.get(e),n=protocol_1.default[e];if(!o||!n.commandNames.includes(t))throw new Error_1.default({code:Error_1.CoreErrorCode.CORE_MODULE_ERROR,message:node_1.default.t("CORE_MODULE_ERROR_CMD_INVALID",{moduleName:e,cmd:t})});return o.exec(t,...r)}}init(e){return __awaiter(this,void 0,void 0,(function*(){const t=[];for(let r=0,o=e.length;r<o;r++){const o=e[r];if(!protocol_1.default[o.moduleName])throw new Error_1.default({code:Error_1.CoreErrorCode.CORE_MODULE_ERROR,message:node_1.default.t("CORE_MODULE_ERROR_NOT_DECLARANT",{moduleName:o.moduleName})});t.push(o.moduleName),this.moduleMap.set(o.moduleName,o)}const r=[];for(let o=0,n=e.length;o<n;o++){const n=e[o];if(protocol_1.default[n.moduleName].dependencies.some(e=>!t.includes(e)))throw new Error_1.default({code:Error_1.CoreErrorCode.CORE_MODULE_ERROR,message:node_1.default.t("CORE_MODULE_ERROR_MISS_DEPENDENCY",{moduleName:n.moduleName})});r.push(n.install(this))}yield r}))}}exports.default=ModuleManager;