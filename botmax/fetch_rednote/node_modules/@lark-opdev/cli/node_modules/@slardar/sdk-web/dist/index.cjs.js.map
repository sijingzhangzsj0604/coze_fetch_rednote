{"version":3,"file":"index.cjs.js","sources":["../../sdk-template/src/batch-sender.ts","../../sdk-template/src/utils/misc.ts","../../sdk-template/src/utils/is.ts","../../sdk-template/src/utils/object-array.ts","../../sdk-template/src/utils/string.ts","../../sdk-template/src/utils/hook-object.ts","../../sdk-template/src/utils/logger.ts","../../sdk-template/src/utils/number.ts","../../sdk-template/src/utils/uuid.ts","../../sdk-template/src/utils/time.ts","../../sdk-template/src/utils/observable.ts","../../sdk-template/src/plugins/subject.ts","../src/utils/defaults.ts","../src/utils/registry.ts","../src/utils/apply-defaults.ts","../src/utils/date.ts","../src/utils/url.ts","../src/utils/capture.ts","../src/utils/cookie.ts","../src/utils/dom.ts","../src/utils/misc.ts","../src/utils/storage.ts","../src/collector/http.ts","../src/collector/pref.ts","../src/monitors/http/trace.ts","../src/monitors/http/util.ts","../src/monitors/http/xhr.ts","../src/plugins/monitors/utils.ts","../src/plugins/monitors/ajax.ts","../src/monitors/breadcrumb/util.ts","../src/monitors/breadcrumb/index.ts","../src/plugins/monitors/breadcrumb.ts","../src/monitors/http/fetch.ts","../src/plugins/monitors/fetch.ts","../src/collector/error.ts","../src/monitors/js-error/util.ts","../src/monitors/js-error/capture-global.ts","../src/monitors/js-error/dedupe.ts","../src/monitors/js-error/index.ts","../src/plugins/monitors/js-error.ts","../src/collector/client.ts","../src/collector/route.ts","../src/monitors/pageview/util.ts","../src/monitors/pageview/index.ts","../src/plugins/monitors/pageview.ts","../src/collector/page.ts","../src/monitors/resource/index.ts","../src/plugins/monitors/resource.ts","../src/monitors/resource-error/util.ts","../src/monitors/resource-error/index.ts","../src/plugins/monitors/resource-error.ts","../src/monitors/performance/util.ts","../src/plugins/monitors/performance.ts","../src/monitors/performance-new/util.ts","../src/monitors/performance-new/paint.ts","../src/monitors/performance-new/tti.ts","../src/plugins/monitors/tti.ts","../src/monitors/performance-new/fmp.ts","../src/plugins/monitors/fmp.ts","../src/monitors/blank-screen/util.ts","../src/monitors/blank-screen/index.ts","../src/plugins/monitors/blank-screen.ts","../src/monitors/action/util.ts","../src/monitors/action/index.ts","../src/plugins/monitors/action.ts","../src/plugins/monitors/heatmap.ts","../src/monitors/performance-new/lcp.ts","../src/monitors/performance-new/fid.ts","../src/monitors/performance-new/cls.ts","../src/monitors/performance-new/longtask.ts","../src/monitors/performance-new/timing.ts","../src/monitors/performance-new/mpfid.ts","../src/plugins/monitors/performance-new.ts","../src/monitors/performance-new/spa.ts","../src/plugins/monitors/spa-load.ts","../src/plugins/custom.ts","../src/plugins/inject-network-type.ts","../src/plugins/sample.ts","../src/transports/beacon.ts","../src/transports/xhr.ts","../src/sender.ts"],"sourcesContent":["import { EventSender, SdkTransport } from './types'\n\nexport type BatchEvent<E> = {\n  ev_type: 'batch'\n  list: E[]\n}\n\nexport type FailureCallbackType = (err: Error, data: string) => void\n\nexport type BatchSender<E> = EventSender<E> & {\n  fail?: (callback: FailureCallbackType) => void\n  getSize: () => number\n  getWait: () => number\n  setSize: (v: number) => void\n  setWait: (v: number) => void\n  getEndpoint: () => string\n  setEndpoint: (v: string) => void\n  flush: () => void\n  getBatchData: () => string\n  clear: () => void\n}\nexport interface BatchSenderConfig {\n  endpoint: string\n  transport: SdkTransport\n  size?: number\n  wait?: number\n}\n\nconst DEFAULT_SIZE = 10\nconst DEFAULT_WAIT = 1000\n\nexport const stringifyBatch = (list: any[]): string =>\n  JSON.stringify({\n    ev_type: 'batch',\n    list,\n  })\n\nexport function createBatchSender<E>(config: BatchSenderConfig): BatchSender<E> {\n  const { transport } = config\n  let { endpoint, size = DEFAULT_SIZE, wait = DEFAULT_WAIT } = config\n  let batch = [] as E[]\n  let tid = 0\n  let fail: FailureCallbackType | undefined\n  const sender = {\n    getSize() {\n      return size\n    },\n    getWait() {\n      return wait\n    },\n    setSize(v: number) {\n      size = v\n    },\n    setWait(v: number) {\n      wait = v\n    },\n    getEndpoint() {\n      return endpoint\n    },\n    setEndpoint(v: string) {\n      endpoint = v\n    },\n    send(e: E) {\n      batch.push(e)\n      if (batch.length >= size) {\n        sendBatch.call(this)\n      }\n      clearTimeout(tid)\n      tid = (setTimeout as Window['setTimeout'])(sendBatch.bind(this), wait)\n    },\n    flush() {\n      clearTimeout(tid)\n      sendBatch.call(this)\n    },\n    getBatchData() {\n      return batch.length ? stringifyBatch(batch) : ''\n    },\n    clear() {\n      clearTimeout(tid)\n      batch = []\n    },\n    fail(cb: FailureCallbackType) {\n      fail = cb\n    },\n  }\n\n  function sendBatch(this: BatchSender<E>) {\n    if (!batch.length) {\n      return\n    }\n    const data = this.getBatchData()\n    transport.post({\n      url: endpoint,\n      data,\n      fail(err: Error) {\n        fail && fail(err, data)\n      },\n    })\n    batch = []\n  }\n\n  return sender\n}\n","export const noop = () => ({} as any)\n\nexport function id<T>(v: T): T {\n  return v\n}\n","// eslint-disable-next-line @typescript-eslint/ban-types\nexport function isObject(o: unknown): o is object {\n  return typeof o === 'object' && o !== null\n}\n\nexport function isInstanceOf(wat: any, base: any): boolean {\n  try {\n    return wat instanceof base\n  } catch (_e) {\n    return false\n  }\n}\n\nconst objProto = Object.prototype\nexport type PlainObject = Record<string | number | symbol, any>\n// https://stackoverflow.com/a/5878101\nexport function isPlainObject(o: unknown): o is PlainObject {\n  if (isObject(o)) {\n    if (typeof Object.getPrototypeOf === 'function') {\n      const proto = Object.getPrototypeOf(o)\n      return proto === objProto || proto === null\n    }\n\n    // cannot test, requires ES3\n    /* istanbul ignore next */\n    return objProto.toString.call(o) === '[object Object]'\n  }\n  return false\n}\n\nexport function isArray<T>(o: unknown): o is Array<T> {\n  return objProto.toString.call(o) === '[object Array]'\n}\n\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport function isFunction(o: unknown): o is Function {\n  return typeof o === 'function'\n}\n\nexport function isBoolean(o: unknown): o is boolean {\n  return typeof o === 'boolean'\n}\n\nexport function isNumber(o: unknown): o is number {\n  return typeof o === 'number'\n}\n\nexport function isString(o: unknown): o is string {\n  return typeof o === 'string'\n}\n\nexport function isEqual(a: any, b: any): boolean {\n  // special\n  if (isNumber(a) && isNaN(a)) {\n    return isNumber(b) && isNaN(b)\n  }\n  // same primitive or same object\n  if (a === b) {\n    return true\n  }\n\n  if (isObject(a)) {\n    if (isPlainObject(a)) {\n      return isPlainObject(b) && isEqualPlainObject(a, b)\n    } else if (isArray(a)) {\n      return isArray(b) && isEqualArray(a, b)\n      //TODO: handle TypedArray, Map, Set, ArrayLike\n    } else {\n      // different object\n      return false\n    }\n  }\n\n  // different primitive\n  return false\n}\nexport function isEqualPlainObject(a: PlainObject, b: PlainObject) {\n  for (const k in a) {\n    if (!isEqual(a[k], b[k])) {\n      return false\n    }\n  }\n  return true\n}\nexport function isEqualArray(a: any[], b: any[]) {\n  if (a.length !== b.length) {\n    return false\n  }\n  return a.every((v, i) => isEqual(v, b[i]))\n}\n\nexport function isError(wat: unknown): boolean {\n  switch (Object.prototype.toString.call(wat)) {\n    case '[object Error]':\n      return true\n    case '[object Exception]':\n      /* istanbul ignore next */\n      return true\n    case '[object DOMError]':\n      return true\n    case '[object DOMException]':\n      /* istanbul ignore next */\n      return true\n    default:\n      /* istanbul ignore next */\n      return wat instanceof Error\n  }\n}\n\nexport function isEvent(wat: any): boolean {\n  return typeof Event !== 'undefined' && isInstanceOf(wat, Event)\n}\n\nexport function isErrorEvent(what: unknown): what is ErrorEvent {\n  return Object.prototype.toString.call(what) === '[object ErrorEvent]'\n}\n\nexport function isPromiseRejectionEvent(what: unknown): what is PromiseRejectionEvent {\n  return Object.prototype.toString.call(what) === '[object PromiseRejectionEvent]'\n}\n","/* eslint-disable @typescript-eslint/prefer-optional-chain */\nimport { isArray, isFunction, isObject, isPlainObject } from './is'\n\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport function omit<T extends object, K extends (keyof T)[]>(\n  object: T,\n  ...keys: K\n): Pick<T, Exclude<keyof T, K[number]>> {\n  if (isObject(object)) {\n    const res = {} as Pick<T, Exclude<keyof T, K[number]>>\n    objectForIn(object, (k, v) => {\n      if (!arrayIncludes(keys, k)) {\n        res[k as any] = v\n      }\n    })\n    return res\n  }\n  return object\n}\n\nexport function hasKey<T>(object: T, key: string): boolean {\n  return Object.prototype.hasOwnProperty.call(object, key)\n}\n\nexport type ObjectForInCallback<O> = (index: keyof O, item: O[keyof O]) => void\nexport function objectForIn<O>(object: O, callback: ObjectForInCallback<O>) {\n  if (isObject(object)) {\n    for (const i in object) {\n      if (hasKey<typeof object>(object, i)) {\n        callback.call(null, i, object[i])\n      }\n    }\n  }\n}\n\nexport function filterObjectValueBy<T>(obj: Record<string, T>, p: (v: T) => boolean) {\n  if (!isObject(obj)) {\n    return obj\n  }\n\n  if (!isFunction(p)) {\n    return obj\n  }\n\n  const res = {} as Record<string, T>\n  objectForIn(obj, (key, value) => {\n    if (p(value)) {\n      res[key] = value\n    }\n  })\n\n  return res\n}\n\n// 把source对象中的内容深度赋给target, 数组覆盖\nexport function mergeDeepCopyArray<T>(...source: Partial<T>[]): T {\n  let result = {} as T\n  let k = 0\n  while (k < source.length) {\n    result = _mergeDeepCopyArray<T>(result, source[k++])\n  }\n\n  return result\n}\n\n// 把source对象中的内容深度赋给target, 数组合并\nexport function mergeDeepConcatArray<T>(...source: Partial<T>[]): T {\n  let result = {} as T\n  let k = 0\n  while (k < source.length) {\n    result = _mergeDeepMergeArray<T>(result, source[k++])\n  }\n\n  return result\n}\n\nfunction _mergeDeepCopyArray<T>(target: Partial<T>, source: Partial<T>): T {\n  const result: T = { ...target } as T\n  for (const key in source) {\n    if (hasKey(source, key) && source[key] !== undefined) {\n      if (isObject(source[key]) && isPlainObject(source[key])) {\n        result[key] = _mergeDeepCopyArray(isObject(target[key]) ? target[key]! : {}, source[key]!)\n      } else if (isArray(source[key])) {\n        result[key] = cloneArray(source[key] as unknown as unknown[]) as unknown as T[Extract<keyof T, string>]\n      } else {\n        result[key] = source[key]!\n      }\n    }\n  }\n  return result\n}\n\n// 递归赋值\nfunction _mergeDeepMergeArray<T>(target: Partial<T>, source: Partial<T>): T {\n  const result: T = { ...target } as T\n  for (const key in source) {\n    if (hasKey(source, key) && source[key] !== undefined) {\n      if (isObject(source[key]) && isPlainObject(source[key])) {\n        result[key] = _mergeDeepMergeArray(isObject(target[key]) ? target[key]! : {}, source[key]!)\n      } else if (isArray(source[key]) && isArray(target[key])) {\n        result[key] = _mergeDeepArray(target[key], source[key]) as unknown as T[Extract<keyof T, string>]\n      } else {\n        result[key] = source[key]!\n      }\n    }\n  }\n  return result\n}\n\nfunction _mergeDeepArray<T, U>(target: T[] | any, source: U[] | any): (T | U)[] {\n  const _target: T[] = isArray(target) ? (target as T[]) : []\n  const _source: U[] = isArray(source) ? (source as U[]) : []\n  return Array.prototype.concat.call(_target, _source).map((v) => {\n    if (v instanceof RegExp) {\n      return v\n    } else if (isObject(v) && isPlainObject(v)) {\n      return _mergeDeepMergeArray({}, v)\n    } else if (isArray(v)) {\n      return _mergeDeepArray([], v)\n    } else {\n      return v\n    }\n  })\n}\n\nexport function cloneArray<T extends any>(array: T[]) {\n  return array.slice()\n}\n\n// 检查数组中是否有元素\nexport function arrayIncludes<T>(array: T[], value: T) {\n  if (!isArray(array)) {\n    return false\n  }\n\n  if (array.length === 0) {\n    return false\n  }\n\n  let k = 0\n  while (k < array.length) {\n    if (array[k] === value) {\n      return true\n    }\n    k++\n  }\n\n  return false\n}\n\nexport const arrayRemove = <T>(arr: T[], e: T) => {\n  if (!isArray(arr)) {\n    return arr\n  }\n  const i = arr.indexOf(e)\n  if (i >= 0) {\n    const arr_ = arr.slice()\n    arr_.splice(i, 1)\n    return arr_\n  }\n  return arr\n}\n\nexport interface Visitor {\n  (target: any, property: string): any\n}\n\n/**\n * 按路径访问对象属性\n * @param target 待访问对象\n * @param property 访问属性路径\n * @param { (target: any, property: string): any } visitor 访问器\n */\nexport const safeVisit = (target: any, path: string, visitor: Visitor) => {\n  const paths = path.split('.')\n  let [method, ...rest] = paths\n  while (target && rest.length > 0) {\n    target = target[method]\n    ;[method, ...rest] = rest\n  }\n  if (!target) {\n    return undefined\n  }\n  return visitor(target, method)\n}\n\nexport const safeSet = (target: any, path: string, value: any) => {\n  safeVisit(target, path, (obj: any, property: string) => {\n    try {\n      obj[property] = value\n    } catch (e) {\n      // ignore\n    }\n  })\n}\n\n/**\n *  按路径调用函数\n * @param target 待调用对象，如 `client`\n * @param methods 待调用方法路径，可能是一级路径 `client.start`, 或者是多级命令 `client.context.set`\n * @param args 调用参数\n */\nexport const safeCall = (target: any, method: string, args: any[]) => {\n  return safeVisit(target, method, (obj: any, property: string) => {\n    if (obj && property in obj && isFunction(obj[property])) {\n      try {\n        return obj[property].apply(obj, args)\n      } catch (err) {\n        // ignore\n        return undefined\n      }\n    }\n  })\n}\n\n/**\n *  按路径调用函数或获取值\n * @param target 待调用对象，如 `client`\n * @param methods 待调用方法路径或属性路径\n * @param args 调用参数\n */\nexport const safeCallOrGet = (target: any, method: string, args?: any[]) => {\n  return safeVisit(target, method, (obj: any, property: string) => {\n    if (obj && property in obj) {\n      // call\n      if ((args && args.length) || isFunction(obj[property])) {\n        try {\n          return obj[property].apply(obj, args)\n        } catch (err) {\n          // ignore\n          return undefined\n        }\n      } else {\n        // get\n        return obj[property]\n      }\n    }\n  })\n}\n\nexport const applyRecord = <K extends keyof any, T>() => {\n  const record: Record<K, T> = {} as any\n  const set = (key: K, val: T) => (record[key] = val)\n  const del = (key: K) => delete record[key]\n\n  return [record, set, del] as const\n}\n\nexport const pick = <T extends Record<string, unknown>, K extends (keyof T)[]>(obj: T, keys: K): Pick<T, K[number]> => {\n  if (!obj || !isObject(obj)) return obj\n\n  return keys.reduce((prev, cur) => {\n    prev[cur] = obj[cur]\n    return prev\n  }, {} as Pick<T, K[number]>)\n}\n","import { isArray, isString, isObject } from './is'\n\nexport type IgnoreRegExp = RegExp | null\nexport type IgnoreList = Array<string | RegExp>\n\nexport const camelToKebab = (str: string) => {\n  return str.replace(/([a-z])([A-Z])/g, (_, a, b) => `${a}-${b.toLowerCase()}`)\n}\n\nexport function getRegexp(ignore: IgnoreList) {\n  if (!isArray(ignore)) {\n    return null\n  }\n\n  return ignore.length ? joinRegExp(ignore) : null\n}\n\nexport function joinRegExp(patterns: IgnoreList) {\n  const sources: string[] = []\n  const len = patterns.length\n\n  for (let i = 0; i < len; i++) {\n    const pattern = patterns[i]\n    if (isString(pattern)) {\n      sources.push((pattern as string).replace(/([.*+?^=!:${}()|[\\]/\\\\])/g, '\\\\$1'))\n    } else if (pattern && (pattern as RegExp).source) {\n      sources.push((pattern as RegExp).source)\n    }\n  }\n  return new RegExp(sources.join('|'), 'i')\n}\n\nexport function safeStringify(a: unknown): string {\n  try {\n    return isString(a) ? a : JSON.stringify(a)\n  } catch (err) {\n    return '[FAILED_TO_STRINGIFY]:' + String(err)\n  }\n}\n\nexport function safeJoin(input: any[], delimiter?: string): string {\n  if (!isArray(input)) {\n    return ''\n  }\n\n  const output = []\n  // eslint-disable-next-line @typescript-eslint/prefer-for-of\n  for (let i = 0; i < input.length; i++) {\n    try {\n      output.push(String(input[i]))\n    } catch (e) {\n      output.push('[value cannot be serialized]')\n    }\n  }\n  return output.join(delimiter)\n}\n/**\n * get query string from map\n * @param  {Record<string | number, string | number>} map\n */\nexport const joinQueryWithMap = (map: Record<string | number, string | number | undefined>) => {\n  return isObject(map)\n    ? Object.keys(map)\n        .reduce((result, currentKey) => {\n          result += `&${currentKey}=${map[currentKey]}`\n          return result\n        }, '')\n        .replace('&', '?')\n    : ''\n}\n","import { isFunction } from './is'\nimport { noop } from './misc'\n\nexport interface RestoreFunction {\n  (strict?: boolean): void\n}\n\n// eslint-disable-next-line @typescript-eslint/ban-types\n/**\n * You can feel free to restore when you hook a function.\n * But you ought to restore 「in order」 if you hooked a value reference or a real obj reference.Because we not store the last value referent for now.\n * eg: obj.a = 1;\n * const r_1 = hookObjectProperty(obj, 'a',() =>2)()\n * const r_2 = hookObjectProperty(obj, 'a',() =>3)()\n * r_2() // obj.a === 2\n * r_1() // obj.a === 1\n *\n * @template T\n * @template K\n * @template P\n * @param {T} obj\n * @param {K} key\n * @param {(origin: T[K], ...params: P) => T[K]} hookFunc\n * @param {boolean} isCatchError When an error occurs after calling a hooked function, we want to suppress the errors and try to call the original function by default.\n * @return {*}\n */\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport const hookObjectProperty = <T extends {}, K extends keyof T, P extends any[]>(\n  obj: T,\n  key: K,\n  hookFunc: (origin: T[K], ...params: P) => T[K],\n  isCatchError = true,\n) => {\n  return (...params: P) => {\n    if (!obj) {\n      return noop\n    }\n    const origin = obj[key]\n    let hookedUnsafe = hookFunc(origin, ...params)\n    let hooked = hookedUnsafe\n\n    // 给所有 hook 之后的方法包一层 try catch\n    if (isFunction(hooked) && isCatchError) {\n      hooked = function (this: any, ...args: any) {\n        try {\n          return (hookedUnsafe as any).apply(this, args)\n        } catch {\n          return isFunction(origin) && origin.apply(this, args)\n        }\n      } as any as T[K]\n    }\n    obj[key] = hooked\n\n    // strict: is break\n    return (strict?: boolean) => {\n      if (!strict) {\n        hooked === obj[key] ? (obj[key] = origin) : (hookedUnsafe = origin)\n      }\n    }\n  }\n}\n\n/**\n * 劫持对象方法\n * 必须记得给 hookFunc 劫持的方法包 try catch ！\n * 不在本方法里包是为了避免对象原方法被调用两次\n */\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport const hookMethodDangerously = <T extends {}, K extends keyof T, P extends any[]>(\n  obj: T,\n  key: K,\n  hookFunc: (origin: T[K], ...params: P) => T[K],\n) => {\n  return (...params: P) => {\n    if (!obj) {\n      return noop\n    }\n\n    const origin = obj[key]\n    let hookedUnsafe = hookFunc(origin, ...params)\n    let hooked = hookedUnsafe\n\n    if (isFunction(hooked)) {\n      hooked = function (this: any, ...args: any) {\n        return (hookedUnsafe as any).apply(this, args)\n      } as any as T[K]\n    }\n\n    obj[key] = hooked\n    return () => {\n      hooked === obj[key] ? (obj[key] = origin) : (hookedUnsafe = origin)\n    }\n  }\n}\n","export const createLogger = (prefix: string, prefixLen = 20) => {\n  let count = 0\n  return (...args: any[]) => {\n    // eslint-disable-next-line no-console\n    console.log(prefix.padStart(prefixLen, ' '), Date.now(), `${count++}`.padStart(8, ' '), ...args)\n  }\n}\n\nlet count = 0\nexport const log = (...args: any[]) => {\n  // eslint-disable-next-line no-console\n  console.log('[SDK]', Date.now(), `${count++}`.padStart(8, ' '), ...args)\n}\n\nlet errCount = 0\nexport const error = (...args: any[]) => {\n  // eslint-disable-next-line no-console\n  console.error('[SDK]', Date.now(), `${errCount++}`.padStart(8, ' '), ...args)\n}\n\nlet warnCount = 0\nexport const warn = (...args: any[]) => {\n  // eslint-disable-next-line no-console\n  console.warn('[SDK]', Date.now(), `${warnCount++}`.padStart(8, ' '), ...args)\n}\n","export const isHitBySampleRate = (sampleRate: number): boolean => {\n  if (Math.random() < Number(sampleRate)) {\n    return true\n  }\n  return false\n}\n\nexport const isHitByRandom = (random: number, sampleRate: number): boolean => {\n  if (random < Number(sampleRate)) {\n    return true\n  }\n  return false\n}\n","/**\n * 生成uuid\n * stolen from https://github.com/kelektiv/node-uuid#readme uuid/v4\n *\n * @returns\n */\n\nfunction mathRNG() {\n  const rnds: number[] = new Array(16)\n\n  let r = 0\n\n  for (let i = 0; i < 16; i++) {\n    if ((i & 0x03) === 0) {\n      r = Math.random() * 0x100000000\n    }\n    rnds[i] = (r >>> ((i & 0x03) << 3)) & 0xff\n  }\n\n  return rnds\n}\n\nfunction bytesToUuid(buf: number[]) {\n  const byteToHex = [] as string[]\n  for (let index = 0; index < 256; ++index) {\n    byteToHex[index] = (index + 0x100).toString(16).substr(1)\n  }\n\n  let i = 0\n  const bth = byteToHex\n  // join used to fix memory issue caused by concatenation: https://bugs.chromium.org/p/v8/issues/detail?id=3175#c4\n  return [\n    bth[buf[i++]],\n    bth[buf[i++]],\n    bth[buf[i++]],\n    bth[buf[i++]],\n    '-',\n    bth[buf[i++]],\n    bth[buf[i++]],\n    '-',\n    bth[buf[i++]],\n    bth[buf[i++]],\n    '-',\n    bth[buf[i++]],\n    bth[buf[i++]],\n    '-',\n    bth[buf[i++]],\n    bth[buf[i++]],\n    bth[buf[i++]],\n    bth[buf[i++]],\n    bth[buf[i++]],\n    bth[buf[i++]],\n  ].join('')\n}\n\nfunction uuid() {\n  const rnds: number[] = mathRNG()\n\n  // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n  rnds[6] = (rnds[6] & 0x0f) | 0x40\n  rnds[8] = (rnds[8] & 0x3f) | 0x80\n\n  return bytesToUuid(rnds)\n}\n\nexport { uuid }\n","import { noop } from './misc'\n\nexport const BUFFER_TIME = 300000 // 5分钟\n\nexport const applyBufferTimer = (checkIfNeedCancel: () => boolean, cb: () => void, bufferTime: number) => {\n  let tid = 0\n  if (bufferTime === -1) return noop\n  return () => {\n    if (checkIfNeedCancel()) {\n      tid && clearTimeout(tid)\n      tid = 0\n      return\n    }\n    tid === 0 && (tid = (setTimeout as Window['setTimeout'])(cb, bufferTime))\n  }\n}\n","/* eslint-disable @typescript-eslint/no-invalid-void-type */\nimport { arrayRemove } from './object-array'\nimport { applyBufferTimer, BUFFER_TIME } from './time'\n\nexport type ParametersForFn<T extends (args: any) => any> = T extends (args: infer P) => any ? P : never\n\nexport type Observable<T extends (args: any) => any> = {\n  subscribe: (f: T) => () => void\n  unsubscribe: (f: T) => void\n  next: (args: ParametersForFn<T>) => ReturnType<NextLink<T>>\n  attach: (disconnect: () => void, onSubscribe?: (f: T) => void) => void\n  complete: (f: () => void) => void\n}\n\nexport type SafeObservable<T> = [(f: T) => () => void, (f: T) => void]\n\nexport type Observer<T extends (args: any) => any> = (\n  next: (args: ParametersForFn<T>) => ReturnType<NextLink<T>>,\n  attach: (disconnect: () => void, onSubscribe?: (f: T) => void) => void,\n) => void\n\nexport type NextLink<T extends (args: any) => any> = (args: ParametersForFn<T>, cb: T[]) => NextLink<ReturnType<T>>\n\nexport const nextLink = <T extends (args: any) => any>(args: ParametersForFn<T>, cb: T[]) => {\n  let nextCbs: ReturnType<T>[] = []\n  try {\n    nextCbs = cb.reduce((sum: ReturnType<T>[], s: T) => {\n      try {\n        const nextCb = s(args)\n        typeof nextCb === 'function' && sum.push(nextCb)\n      } catch {\n        // do nothing\n      }\n      return sum\n    }, [])\n  } catch {\n    // do nothing\n  }\n  return (nextArgs: ParametersForFn<ReturnType<T>>) => nextLink(nextArgs, nextCbs)\n}\n\nexport const toObservable = <T extends (args: any) => any>(bufferTime: number = BUFFER_TIME): Observable<T> => {\n  let subscribers: T[] = []\n  const __complete: (() => void)[] = []\n  let closed = false\n  let attachCb: [() => void, ((f: T) => void) | undefined] | undefined\n\n  // 暂缓的自动销毁机制，比如5min 没有人订阅就自动销毁\n  const setCloseIfNeed = applyBufferTimer(\n    () => !!subscribers.length,\n    () => {\n      closed = true\n      attachCb && attachCb[0]()\n      __complete.forEach((e) => e())\n      __complete.length = 0\n      attachCb = undefined\n    },\n    bufferTime,\n  )\n\n  const unsubscribe = (o: T) => {\n    subscribers = arrayRemove(subscribers, o)\n    !closed && setCloseIfNeed()\n  }\n  return {\n    next: (args: ParametersForFn<T>) => {\n      return nextLink(args, subscribers)\n    },\n    complete: (cb) => {\n      __complete.push(cb)\n    },\n    attach: (disconnect: () => void, onSubscribe?: (f: T) => void) => {\n      attachCb = [disconnect, onSubscribe]\n    },\n    subscribe: (o: T) => {\n      if (closed) throw new Error('Observer is closed')\n      subscribers.push(o)\n      attachCb && attachCb[1] && attachCb[1](o)\n      setCloseIfNeed()\n      return () => unsubscribe(o)\n    },\n    unsubscribe,\n  }\n}\n\nexport const createSafeObserver = <T extends (args: any) => any>(\n  observer: Observer<T>,\n  completeCb?: () => void,\n  bufferTime?: number,\n): SafeObservable<T> => {\n  const cur = toObservable<T>(bufferTime)\n  try {\n    observer(cur.next, cur.attach)\n    completeCb && cur.complete(completeCb)\n  } catch {\n    //\n  }\n  return [cur.subscribe, cur.unsubscribe]\n}\n","import { AnyClient } from '../types'\nimport { Observer, createSafeObserver, SafeObservable } from '../utils/observable'\n\nexport type WithSubject<C extends AnyClient> = C & {\n  initSubject: <T extends (args: any) => any>(args: [subjectKey: string, collector: Observer<T>]) => SafeObservable<T>\n  getSubject: (key: string) => SafeObservable<any> | undefined\n  privateSubject: SubjectMap\n}\n\nexport type SubjectMap = { [key: string]: SafeObservable<any> | undefined }\n\nexport function SubjectPlugin(client: AnyClient, globalSubjectMap: SubjectMap | undefined) {\n  const subjectMap: SubjectMap = globalSubjectMap || {}\n  const initSubject = <T extends (args: any) => any>([subjectKey, observer]: [\n    string,\n    Observer<T>,\n  ]): SafeObservable<T> => {\n    if (!subjectMap[subjectKey])\n      subjectMap[subjectKey] = createSafeObserver(observer, () => {\n        subjectMap[subjectKey] = undefined\n      })\n    return subjectMap[subjectKey] as SafeObservable<T>\n  }\n  client.provide('initSubject', initSubject)\n  client.provide('getSubject', (key: string) => subjectMap[key])\n  client.provide('privateSubject', {})\n}\n\n/**\n * 由于 Observer 带有自动销毁机制，意味着subject 只支持同步注册并使用\n */\nexport function initSubjectInGlobal<T extends (args: any) => any>(\n  client: WithSubject<AnyClient>,\n  args: [subjectKey: string, observer: Observer<T>],\n) {\n  return client.initSubject(args)\n}\n\n/**\n * 此方法不会挂载到全局对象上，同时只支持同步注册并使用\n */\nexport function initPrivateSubject<T extends (args: any) => any>(\n  client: WithSubject<AnyClient>,\n  [subjectKey, observer]: [subjectKey: string, observer: Observer<T>],\n  bufferTime?: number,\n) {\n  const subjectMap = client.privateSubject || {}\n  if (!subjectMap[subjectKey])\n    subjectMap[subjectKey] = createSafeObserver(\n      observer,\n      () => {\n        subjectMap[subjectKey] = undefined\n      },\n      bufferTime,\n    )\n  return subjectMap[subjectKey] as SafeObservable<T>\n}\n","import { isFunction, isObject } from '@slardar/sdk-template'\n\nexport function getDefaultBrowser(): undefined | Window {\n  if (typeof window === 'object' && isObject(window)) return window\n}\n\nexport function getDefaultDocument(): undefined | Document {\n  if (typeof document === 'object' && isObject(document)) return document\n}\n\nexport function getDefaultLocation(): undefined | Location {\n  return getDefaultBrowser() && window.location\n}\n\nexport function getDefaultHistory(): undefined | History {\n  // eslint-disable-next-line compat/compat\n  return getDefaultBrowser() && window.history\n}\n\nexport function getDefaultPerformance(): undefined | Performance {\n  if (getDefaultBrowser() && isObject(window.performance)) return window.performance\n}\n\nexport function getDefaultPromise(): undefined | typeof Promise {\n  if (getDefaultBrowser() && 'Promise' in window) return Promise\n}\n\nexport function getDefaultXMLHttpRequest(): undefined | typeof XMLHttpRequest {\n  if (typeof XMLHttpRequest === 'function' && isFunction(XMLHttpRequest)) return XMLHttpRequest\n}\n\nexport function getDefaultFetch(): undefined | typeof window.fetch {\n  try {\n    // eslint-disable-next-line compat/compat\n    new Headers()\n    // eslint-disable-next-line compat/compat\n    new Request('')\n    // eslint-disable-next-line compat/compat\n    new Response()\n    // eslint-disable-next-line compat/compat\n    return window.fetch\n  } catch {\n    //\n  }\n}\n\nexport function getDefaultMutationObserver(): undefined | typeof MutationObserver {\n  if (getDefaultBrowser() && isFunction(window.MutationObserver)) return window.MutationObserver\n}\n\nexport function getDefaultPerformanceObserver(): undefined | typeof PerformanceObserver {\n  if (getDefaultBrowser() && isFunction(window.PerformanceObserver)) return window.PerformanceObserver\n}\n\nexport function getDefaultPerformanceTiming(): undefined | PerformanceTiming {\n  const performance = getDefaultPerformance()\n  if (performance && isObject(performance.timing)) return performance.timing\n}\n\nexport function getDefaultRaf(): undefined | Window['requestAnimationFrame'] {\n  if (getDefaultBrowser() && 'requestAnimationFrame' in window) {\n    return window.requestAnimationFrame\n  }\n}\n\nexport function getDefaultCaf(): undefined | Window['cancelAnimationFrame'] {\n  if (getDefaultBrowser() && 'cancelAnimationFrame' in window) {\n    return window.cancelAnimationFrame\n  }\n}\n\nexport function getDefaultNavigator(): undefined | Window['navigator'] {\n  if (getDefaultBrowser() && 'navigator' in window) {\n    return window.navigator\n  }\n}\n\nexport interface NetworkInformation {\n  readonly effectiveType?: string\n  readonly type?: string\n  readonly rtt?: number\n  onchange?: () => void\n}\nexport function getDefaultNetworkInformation(): undefined | NetworkInformation {\n  const navigator = getDefaultNavigator()\n  if (navigator) {\n    return (navigator as any).connection || (navigator as any).mozConnection || (navigator as any).webkitConnection\n  }\n}\n\nexport function getCurrentScript(): HTMLOrSVGScriptElement | null {\n  if (!document) return null\n  if (document.currentScript) return document.currentScript\n\n  // IE 8-10 support script readyState\n  // IE 11+ support stack trace\n  try {\n    throw new Error()\n  } catch (err: any) {\n    // Find the second match for the \"at\" string to get file src url from stack.\n    // Specifically works with the format of stack traces in IE.\n    let i = 0\n    const stackDetails = /at\\s+(.*)\\s+\\((.*):(\\d*):(\\d*)\\)/i.exec(err.stack)\n    // eslint-disable-next-line @typescript-eslint/prefer-optional-chain\n    const scriptLocation = (stackDetails && stackDetails[2]) || false\n    // eslint-disable-next-line @typescript-eslint/prefer-optional-chain\n    const line = (stackDetails && stackDetails[3]) || 0\n    const currentLocation = document.location.href.replace(document.location.hash, '')\n    let inlineScriptSource = ''\n    const scripts = document.getElementsByTagName('script') // Live NodeList collection\n\n    if (scriptLocation === currentLocation) {\n      const pageSource = document.documentElement.outerHTML\n      const inlineScriptSourceRegExp = new RegExp(\n        '(?:[^\\\\n]+?\\\\n){0,' + ((line as number) - 2) + '}[^<]*<script>([\\\\d\\\\D]*?)<\\\\/script>[\\\\d\\\\D]*',\n        'i',\n      )\n      inlineScriptSource = pageSource.replace(inlineScriptSourceRegExp, '$1').trim()\n    }\n\n    for (; i < scripts.length; i++) {\n      // If ready state is interactive, return the script tag\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n      // @ts-ignore\n      if (scripts[i].readyState === 'interactive') {\n        return scripts[i]\n      }\n\n      // If src matches, return the script tag\n      if (scripts[i].src === scriptLocation) {\n        return scripts[i]\n      }\n\n      // If inline source matches, return the script tag\n      if (\n        scriptLocation === currentLocation &&\n        scripts[i].innerHTML &&\n        scripts[i].innerHTML.trim() === inlineScriptSource\n      ) {\n        return scripts[i]\n      }\n    }\n\n    // If no match, return null\n    return null\n  }\n}\n","import { WithSubject, SubjectMap } from '@slardar/sdk-template'\n\nimport { WebClient } from '../types'\n\nimport { getDefaultBrowser } from './defaults'\n\nexport type SelfError = [Error, (Record<string, string> | undefined)?]\n\nexport interface LoadedPlugin {\n  name: string\n  version: string\n  apply: PluginApplyFn\n}\n\nexport interface PluginApplyFn {\n  (client: WithSubject<WebClient>): void\n}\n\nexport type SlardarRegistry = {\n  plugins: LoadedPlugin[]\n  errors: SelfError[] & {\n    observe?: (f: (v: SelfError) => void) => void\n  }\n  subject: SubjectMap\n}\n\n// 获取全局注册表\nexport const getGlobalRegistry = (global?: Record<string, any>) => {\n  if (!global) return\n\n  if (!global.__SLARDAR_REGISTRY__) {\n    global.__SLARDAR_REGISTRY__ = {\n      Slardar: {\n        plugins: [],\n        errors: [],\n        subject: {},\n      },\n    }\n  }\n  return global.__SLARDAR_REGISTRY__.Slardar as SlardarRegistry\n}\n\nexport const reportSelfError = (...errorInfo: SelfError) => {\n  const registry = getGlobalRegistry(getDefaultBrowser())\n  if (!registry) return\n  if (!registry.errors) {\n    registry.errors = []\n  }\n  registry.errors.push(errorInfo)\n}\n","/* eslint-disable @typescript-eslint/prefer-optional-chain */\n/* eslint-disable @typescript-eslint/prefer-nullish-coalescing */\nimport { isFunction, mergeDeepConcatArray, noop } from '@slardar/sdk-template'\n\nimport { CallBack, MabyTuple, MonitorConstructor } from '../types'\n\nimport { reportSelfError } from './registry'\n\nexport const applyMutationObserver = (\n  MutationObserver: typeof window.MutationObserver | undefined | null | false,\n  callback: MutationCallback,\n) => {\n  // eslint-disable-next-line compat/compat\n  const observer = MutationObserver && new MutationObserver(callback)\n\n  const observe = (target?: Node | null | false, options?: MutationObserverInit) => {\n    observer && target && observer.observe(target, options)\n  }\n\n  const disconnect = () => observer && observer.disconnect()\n\n  return [observe, disconnect] as const\n}\n\nexport const applyAnimationFrame = (\n  document?: Document,\n  originRAF?: Window['requestAnimationFrame'],\n  originCAF?: Window['cancelAnimationFrame'],\n  force?: boolean,\n) => {\n  const requestAnimationFrame =\n    // eslint-disable-next-line compat/compat\n    !isFunction(originRAF) || (force && document && document.hidden)\n      ? (cb: FrameRequestCallback) => {\n          cb(0)\n          return 0\n        }\n      : originRAF\n  const cancelAnimationFrame = isFunction(originCAF) ? originCAF : noop\n\n  /**\n   * 以 animationFrame 调用函数，如果一帧内多次调用，则会取消前面的调用\n   */\n  let af: number\n  const scheduleAnimationFrame = (cb: FrameRequestCallback) => {\n    af && cancelAnimationFrame(af)\n    af = requestAnimationFrame(cb)\n  }\n\n  return [scheduleAnimationFrame, requestAnimationFrame, cancelAnimationFrame] as const\n}\n\nexport const applyPerformance = (performance: Performance | undefined | null | false) => {\n  // eslint-disable-next-line compat/compat\n  const timing: PerformanceTiming | undefined = (performance && performance.timing) || undefined\n\n  const now = () => {\n    if (performance && performance.now) return performance.now()\n    const time = Date.now ? Date.now() : +new Date()\n    const start = (timing && timing.navigationStart) || 0\n    return time - start\n  }\n\n  const getEntriesByType = (type: string) => {\n    const { getEntriesByType } = performance || {}\n    return (isFunction(getEntriesByType) && getEntriesByType.call(performance, type)) || []\n  }\n\n  const getEntriesByName = (name: string) => {\n    const { getEntriesByName } = performance || {}\n    return (isFunction(getEntriesByName) && getEntriesByName.call(performance, name)) || []\n  }\n\n  const clearResourceTiming = () => {\n    const { clearResourceTimings } = performance || {}\n    isFunction(clearResourceTimings) && clearResourceTimings.call(performance)\n  }\n\n  return [timing, now, getEntriesByType, clearResourceTiming, getEntriesByName] as const\n}\n\nexport const applyPerformanceObserver = <C extends PerformanceEntry = PerformanceEntry>(\n  PerformanceObserver: typeof window.PerformanceObserver | undefined | null | false,\n  callback: (entry: C, index: number, array: C[], ob: PerformanceObserver) => void,\n  once?: boolean,\n  onFail?: () => void,\n) => {\n  const observer =\n    PerformanceObserver &&\n    // eslint-disable-next-line compat/compat\n    new PerformanceObserver((list, ob) => {\n      if (list.getEntries) {\n        list.getEntries().forEach((val, i, arr) => callback(val as C, i, arr as C[], ob))\n      } else {\n        onFail && onFail()\n      }\n      once && ob.disconnect()\n    })\n\n  const observe = (...types: string[]) => {\n    if (!PerformanceObserver || !observer) return onFail && onFail()\n    try {\n      types.forEach((type) => {\n        if (PerformanceObserver.supportedEntryTypes.indexOf(type) > -1) {\n          observer.observe({ type, buffered: false })\n        }\n      })\n    } catch {\n      try {\n        observer.observe({ entryTypes: types })\n      } catch {\n        return onFail && onFail()\n      }\n    }\n  }\n\n  const disconnect = () => observer && observer.disconnect()\n\n  return [observe, disconnect] as const\n}\n\n// eslint-disable-next-line @typescript-eslint/no-invalid-void-type\nexport const applyMonitor = <O, S, D extends any[], R extends any[] | undefined | void>(\n  monitorCtor: MonitorConstructor<O, S, D, R>,\n  props: O = {} as O,\n  cb?: CallBack<S>,\n  deps: MabyTuple<D> = [] as any,\n): R => {\n  try {\n    const monitor = monitorCtor(...deps)\n    return (monitor && monitor(props, cb)) || ([] as any)\n  } catch (e) {\n    reportSelfError(e)\n    return [] as any\n  }\n}\n\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport const applyUpdate = <T extends {}>(init: T) => {\n  let state = init\n  const result: T = {} as any\n  const defineGetter = () =>\n    Object.keys(state).forEach(\n      (key) =>\n        !(key in result) &&\n        Object.defineProperty(result, key, {\n          get: function () {\n            return state[key]\n          },\n        }),\n    )\n\n  const update = (newObj: Partial<T>) => {\n    state = mergeDeepConcatArray(state, newObj)\n    defineGetter()\n  }\n\n  defineGetter()\n  return [result, update] as const\n}\n\nexport const applyRequestIdleCallback = (win: Window | undefined) => {\n  return (\n    win!.requestIdleCallback ||\n    function (cb: () => void) {\n      return win!.setTimeout(cb, 1)\n    }\n  )\n}\n","export const now = () => Date.now()\n","import { getDefaultBrowser, getDefaultDocument, getDefaultLocation } from './defaults'\n\nexport interface ParsedUrl {\n  url: string\n  protocol: string\n  domain: string\n  query: string\n  path: string\n  hash: string\n}\n\nexport function getFullUrl(url: string): string {\n  const document = getDefaultDocument()\n  if (!document || !url) return ''\n\n  const a = document.createElement('a')\n  a.href = url\n\n  return a.href\n}\n\nexport function parseUrl(url: string): ParsedUrl {\n  const document = getDefaultDocument()\n  if (!document || !url) {\n    return {\n      url,\n      protocol: '',\n      domain: '',\n      query: '',\n      path: '',\n      hash: '',\n    }\n  }\n\n  const a = document.createElement('a')\n  a.href = url\n\n  let path = a.pathname || '/'\n  /* istanbul ignore next */\n  if (path[0] !== '/') {\n    path = '/' + path\n  }\n\n  return {\n    url: a.href,\n    protocol: a.protocol.slice(0, -1),\n    domain: a.hostname,\n    query: a.search.substring(1),\n    path,\n    hash: a.hash,\n  }\n}\n\nexport function getLocationUrl(): string | undefined {\n  const location = getDefaultBrowser() && getDefaultLocation()\n  return location?.href\n}\n","import { WebClient, WebReportEvent, CapturedContext } from '../types'\n\nimport { now } from './date'\nimport { getLocationUrl } from './url'\n\nexport const captureCurrentContext = <C extends WebClient>(client: C) => {\n  const capturedContext: CapturedContext = {\n    url: getLocationUrl(),\n    timestamp: now(),\n  }\n  const config = client.config()\n  if (config?.pid) {\n    capturedContext.pid = config.pid\n  }\n  if (client?.['context']) {\n    capturedContext.context = client['context'].toString()\n  }\n  return capturedContext\n}\n\n// only works for sync report\n// async report won't trigger 'report' immediately, es.g. sri\nexport const syncReportWithCapturedContext =\n  <C extends WebClient>(client: C, ctx: CapturedContext) =>\n  (fn: () => void) => {\n    const inject = (ev: WebReportEvent) => {\n      ev.overrides = ctx\n      return ev\n    }\n    client.on('report', inject as any)\n    fn()\n    client.off('report', inject as any)\n  }\n","/* eslint-disable @typescript-eslint/prefer-for-of */\nimport { isString } from '@slardar/sdk-template'\n\nimport { getDefaultDocument } from './defaults'\n\nexport const getCookieId = (cookieIdName: string) => {\n  const document = getDefaultDocument()\n  try {\n    if (document?.cookie) {\n      return getValueFromCookieName(document.cookie, cookieIdName)\n    }\n  } catch (_e) {\n    // do nothing\n  }\n  return ''\n}\n\nexport const setCookie = (key: string, value: string) => {\n  const document = getDefaultDocument()\n  if (document && key) {\n    try {\n      document.cookie = `${key}=${value};max-age=${90 * 24 * 60 * 60}`\n    } catch (_e) {\n      // do nothing\n    }\n  }\n}\n\nexport function getValueFromCookieName(cookie: string, name: string) {\n  if (!cookie || !name) {\n    return ''\n  }\n  return parseCookie(cookie)[name] || ''\n}\n\nfunction parseCookie(cookie: string): Record<string, string> {\n  const list = cookie.split(';')\n  const cookieObj = {}\n\n  for (let i = 0; i < list.length; i++) {\n    const pair = list[i].split('=')\n    const cookieKey = isString(pair[0]) && pair[0].trim()\n    if (cookieKey && isString(pair[1])) {\n      cookieObj[cookieKey] = pair[1].trim()\n    }\n  }\n\n  return cookieObj\n}\n","/**\n * from sentry https://github.com/getsentry/sentry-javascript/blob/5.30.0/packages/utils/src/browser.ts\n */\n\nimport { isString } from '@slardar/sdk-template'\n\nimport { Breadcrumb } from '../types'\n\nexport const UNKNOWN_PATH = '<unknown>'\n\n/**\n * Given a child DOM element, returns a query-selector statement describing that\n * and its ancestors\n * e.g. [HTMLElement] => body > div > input#foo.btn[name=baz]\n * @returns generated DOM path\n */\nexport function htmlTreeAsString(elem: unknown): string {\n  type SimpleNode = {\n    parentNode: SimpleNode\n  } | null\n\n  // try/catch both:\n  // - accessing event.target (see getsentry/raven-js#838, #768)\n  // - `htmlTreeAsString` because it's complex, and just accessing the DOM incorrectly\n  // - can throw an exception in some circumstances.\n  try {\n    let currentElem = elem as SimpleNode\n    const MAX_TRAVERSE_HEIGHT = 5\n    const MAX_OUTPUT_LEN = 80\n    const out: string[] = []\n    let height = 0\n    let len = 0\n    const separator = ' > '\n    const sepLength = separator.length\n    let nextStr\n\n    while (currentElem && height++ < MAX_TRAVERSE_HEIGHT) {\n      nextStr = _htmlElementAsString(currentElem)\n      // bail out if\n      // - nextStr is the 'html' element\n      // - the length of the string that would be created exceeds MAX_OUTPUT_LEN\n      //   (ignore this limit if we are on the first iteration)\n      if (nextStr === 'html' || (height > 1 && len + out.length * sepLength + nextStr.length >= MAX_OUTPUT_LEN)) {\n        break\n      }\n\n      out.push(nextStr)\n\n      len += nextStr.length\n      currentElem = currentElem.parentNode\n    }\n\n    return out.reverse().join(separator)\n  } catch (_oO) {\n    return UNKNOWN_PATH\n  }\n}\n\n/**\n * Returns a simple, query-selector representation of a DOM element\n * e.g. [HTMLElement] => input#foo.btn[name=baz]\n * @returns generated DOM path\n */\nfunction _htmlElementAsString(el: unknown): string {\n  const elem = el as {\n    getAttribute: (key: string) => string // tslint:disable-line:completed-docs\n    tagName?: string\n    id?: string\n    className?: string\n  }\n\n  const out: string[] = []\n  let classes\n  let key\n  let attr\n  let i\n\n  if (!elem || !elem.tagName) {\n    return ''\n  }\n\n  out.push(elem.tagName.toLowerCase())\n  if (elem.id) {\n    out.push(`#${elem.id}`)\n  }\n\n  const className = elem.className\n  if (className && isString(className)) {\n    classes = className.split(/\\s+/)\n    for (i = 0; i < classes.length; i++) {\n      out.push(`.${classes[i]}`)\n    }\n  }\n  const attrlist = ['type', 'name', 'title', 'alt']\n  for (i = 0; i < attrlist.length; i++) {\n    key = attrlist[i]\n    attr = elem.getAttribute(key)\n    if (attr) {\n      out.push(`[${key}=\"${attr}\"]`)\n    }\n  }\n  return out.join('')\n}\n\ntype InstrumentHandlerType = 'dom'\n\nexport const applyDomAndKeyPress = (debounceDuration: number) => {\n  let keypressTimeout: number | undefined\n\n  /**\n   * Wraps addEventListener to capture UI breadcrumbs\n   * @param name the event name (e.g. \"click\")\n   * @param handler function that will be triggered\n   * @param debounce decides whether it should wait till another event loop\n   * @returns wrapped breadcrumb events handler\n   * @hidden\n   */\n  const domEventHandler = (name: string, handler: (params: { event: Event; name: string }) => void) => {\n    let lastCapturedEvent: Event | undefined\n\n    return (event: Event) => {\n      // reset keypress timeout; e.g. triggering a 'click' after\n      // a 'keypress' will reset the keypress debounce so that a new\n      // set of keypresses can be recorded\n      keypressTimeout = undefined\n      // It's possible this handler might trigger multiple times for the same\n      // event (e.g. event propagation through node ancestors). Ignore if we've\n      // already captured the event.\n      if (!event || lastCapturedEvent === event) {\n        return\n      }\n\n      lastCapturedEvent = event\n      handler({ event, name })\n    }\n  }\n\n  /**\n   * Wraps addEventListener to capture keypress UI events\n   * @param handler function that will be triggered\n   * @returns wrapped keypress events handler\n   * @hidden\n   */\n  const keypressEventHandler = (handler: (params: { event: Event; name: string }) => void) => {\n    // TODO: if somehow user switches keypress target before\n    //       debounce timeout is triggered, we will only capture\n    //       a single breadcrumb from the FIRST target (acceptable?)\n    return (event: Event) => {\n      let target\n\n      try {\n        target = event.target\n      } catch (e) {\n        // just accessing event properties can throw an exception in some rare circumstances\n        // see: https://github.com/getsentry/raven-js/issues/838\n        return\n      }\n\n      const tagName = target && (target as HTMLElement).tagName\n\n      // only consider keypress events on actual input elements\n      // this will disregard keypresses targeting body (e.g. tabbing\n      // through elements, hotkeys, etc)\n      if (!tagName || (tagName !== 'INPUT' && tagName !== 'TEXTAREA' && !(target as HTMLElement).isContentEditable)) {\n        return\n      }\n\n      // record first keypress in a series, but ignore subsequent\n      // keypresses until debounce clears\n      !keypressTimeout && domEventHandler('input', handler)(event)\n      clearTimeout(keypressTimeout)\n\n      keypressTimeout = window.setTimeout(() => {\n        keypressTimeout = undefined\n      }, debounceDuration)\n    }\n  }\n\n  return [domEventHandler, keypressEventHandler] as const\n}\n\nexport const triggerHandlers =\n  (domBreadcrumb: (handlerData: { event: Event; name: string }) => void, type: InstrumentHandlerType) =>\n  (data: { event: Event; name: string }) => {\n    if (!type) {\n      return\n    }\n\n    try {\n      domBreadcrumb(data)\n    } catch (e) {\n      // ignore\n    }\n  }\n\n/**\n * Creates breadcrumbs from DOM API calls\n */\nexport const domBreadcrumb =\n  (addBreadcrumb: (bd: Breadcrumb) => void) => (handlerData: { event: Event; name: string }) => {\n    let target\n\n    // Accessing event.target can throw (see getsentry/raven-js#838, #768)\n    try {\n      target = handlerData.event.target\n        ? htmlTreeAsString(handlerData.event.target as Node)\n        : htmlTreeAsString(handlerData.event as unknown as Node)\n    } catch (e) {\n      target = '<unknown>'\n    }\n\n    if (target.length === 0) {\n      return\n    }\n\n    addBreadcrumb({\n      type: 'dom',\n      category: `ui.${handlerData.name}`,\n      message: target,\n    } as Breadcrumb)\n  }\n","/* eslint-disable @typescript-eslint/prefer-optional-chain */\nimport { isObject } from '@slardar/sdk-template'\n\nimport { CallBack } from '../types'\n\nimport { getDefaultBrowser, getDefaultDocument } from './defaults'\n\nexport function onPageLoad(callback: () => void) {\n  const window = getDefaultBrowser()\n  const document = getDefaultDocument()\n  if (!window || !document) return\n\n  if (document.readyState === 'complete') {\n    callback()\n    return\n  }\n  window.addEventListener(\n    'load',\n    () => {\n      setTimeout(() => {\n        callback()\n      }, 0)\n    },\n    false,\n  )\n}\n\nexport function onDOMContentLoaded(callback: () => void) {\n  const window = getDefaultBrowser()\n  const document = getDefaultDocument()\n  if (!window || !document) return\n\n  if (document.readyState === 'loading') {\n    window.addEventListener(\n      'DOMContentLoaded',\n      () => {\n        setTimeout(() => {\n          callback()\n        }, 0)\n      },\n      false,\n    )\n    return\n  }\n  callback()\n}\nexport interface OnPageUnloadCallback {\n  (event: Event): void\n}\nexport interface PageHiddenCallback {\n  (): void\n}\n\nexport const invokeCallbackOnce = <T>(cb?: CallBack<T>): [(params: T) => void] => {\n  let hasInvoked = false\n  const invoke = (params: T) => {\n    if (hasInvoked) return\n    hasInvoked = true\n    cb && cb(params)\n  }\n  return [invoke]\n}\n\nexport const onPageUnload = (cb: OnPageUnloadCallback) => {\n  const window = getDefaultBrowser()\n  if (!window) return\n\n  const [invokeCbOnce] = invokeCallbackOnce<Event>(cb)\n\n  ;['unload', 'beforeunload', 'pagehide'].forEach((ev) => {\n    window.addEventListener(ev, invokeCbOnce)\n  })\n}\n\nexport const onceHidden = (cb: PageHiddenCallback, once = true) => {\n  const document = getDefaultDocument()\n  const window = getDefaultBrowser()\n\n  if (!document || !window) return\n\n  if (document.visibilityState === 'hidden') {\n    cb()\n    return\n  }\n  const onVisibilityChange = () => {\n    if (document.visibilityState === 'hidden') {\n      cb()\n      once && removeEventListener('visibilitychange', onVisibilityChange, true)\n    }\n  }\n  window.addEventListener('visibilitychange', onVisibilityChange, true)\n}\n\nexport const loadScript = (url: string, callback: () => void) => {\n  /* istanbul ignore next */\n  const document = getDefaultDocument()\n  // untestable for now\n  /* istanbul ignore next */\n  if (document) {\n    const script = document.createElement('script')\n\n    script.src = url\n    script.crossOrigin = 'anonymous'\n    script.onload = callback\n\n    document.head?.appendChild(script)\n  }\n}\n\nexport const getConfig = <T>(c: Partial<T> | boolean | undefined | null, defaultConfig: T): T | false => {\n  if (isObject(c)) {\n    return { ...defaultConfig, ...c }\n  } else {\n    return c ? defaultConfig : false\n  }\n}\n","/* eslint-disable @typescript-eslint/prefer-nullish-coalescing */\nexport const getStorageItem = (name: string) => {\n  try {\n    const value = localStorage.getItem(name)\n    let ret = value\n    if (value && typeof value === 'string') {\n      ret = JSON.parse(value)\n    }\n    return ret\n  } catch (_e) {\n    return undefined\n  }\n}\n\nexport const setStorageItem = (key: string, value: any) => {\n  try {\n    const stringValue = typeof value === 'string' ? value : JSON.stringify(value)\n    localStorage.setItem(key, stringValue)\n  } catch (_o) {\n    // do nothing\n  }\n}\n\nexport const removeStorageItem = (key: string) => {\n  try {\n    localStorage.removeItem(key)\n  } catch (_o) {\n    // do nothing\n  }\n}\n","import { hookMethodDangerously, Observer, NextLink, ParametersForFn } from '@slardar/sdk-template'\n\nimport { now, getDefaultBrowser } from '../utils'\n\nexport const XHR_SUBJECT_NAME = 'xhr_0'\n\nexport type XHRNext = ([_method, _url, _start, xhr]: [\n  _method: string,\n  _url: string,\n  _start: number,\n  xhr: NewXMLHttpRequest,\n]) => (xhr: NewXMLHttpRequest) => void\n\nexport interface NewXMLHttpRequest extends XMLHttpRequest {\n  _url: string\n  _method: string\n  _start: number\n  _data: Parameters<XMLHttpRequest['send']>[0]\n  _reqHeaders?: Record<string, string>\n}\n\nconst hookOpen = (open: XMLHttpRequest['open']) =>\n  function (this: NewXMLHttpRequest, ...openOptions: Parameters<XMLHttpRequest['open']>) {\n    // @ts-expect-error\n    ;[this._method, this._url] = openOptions\n    return open.apply(this, openOptions)\n  } as XMLHttpRequest['open']\n\nconst hookSetHeader = (setRequestHeader?: XMLHttpRequest['setRequestHeader']) =>\n  function (this: NewXMLHttpRequest, ...setOptions: Parameters<XMLHttpRequest['setRequestHeader']>) {\n    this._reqHeaders = this._reqHeaders || {}\n    const [name, value] = setOptions\n    this._reqHeaders[name] = value\n    return setRequestHeader && setRequestHeader.apply(this, setOptions)\n  }\n\nconst hookOnreadystatechange = (xhr: NewXMLHttpRequest, endNext: ReturnType<NextLink<XHRNext>>) =>\n  hookMethodDangerously(\n    xhr,\n    'onreadystatechange',\n    (origin) =>\n      function (this: XMLHttpRequest, ...ev: [ev: Event]) {\n        // @ts-expect-error\n        this.readyState === 4 && endNext(xhr)\n        return origin && origin.apply(this, ev)\n      },\n  )\n\nconst hookSend = (\n  send: XMLHttpRequest['send'],\n  next: (args: ParametersForFn<XHRNext>) => ReturnType<NextLink<XHRNext>>,\n) => {\n  return function (this: NewXMLHttpRequest, ...sendOptions: Parameters<XMLHttpRequest['send']>) {\n    this._start = now()\n    this._data = sendOptions?.[0]\n    const endNext = next([this._method, this._url, this._start, this])\n    hookOnreadystatechange(this, endNext)()\n    return send.apply(this, sendOptions)\n  }\n}\n\nexport const applyXHR = (xhr?: XMLHttpRequest): Observer<XHRNext> => {\n  return (next, tearDown) => {\n    if (!xhr) return\n    const tearDownGroup: (() => void)[] = []\n    tearDownGroup.push(hookMethodDangerously(xhr, 'open', hookOpen)())\n    tearDownGroup.push(hookMethodDangerously(xhr, 'setRequestHeader', hookSetHeader)())\n    tearDownGroup.push(hookMethodDangerously(xhr, 'send', hookSend)(next))\n    tearDown(() => {\n      tearDownGroup.forEach((e) => e())\n    })\n  }\n}\n\nexport const FETCH_SUBJECT_NAME = 'fetch_0'\n\nexport type FetchNext = ([req, options]: [req: Request | string, options: RequestInit]) => (res?: Response) => void\n\nexport const hookFetch =\n  (\n    _fetch: typeof window.fetch,\n    next: (args: ParametersForFn<FetchNext>) => ReturnType<NextLink<FetchNext>>,\n  ): typeof window.fetch =>\n  (req, options = {}) => {\n    const endNext = next([req, options])\n    const fetchPromise = _fetch(req, options)\n\n    fetchPromise.then(\n      (res: Response) => {\n        // @ts-expect-error\n        endNext(res)\n      },\n      () => {\n        // @ts-expect-error\n        endNext(undefined)\n      },\n    )\n\n    return fetchPromise\n  }\n\nexport const observeFetch: Observer<FetchNext> = (next, tearDown) => {\n  const global = getDefaultBrowser()\n  if (!global || !fetch) return\n\n  const tearDownGroup: (() => void)[] = []\n  tearDownGroup.push(hookMethodDangerously(global, 'fetch', hookFetch)(next))\n  tearDown(() => {\n    tearDownGroup.forEach((e) => e())\n  })\n}\n\nexport const fetchSubject: [string, Observer<FetchNext>] = [FETCH_SUBJECT_NAME, observeFetch]\n","import { Observer } from '@slardar/sdk-template'\n\nimport { getDefaultPerformanceObserver } from '../utils'\n\nexport const PERFORMANCE_EVENT_TYPE = ['first-input', 'paint', 'navigation'] // used by paintMonitor / fidMonitor / timingMonitor\n\nexport const RESOURCE_TYPE = ['resource'] // used by resourceMonitor / resourceErrorMonitor / HttpMonitor\n\nexport const LONGTASK_TYPE = ['longtask'] // used by ttiMonitor / longtaskMonitor / actionMonitor / mpfidMonitor\n\nconst applyPerformanceObserver = <C extends PerformanceEntry = PerformanceEntry>(\n  PerformanceObserver: typeof window.PerformanceObserver | undefined | null | false,\n  callback: (entry: C, index: number, array: C[], ob: PerformanceObserver) => void,\n  onFail?: () => void,\n) => {\n  const observer =\n    PerformanceObserver &&\n    new PerformanceObserver((list, ob) => {\n      if (list.getEntries) {\n        list.getEntries().forEach((val, i, arr) => callback(val as C, i, arr as C[], ob))\n      } else {\n        onFail && onFail()\n      }\n    })\n\n  const observe = (types: string[]) => {\n    if (!PerformanceObserver || !observer) return onFail && onFail()\n    try {\n      observer.observe({ entryTypes: types })\n    } catch {\n      return onFail && onFail()\n    }\n  }\n\n  const bufferedObserver = (type: string) => {\n    if (!PerformanceObserver || !observer) return onFail && onFail()\n    try {\n      observer.observe({ type, buffered: true })\n    } catch {\n      return onFail && onFail()\n    }\n    observer.observe({ type, buffered: false })\n  }\n\n  const disconnect = () => observer && observer.disconnect()\n\n  return [observe, bufferedObserver, disconnect] as const\n}\n\nexport const observePerf = <C extends PerformanceEntry = PerformanceEntry>(\n  Ob: typeof window.PerformanceObserver,\n  pipe: (entry: C) => void,\n  types: string[],\n) => {\n  const [observe, , disconnect] = applyPerformanceObserver<C>(Ob, pipe)\n  observe(types)\n  return disconnect\n}\n\nexport const observePerfWithBuffer = <C extends PerformanceEntry = PerformanceEntry>(\n  Ob: typeof window.PerformanceObserver,\n  pipe: (entry: C) => void,\n  type: string,\n) => {\n  const [, bufferedObserver, disconnect] = applyPerformanceObserver<C>(Ob, pipe)\n  bufferedObserver(type)\n  return disconnect\n}\n\nexport const LONGTASK_SUBJECT_NAME = 'longtask_0'\n\nexport type LongtaskNext = (args: PerformanceEntry) => void\n\nexport const observeLongtask: Observer<LongtaskNext> = (next, tearDown) => {\n  const PerformanceObserver = getDefaultPerformanceObserver()\n  if (!PerformanceObserver) return\n  tearDown(observePerf(PerformanceObserver, next, LONGTASK_TYPE))\n}\n\nexport const longtaskSubject: [string, Observer<LongtaskNext>] = [LONGTASK_SUBJECT_NAME, observeLongtask]\n\nexport const RESOURCE_SUBJECT_NAME = 'resource_0'\n\nexport type ResourceNext = (args: PerformanceResourceTiming) => void\n\nexport const observeResource: Observer<ResourceNext> = (next, tearDown) => {\n  const PerformanceObserver = getDefaultPerformanceObserver()\n  if (!PerformanceObserver) return\n  tearDown(observePerf(PerformanceObserver, next, RESOURCE_TYPE))\n}\n\nexport const resourceSubject: [string, Observer<ResourceNext>] = [RESOURCE_SUBJECT_NAME, observeResource]\n","import { isHitBySampleRate } from '@slardar/sdk-template'\n\nimport { getConfig } from '../../utils'\n\nimport { TraceConfig } from './type'\n\nconst VERSION = '03'\n\nconst SAMPLED = '01'\n\nconst TRACEPARENT = 'traceparent'\n\nconst DEFAULT_TRACE_CONFIG: TraceConfig = {\n  sampleRate: 1,\n  origins: [],\n}\n\ninterface MsCryptoWindow extends Window {\n  msCrypto?: Crypto\n}\n\nexport const uuid4 = (): string => {\n  const crypto = window.crypto || (window as MsCryptoWindow).msCrypto\n\n  if (crypto !== void 0 && crypto.getRandomValues) {\n    const arr = new Uint16Array(8)\n    crypto.getRandomValues(arr)\n    const pad = (num: number): string => {\n      let v = num.toString(16)\n      while (v.length < 4) {\n        v = `0${v}`\n      }\n      return v\n    }\n\n    return pad(arr[0]) + pad(arr[1]) + pad(arr[2]) + pad(arr[3]) + pad(arr[4]) + pad(arr[5]) + pad(arr[6]) + pad(arr[7])\n  }\n\n  return 'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'.replace(/[x]/g, () => {\n    const r = (Math.random() * 16) | 0\n    return r.toString(16)\n  })\n}\n\nexport const setTraceContext = (traceConfig: Partial<TraceConfig> | boolean | undefined) => {\n  const config = getConfig(traceConfig, DEFAULT_TRACE_CONFIG)\n  if (!config) return\n\n  const sampled = isHitBySampleRate(config.sampleRate!)\n  if (!sampled) return\n\n  return (url: string, cb: (key: string, value: string) => void) => {\n    const { origins } = config\n    if (origins.length && Boolean(url.match(new RegExp(origins.join('|'))))) {\n      cb(TRACEPARENT, `${VERSION}-${uuid4()}-${uuid4().substring(16)}-${SAMPLED}`)\n    }\n  }\n}\n\nexport const setVolTraceContext = (traceConfig: Partial<TraceConfig> | boolean | undefined, tracestate: string) => {\n  const config = getConfig(traceConfig, DEFAULT_TRACE_CONFIG)\n  if (!config) return\n\n  const sampled = isHitBySampleRate(config.sampleRate!)\n  if (!sampled) return\n\n  return (url: string, cb: (key: string, value: string) => void) => {\n    const { origins } = config\n    if (origins.length && Boolean(url.match(new RegExp(origins.join('|'))))) {\n      cb('x-rum-traceparent', `00-${uuid4()}-${uuid4().substring(16)}-${SAMPLED}`)\n      cb('x-rum-tracestate', tracestate)\n    }\n  }\n}\n","import { getRegexp } from '@slardar/sdk-template'\n\nimport { applyPerformance } from '../../utils'\n\nconst headerKeyRe = new RegExp('(cookie|auth|jwt|token|key|ticket|secret|credential|session|password)', 'i')\nconst headerValueRe = new RegExp('(bearer|session)', 'i')\n\nexport const getGetLatestEntryByName = (performance?: Performance) => {\n  const [, , , , getEntriesByName] = applyPerformance(performance)\n  return (name: string) => {\n    return getEntriesByName(name).pop()\n  }\n}\n\nexport const checkIsIgnored = (ignoreUrls: (string | RegExp)[], url: string): boolean => {\n  const ignoreRgx = getRegexp(ignoreUrls || [])\n  return !!ignoreRgx && (ignoreRgx as RegExp).test(url)\n}\n\nexport const isSensitiveHeader = (key: string, value: string) => {\n  if (!key || !value) return false\n  return headerKeyRe.test(key) || headerValueRe.test(value)\n}\n\nexport const applySendOnce = <T>(cb: (metric: T) => void) => {\n  let hasInvoked = false\n  return (metric: T) => {\n    if (hasInvoked) return\n    hasInvoked = true\n    cb(metric)\n  }\n}\n","import { isString, SafeObservable, noop } from '@slardar/sdk-template'\n\nimport { XHRNext, ResourceNext } from '../../collector'\nimport { HttpPayload, HttpReport, ReportToReportEvent } from '../../types'\nimport { getFullUrl, now } from '../../utils'\n\nimport { AjaxMonitorConfig, NewXMLHttpRequest } from './type'\nimport { isSensitiveHeader, checkIsIgnored } from './util'\n\nexport type HTTPGetterWithXhrObserver = (\n  report: (ev: ReportToReportEvent<HttpReport>) => void,\n  tearDownGroup: (() => void)[],\n  context: [SafeObservable<XHRNext>, () => SafeObservable<ResourceNext>],\n  config: AjaxMonitorConfig,\n) => void\n\nexport const httpGetterWithXhrObserver: HTTPGetterWithXhrObserver = (\n  report,\n  tearDownGroup,\n  [xhrObserver, getResourceObserver],\n  xhrConfig,\n) => {\n  const { setTraceHeader, ignoreUrls, hookCbAtReq } = xhrConfig\n  tearDownGroup.push(\n    xhrObserver[0](([_method, _url, _start, xhr]) => {\n      if (checkIsIgnored(ignoreUrls, _url)) return noop\n\n      setTraceHeader && setTraceHeader(_url, (key: string, value: string) => xhr.setRequestHeader(key, value))\n      const reportWithContext = hookCbAtReq(report)\n\n      const fullUrl = getFullUrl(_url)\n      let timing: PerformanceResourceTiming | undefined = undefined\n      const resourceTearDown = getResourceObserver()[0]((entry) => {\n        fullUrl === entry.name && !timing && (timing = entry)\n      })\n\n      return (xhrAfterReady) => {\n        const payload = getEventParams(xhrAfterReady, xhrConfig)\n        setTimeout(() => {\n          timing && (payload.response.timing = timing)\n          reportWithContext && reportWithContext({ ev_type: 'http', payload })\n          resourceTearDown()\n        }, 100)\n      }\n    }),\n  )\n}\n\nfunction formatXHRAllResponseHeaders(headers: string): Record<string, string> {\n  if (isString(headers) && headers) {\n    return headers.split('\\r\\n').reduce((result, line) => {\n      if (isString(line)) {\n        const [name, value] = line.split(': ')\n        !isSensitiveHeader(name, value) && (result[name.toLowerCase()] = value)\n      }\n      return result\n    }, {} as Record<string, string>)\n  }\n  return {}\n}\n\nfunction formatRequestHeaders(headers: Record<string, string>): Record<string, string> {\n  return Object.keys(headers).reduce((result, name) => {\n    !isSensitiveHeader(name, headers[name]) && (result[name.toLowerCase()] = headers[name])\n    return result\n  }, {} as Record<string, string>)\n}\n\nexport const getEventParams = (xhr: NewXMLHttpRequest, props: AjaxMonitorConfig): HttpPayload => {\n  const { _method, _reqHeaders, _url, _start, _data } = xhr\n  const fullUrl = getFullUrl(_url)\n  const params: HttpPayload = {\n    api: 'xhr',\n    request: {\n      url: fullUrl,\n      method: (_method || '').toLowerCase(),\n      headers: _reqHeaders && formatRequestHeaders(_reqHeaders),\n      timestamp: _start,\n    },\n    response: {\n      status: xhr.status || 0,\n      is_custom_error: false,\n      timestamp: now(),\n    },\n    duration: now() - _start,\n  }\n\n  if (typeof xhr.getAllResponseHeaders === 'function') {\n    params.response.headers = formatXHRAllResponseHeaders(xhr.getAllResponseHeaders())\n  }\n\n  const status = params.response.status\n\n  const { collectBodyOnError, extraExtractor } = props\n  try {\n    const extra = extraExtractor?.(xhr.response, params)\n    extra && (params.extra = extra)\n    extra && (params.response.is_custom_error = true)\n    // 非 2xx , 3xx 请求，上传request body\n    if (collectBodyOnError && status >= 400) {\n      params.request.body = _data ? `${_data}` : undefined\n      params.response.body = xhr.response ? `${xhr.response}` : undefined\n    }\n  } catch (_o) {\n    // do nothing\n  }\n  return params\n}\n","/* eslint-disable @typescript-eslint/prefer-optional-chain */\nimport { ReportToReportEvent, WebClient, WebReport, WebReportEvent } from '../../types'\nimport { getLocationUrl, getConfig } from '../../utils'\n\nexport function getPluginConfig<C>(client: WebClient, pluginName: string, defaultConfig: C): C | false {\n  const c = client.config()?.plugins[pluginName] as C | undefined\n  return getConfig(c, defaultConfig)\n}\n\nexport const reportOnInitCommonParams = (\n  client: WebClient,\n  overrides?: (ev: ReportToReportEvent<WebReport>) => WebReportEvent['overrides'],\n) => {\n  const clientConfig = client.config()!\n  const common = {\n    url: getLocationUrl(),\n    pid: clientConfig.pid,\n    view_id: clientConfig.viewId,\n  }\n  return (ev: ReportToReportEvent<WebReport>) => {\n    client.report({\n      ...ev,\n      overrides: {\n        ...common,\n        ...((overrides && overrides(ev)) || {}),\n      },\n    })\n  }\n}\n","import { initSubjectInGlobal, WithSubject, id, createSafeObserver, WithContext } from '@slardar/sdk-template'\n\nimport { applyXHR, XHR_SUBJECT_NAME } from '../../collector/http'\nimport { resourceSubject } from '../../collector/pref'\nimport { setTraceContext, setVolTraceContext } from '../../monitors/http/trace'\nimport { AjaxMonitorConfig, WrapXhr } from '../../monitors/http/type'\nimport { httpGetterWithXhrObserver } from '../../monitors/http/xhr'\nimport { HttpReport, ReportToReportEvent, WebClient, WebVolClient } from '../../types'\nimport { getLocationUrl } from '../../utils'\n\nimport { getPluginConfig } from './utils'\n\nexport const AJAX_MONITOR_PLUGIN_NAME = 'ajax'\n\nexport type WithWrapXhr<C extends WithSubject<WebClient>> = C & {\n  wrapXhr?: WrapXhr\n}\n\nconst defaultConfig: AjaxMonitorConfig = {\n  autoWrap: true,\n  hookCbAtReq: id,\n  ignoreUrls: [],\n  collectBodyOnError: false,\n}\n\nexport interface AjaxMonitorPluginConfig {\n  [AJAX_MONITOR_PLUGIN_NAME]?: Partial<AjaxMonitorConfig> | boolean\n}\n\nexport const getCbHook = (client: WithContext<WebClient>) => (cb?: (ev: ReportToReportEvent<HttpReport>) => void) => {\n  if (!cb) return cb\n  const clientConfig = client.config()!\n  const common = {\n    url: getLocationUrl(),\n    pid: clientConfig.pid,\n    view_id: clientConfig.viewId,\n    context: client.context?.toString(),\n  }\n  return (ev: ReportToReportEvent<HttpReport>) => {\n    cb({\n      ...ev,\n      overrides: {\n        ...common,\n        timestamp: ev.payload.request.timestamp,\n      },\n    })\n  }\n}\n\nexport function AjaxMonitorPlugin<C extends WithContext<WithSubject<WebClient>>>(client: C) {\n  client.on('init', () => {\n    const config = getPluginConfig(client, AJAX_MONITOR_PLUGIN_NAME, defaultConfig)\n    if (!config) {\n      return\n    }\n    const tearDownGroup: (() => void)[] = []\n\n    const xhrConfig = { ...config, hookCbAtReq: getCbHook(client), setTraceHeader: setTraceContext(config.trace) }\n    const getResourceSubject = () => initSubjectInGlobal(client, resourceSubject)\n\n    xhrConfig.autoWrap &&\n      httpGetterWithXhrObserver(\n        client.report.bind(client),\n        tearDownGroup,\n        [\n          initSubjectInGlobal(client, [XHR_SUBJECT_NAME, applyXHR(XMLHttpRequest && XMLHttpRequest.prototype)]),\n          getResourceSubject,\n        ],\n        xhrConfig,\n      )\n\n    client.on('beforeDestroy', () => {\n      tearDownGroup.forEach((e) => e())\n    })\n\n    client.provide('wrapXhr', (Xhr: typeof XMLHttpRequest) => {\n      function Ctor() {\n        const xhr = new Xhr()\n        httpGetterWithXhrObserver(\n          client.report.bind(client),\n          tearDownGroup,\n          [createSafeObserver(applyXHR(xhr)), getResourceSubject],\n          xhrConfig,\n        )\n        return xhr\n      }\n      Ctor.prototype = new Xhr()\n      ;['DONE', 'HEADERS_RECIEVED', 'LOADING', 'OPENED', 'UNSENT'].forEach((key) => {\n        Ctor[key] = Xhr[key]\n      })\n      return Ctor as any as typeof XMLHttpRequest\n    })\n  })\n}\n\nexport function AjaxMonitorVolPlugin<C extends WithSubject<WebVolClient>>(client: C) {\n  client.on('init', () => {\n    const config = getPluginConfig(client, AJAX_MONITOR_PLUGIN_NAME, defaultConfig)\n    if (!config) {\n      return\n    }\n\n    const tearDownGroup: (() => void)[] = []\n\n    const xhrConfig = {\n      ...config,\n      hookCbAtReq: getCbHook(client),\n      setTraceHeader: setVolTraceContext(config.trace, `app_id=${client.config()?.aid},origin=web`),\n    }\n    const getResourceSubject = () => initSubjectInGlobal(client, resourceSubject)\n\n    xhrConfig.autoWrap &&\n      httpGetterWithXhrObserver(\n        client.report.bind(client),\n        tearDownGroup,\n        [\n          initSubjectInGlobal(client, [XHR_SUBJECT_NAME, applyXHR(XMLHttpRequest && XMLHttpRequest.prototype)]),\n          getResourceSubject,\n        ],\n        xhrConfig,\n      )\n\n    client.on('beforeDestroy', () => {\n      tearDownGroup.forEach((e) => e())\n    })\n  })\n}\n","/* eslint-disable @typescript-eslint/prefer-nullish-coalescing */\nimport { id, Processor } from '@slardar/sdk-template'\n\nimport { Breadcrumb } from '../../types'\nimport { applyDomAndKeyPress, domBreadcrumb, triggerHandlers, now } from '../../utils'\n\nimport { OnMaxBreadcrumbs, PreBreadcrumb } from './type'\n\nexport { applyDomAndKeyPress, domBreadcrumb, triggerHandlers }\n\nexport const applyBreadcrumb = (\n  maxBreadcrumbs = 20,\n  onAddBreadcrumb: Processor<PreBreadcrumb> = id,\n  onMaxBreadcrumbs: OnMaxBreadcrumbs = (bs, max) => bs.slice(-max),\n) => {\n  let breadcrumbs: Breadcrumb[] = []\n\n  const addBreadcrumb = (breadcrumb: PreBreadcrumb) => {\n    const processed = onAddBreadcrumb(breadcrumb)\n\n    if (processed) {\n      const mergedBreadcrumb = {\n        ...breadcrumb,\n        timestamp: breadcrumb.timestamp || now(),\n      }\n\n      breadcrumbs =\n        maxBreadcrumbs >= 0 && breadcrumbs.length + 1 > maxBreadcrumbs\n          ? onMaxBreadcrumbs([...breadcrumbs, mergedBreadcrumb], maxBreadcrumbs)\n          : [...breadcrumbs, mergedBreadcrumb]\n    }\n  }\n\n  return [() => breadcrumbs, addBreadcrumb] as const\n}\n","import { getDefaultDocument } from '../../utils'\n\nimport { BreadcrumbMonitorConstructor } from './type'\nimport { applyBreadcrumb, applyDomAndKeyPress, domBreadcrumb, triggerHandlers } from './util'\n\nexport { BreadcrumbProps, GetBreadcrumbs, AddBreadcrumb, PreBreadcrumb } from './type'\n\nexport const BreadcrumbMonitor: BreadcrumbMonitorConstructor = (document = getDefaultDocument()) => {\n  if (!document) {\n    return\n  }\n\n  return (props, _cb) => {\n    const { maxBreadcrumbs, onAddBreadcrumb, onMaxBreadcrumbs, dom } = props\n    const [domEventHandler, keypressHandler] = applyDomAndKeyPress(100)\n    const [getBreadcrumbs, addBreadcrumb] = applyBreadcrumb(maxBreadcrumbs, onAddBreadcrumb, onMaxBreadcrumbs)\n    const createDomBreadcrumb = domBreadcrumb(addBreadcrumb)\n\n    const handlers: any[] = []\n    if (dom) {\n      handlers.push(domEventHandler('click', triggerHandlers(createDomBreadcrumb, 'dom')))\n      handlers.push(keypressHandler(triggerHandlers(createDomBreadcrumb, 'dom')))\n      document.addEventListener('click', handlers[0])\n      document.addEventListener('keypress', handlers[1])\n    }\n    const teardown = () => {\n      document.removeEventListener('click', handlers[0])\n      document.removeEventListener('keypress', handlers[1])\n    }\n    return [getBreadcrumbs, addBreadcrumb, teardown]\n  }\n}\n","import { noop } from '@slardar/sdk-template'\n\nimport { AddBreadcrumb, BreadcrumbMonitor, BreadcrumbProps, GetBreadcrumbs } from '../../monitors/breadcrumb'\nimport { WebClient } from '../../types'\nimport { applyMonitor } from '../../utils'\n\nimport { getPluginConfig } from './utils'\n\nexport const BREADCRUMB_MONITOR_PLUGIN_NAME = 'breadcrumb'\n\nexport type WithBreadcrumb<C extends WebClient> = C & {\n  getBreadcrumbs?: GetBreadcrumbs\n  addBreadcrumb?: AddBreadcrumb\n}\n\nexport type BreadcrumbMonitorConfig = BreadcrumbProps\n\nconst defaultConfig: BreadcrumbMonitorConfig = {\n  maxBreadcrumbs: 20,\n  dom: true,\n}\n\nexport interface BreadcrumbMonitorPluginConfig {\n  [BREADCRUMB_MONITOR_PLUGIN_NAME]?: Partial<BreadcrumbMonitorConfig> | boolean\n}\n\nexport function BreadcrumbMonitorPlugin<C extends WebClient>(client: C) {\n  client.on('init', () => {\n    const config = getPluginConfig(client, BREADCRUMB_MONITOR_PLUGIN_NAME, defaultConfig)\n    if (!config) {\n      return\n    }\n\n    const [getBreadcrumbs, addBreadcrumb, tearDown] = applyMonitor(BreadcrumbMonitor, config, noop)\n\n    client.on('report', (ev) => {\n      if (ev.ev_type === 'http') {\n        addBreadcrumb({\n          type: 'http',\n          category: ev.payload.api,\n          message: '',\n          data: {\n            method: ev.payload.request.method,\n            url: ev.payload.request.url,\n            status_code: String(ev.payload.response.status),\n          },\n          timestamp: ev.payload.request.timestamp,\n        })\n      }\n      return ev\n    })\n\n    client.on('beforeDestroy', tearDown)\n\n    client.provide('getBreadcrumbs', getBreadcrumbs)\n    client.provide('addBreadcrumb', addBreadcrumb)\n  })\n}\n","import { SafeObservable, noop, isString } from '@slardar/sdk-template'\n\nimport { FetchNext, ResourceNext } from '../../collector'\nimport { HttpReport, ReportToReportEvent, HttpPayload } from '../../types'\nimport { now, getFullUrl } from '../../utils'\n\nimport { FetchMonitorConfig } from './type'\nimport { checkIsIgnored, isSensitiveHeader, applySendOnce } from './util'\n\nexport type HTTPGetterWithFetchObserver = (\n  report: (ev: ReportToReportEvent<HttpReport>) => void,\n  tearDownGroup: (() => void)[],\n  context: [SafeObservable<FetchNext>, () => SafeObservable<ResourceNext>],\n  config: FetchMonitorConfig,\n) => void\n\nexport const httpGetterWithFetchObserver: HTTPGetterWithFetchObserver = (\n  report,\n  tearDownGroup,\n  [fetchObserver, getResourceObserver],\n  fetchConfig,\n) => {\n  const { setTraceHeader, ignoreUrls, hookCbAtReq } = fetchConfig\n  // eslint-disable-next-line compat/compat\n  const Headers = window.Headers\n  // eslint-disable-next-line compat/compat\n  const Request = window.Request\n  if (!Request || !Headers) return\n\n  tearDownGroup.push(\n    fetchObserver[0](([req, options]) => {\n      const url = getFullUrl(req instanceof Request ? req.url : req)\n      if (!isHttpURL(url) || checkIsIgnored(ignoreUrls, url)) {\n        return noop\n      }\n\n      setTraceHeader &&\n        setTraceHeader(url, (key: string, value: string) => addHeader(key, value, req, options, Request, Headers))\n\n      const reportWithContext = hookCbAtReq(report)\n\n      const _start = now()\n\n      let timing: PerformanceResourceTiming | undefined = undefined\n\n      const resourceTearDown = getResourceObserver()[0]((entry) => {\n        url === entry.name && !timing && (timing = entry)\n      })\n\n      return (res: Response | undefined) => {\n        const payload = getEventParams(req, options, res, Request, Headers, fetchConfig, _start)\n\n        const reportFetchData = applySendOnce((data: HttpPayload) => {\n          timing && (data.response.timing = timing)\n          reportWithContext && reportWithContext({ ev_type: 'http', payload: data })\n          resourceTearDown()\n        })\n\n        setTimeout(() => {\n          reportFetchData(payload)\n        }, 1000)\n      }\n    }),\n  )\n}\n\nconst isHttpURL = (url?: string): boolean => {\n  if (!isString(url)) {\n    return false\n  }\n  const [protocol, path] = url.split(':')\n  return !path || protocol === 'http' || protocol === 'https'\n}\n\nconst isRequest = (req: Request | string, Request: typeof window.Request): req is Request => {\n  return req instanceof Request\n}\n\nconst addHeader = (\n  key: string,\n  value: string,\n  req: Request | string,\n  options: RequestInit,\n  Request: typeof window.Request,\n  Headers: typeof window.Headers,\n) => {\n  if (isRequest(req, Request)) {\n    req.headers.set(key, value)\n  } else if (options.headers instanceof Headers) {\n    options.headers.set(key, value)\n  } else {\n    options.headers = {\n      ...options.headers,\n      [key]: value,\n    }\n  }\n}\n\nexport const getFetchMethod = (req: Request | string, options: RequestInit, Request: typeof window.Request) => {\n  let method = (options && options.method) || 'get'\n  if (isRequest(req, Request)) {\n    method = req.method || method\n  }\n  return method.toLowerCase()\n}\n\nconst mergeHeaders = (\n  Headers: typeof window.Headers,\n  ...headers: (HeadersInit | undefined)[]\n): Record<string, string> => {\n  try {\n    return headers.reduce((sum: Record<string, string>, cur) => {\n      // eslint-disable-next-line compat/compat\n      new Headers(cur || {}).forEach((val, key) => !isSensitiveHeader(key, val) && (sum[key] = val))\n      return sum\n    }, {})\n  } catch {\n    return {}\n  }\n}\n\nconst getFetchBody = (req: Request | string, options: RequestInit, Request: typeof window.Request) => {\n  if (isRequest(req, Request)) {\n    return req.body\n  } else {\n    return options?.body\n  }\n}\n\nconst getEventParams = (\n  req: Request | string,\n  options: RequestInit,\n  res: Response | undefined,\n  Request: typeof window.Request,\n  Headers: typeof window.Headers,\n  props: FetchMonitorConfig,\n  _start: number,\n): HttpPayload => {\n  const params: HttpPayload = {\n    api: 'fetch',\n    request: {\n      method: getFetchMethod(req, options, Request),\n      timestamp: _start,\n      url: getFullUrl(req instanceof Request ? req.url : req),\n      headers: mergeHeaders(Headers, (req as Request).headers, options.headers),\n    },\n    response: {\n      status: (res && res.status) || 0,\n      is_custom_error: false,\n      timestamp: now(),\n    },\n    duration: now() - _start,\n  }\n  const { collectBodyOnError, extraExtractor } = props\n  if (res) {\n    try {\n      params.response.headers = mergeHeaders(Headers, res.headers)\n      try {\n        extraExtractor &&\n          res\n            .clone()\n            .json()\n            .then((o: any) => {\n              const extra = extraExtractor(o, params)\n              if (extra) {\n                params.extra = extra\n                params.response.is_custom_error = true\n              }\n            })\n            .catch(noop)\n      } catch (_o) {\n        // do nothing\n      }\n\n      if (collectBodyOnError && res.status >= 400) {\n        params.request.body = getFetchBody(req, options, Request)?.toString()\n      }\n    } catch {\n      // do nothing\n    }\n  } else {\n    collectBodyOnError && (params.request.body = getFetchBody(req, options, Request)?.toString())\n  }\n  return params\n}\n","import { id, initSubjectInGlobal, WithSubject, createSafeObserver, WithContext } from '@slardar/sdk-template'\n\nimport { fetchSubject, hookFetch } from '../../collector/http'\nimport { resourceSubject } from '../../collector/pref'\nimport { httpGetterWithFetchObserver } from '../../monitors/http/fetch'\nimport { setTraceContext, setVolTraceContext } from '../../monitors/http/trace'\nimport { FetchMonitorConfig } from '../../monitors/http/type'\nimport { WebClient, WebVolClient } from '../../types'\n\nimport { getCbHook } from './ajax'\nimport { getPluginConfig } from './utils'\n\nexport const FETCH_MONITOR_PLUGIN_NAME = 'fetch'\n\nexport interface WrapFetch {\n  (fetch: typeof window.fetch): typeof window.fetch\n}\n\nexport type WithWrapFetch<C extends WebClient> = C & {\n  wrapFetch?: WrapFetch\n}\n\nconst defaultConfig: FetchMonitorConfig = {\n  autoWrap: true,\n  hookCbAtReq: id,\n  ignoreUrls: [],\n  collectBodyOnError: false,\n}\nexport interface FetchMonitorPluginConfig {\n  [FETCH_MONITOR_PLUGIN_NAME]?: Partial<FetchMonitorConfig> | boolean\n}\n\nexport function FetchMonitorPlugin<C extends WithContext<WithSubject<WebClient>>>(client: C) {\n  client.on('init', () => {\n    const config = getPluginConfig(client, FETCH_MONITOR_PLUGIN_NAME, defaultConfig)\n    if (!config) {\n      return\n    }\n\n    const tearDownGroup: (() => void)[] = []\n\n    const fetchConfig = { ...config, hookCbAtReq: getCbHook(client), setTraceHeader: setTraceContext(config.trace) }\n    const getResourceObserver = () => initSubjectInGlobal(client, resourceSubject)\n\n    fetchConfig.autoWrap &&\n      httpGetterWithFetchObserver(\n        client.report.bind(client),\n        tearDownGroup,\n        [initSubjectInGlobal(client, fetchSubject), getResourceObserver],\n        fetchConfig,\n      )\n\n    client.on('beforeDestroy', () => {\n      tearDownGroup.forEach((e) => e())\n    })\n\n    client.provide('wrapFetch', (f: typeof window.fetch) => {\n      let newFetch = undefined\n\n      httpGetterWithFetchObserver(\n        client.report.bind(client),\n        tearDownGroup,\n        [\n          createSafeObserver((next) => {\n            newFetch = hookFetch(f, next)\n          }),\n          getResourceObserver,\n        ],\n        fetchConfig,\n      )\n\n      return newFetch\n    })\n  })\n}\n\nexport function FetchMonitorVolPlugin<C extends WithSubject<WebVolClient>>(client: C) {\n  client.on('init', () => {\n    const config = getPluginConfig(client, FETCH_MONITOR_PLUGIN_NAME, defaultConfig)\n    if (!config) {\n      return\n    }\n\n    const tearDownGroup: (() => void)[] = []\n\n    const fetchConfig = {\n      ...config,\n      hookCbAtReq: getCbHook(client),\n      setTraceHeader: setVolTraceContext(config.trace, `app_id=${client.config()?.aid},origin=web`),\n    }\n\n    fetchConfig.autoWrap &&\n      httpGetterWithFetchObserver(\n        client.report.bind(client),\n        tearDownGroup,\n        [initSubjectInGlobal(client, fetchSubject), () => initSubjectInGlobal(client, resourceSubject)],\n        fetchConfig,\n      )\n\n    client.on('beforeDestroy', () => {\n      tearDownGroup.forEach((e) => e())\n    })\n  })\n}\n","import { Observer } from '@slardar/sdk-template'\n\nimport { getDefaultBrowser } from '../utils/defaults'\n\nexport const ERROR_SUBJECT_NAME = 'err_0'\n\nexport type ErrorNext = (args: ErrorEvent) => void\n\nexport const observeError: Observer<ErrorNext> = (next, tearDown) => {\n  const window = getDefaultBrowser()\n  if (!window) return\n\n  window.addEventListener('error', next, true)\n\n  tearDown(() => {\n    window.removeEventListener('error', next, true)\n  })\n}\n\nexport const errorSubject: [string, Observer<ErrorNext>] = [ERROR_SUBJECT_NAME, observeError]\n\nexport const PROMISE_REJECTION_SUBJECT_NAME = 'perr_0'\n\nexport type PromiseRejectionNext = (args: PromiseRejectionEvent) => void\n\nexport const observePromiseRejection: Observer<PromiseRejectionNext> = (next, tearDown) => {\n  const window = getDefaultBrowser()\n  if (!window) return\n\n  window.addEventListener('unhandledrejection', next, true)\n\n  tearDown(() => {\n    window.removeEventListener('unhandledrejection', next, true)\n  })\n}\n\nexport const promiseRejectionSubject: [string, Observer<PromiseRejectionNext>] = [\n  PROMISE_REJECTION_SUBJECT_NAME,\n  observePromiseRejection,\n]\n","import {\n  isError,\n  isEvent,\n  isPlainObject,\n  isErrorEvent,\n  isPromiseRejectionEvent,\n  isString,\n  pick,\n  safeStringify,\n} from '@slardar/sdk-template'\n\nimport { JsError } from '../../types'\n\nconst ERROR_FIELDS = ['name', 'message', 'stack', 'filename', 'lineno', 'colno']\n\nexport const normalize = (ex: any): JsError | undefined => {\n  let error: JsError | undefined\n  if (!isError(ex)) {\n    if (isPlainObject(ex) || isEvent(ex) || isString(ex)) {\n      error = {\n        message: safeStringify(ex),\n      }\n    }\n  } else {\n    error = pick(ex, ERROR_FIELDS) as JsError\n  }\n  return error\n}\n\nexport const normalizeError = (event: ErrorEvent): any => {\n  return normalize(event.error)\n}\n\nexport const normalizeException = (event: PromiseRejectionEvent | CustomEvent): any => {\n  // dig the object of the rejection out of known event types\n  try {\n    let error: any\n    // PromiseRejectionEvents store the object of the rejection under 'reason'\n    // see https://developer.mozilla.org/en-US/docs/Web/API/PromiseRejectionEvent\n    if ('reason' in event) {\n      error = event.reason\n    }\n    // something, somewhere, (likely a browser extension) effectively casts PromiseRejectionEvents\n    // to CustomEvents, moving the `promise` and `reason` attributes of the PRE into\n    // the CustomEvent's `detail` attribute, since they're not part of CustomEvent's spec\n    // see https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent and\n    // https://github.com/getsentry/sentry-javascript/issues/2380\n    else if ('detail' in event && 'reason' in event.detail) {\n      error = event.detail.reason\n    }\n\n    if (error) {\n      const rejectionError = normalize(error)\n      // eslint-disable-next-line @typescript-eslint/prefer-optional-chain\n      return { ...rejectionError, name: (rejectionError && rejectionError.name) ?? 'UnhandledRejection' }\n    }\n  } catch (_oO) {\n    // no-empty\n  }\n}\n\nexport const normalizeUnknownError = (exception: any) => {\n  if (isErrorEvent(exception)) {\n    return normalizeError(exception)\n  } else if (isPromiseRejectionEvent(exception)) {\n    return normalizeException(exception)\n  } else {\n    return normalize(exception)\n  }\n}\n","/* eslint-disable @typescript-eslint/prefer-nullish-coalescing */\n/* eslint-disable @typescript-eslint/prefer-optional-chain */\n/* eslint-disable @typescript-eslint/ban-types */\nimport { isFunction, hookObjectProperty } from '@slardar/sdk-template'\n\nimport { JsErrorPayload } from '../../types'\nimport { getDefaultBrowser, getDefaultXMLHttpRequest } from '../../utils'\n\nimport { normalize } from './util'\n\nexport const DEFAULT_EVENT_TARGET = [\n  'EventTarget',\n  'Window',\n  'Node',\n  'ApplicationCache',\n  'ChannelMergerNode',\n  'EventSource',\n  'FileReader',\n  'HTMLUnknownElement',\n  'IDBDatabase',\n  'IDBRequest',\n  'IDBTransaction',\n  'MessagePort',\n  'Notification',\n  'SVGElementInstance',\n  'Screen',\n  'TextTrack',\n  'TextTrackCue',\n  'TextTrackList',\n  'WebSocket',\n  'Worker',\n  'XMLHttpRequest',\n  'XMLHttpRequestEventTarget',\n  'XMLHttpRequestUpload',\n] as const\n\nexport const DEFAULT_TIME_FUNCTION = [\n  'setTimeout',\n  'setInterval',\n  'requestAnimationFrame',\n  'requestIdleCallback',\n] as const\nexport const xmlHttpRequestProps = ['onload', 'onerror', 'onprogress', 'onreadystatechange'] as const\nconst ADD_EVENT_LISTENER = 'addEventListener'\nconst REMOVE_EVENT_LISTENER = 'removeEventListener'\ninterface WrappedFunction extends Function {\n  _w_?: Function\n  handleEvent?: Function\n}\n\ninterface HookFunction extends Function {\n  _hook_?: boolean\n}\n\ninterface CaptureJsErrorSourceData {\n  function: string\n  target?: string\n}\nconst DEFAULT_SOURCE_TYPE = 'capture-global'\n\nexport const hookGlobalAsync = (\n  report: ({ error, extra, react }: Partial<JsErrorPayload>) => void,\n  window = getDefaultBrowser()!,\n  xhr = getDefaultXMLHttpRequest()!,\n) => {\n  const restoreFns: (() => void)[] = []\n  const wrap = (fn: WrappedFunction, sourceData: Partial<CaptureJsErrorSourceData>) => {\n    if (!isFunction(fn)) return fn\n    const source = {\n      type: DEFAULT_SOURCE_TYPE,\n      data: {\n        ...sourceData,\n      } as Record<string, string>,\n    }\n\n    const hookFn = (fn._w_ ||= function (this: any) {\n      try {\n        // NOTE: If you are a Slardar user, and you are seeing this stack frame, it\n        //       means the Slardar SDK caught an error invoking your application code. This\n        //       is expected behavior and NOT indicative of a bug with Slardar SDK.\n        return (fn.handleEvent && isFunction(fn.handleEvent) ? fn.handleEvent : fn).apply(\n          this,\n          [].map.call(arguments, (arg) => wrap(arg, sourceData)),\n        )\n      } catch (e) {\n        const error = normalize(e)\n        error && report({ error, source })\n        throw e\n      }\n    }) as HookFunction\n\n    hookFn._hook_ = true\n\n    return hookFn\n  }\n\n  window &&\n    restoreFns.push(\n      ...DEFAULT_TIME_FUNCTION.filter((timeFunc) => window[timeFunc]).map((timeFunc) =>\n        hookObjectProperty(\n          window,\n          timeFunc,\n          (origin: Function) =>\n            function (this: any, handler: Function, ...params: any[]) {\n              return (\n                origin &&\n                origin.call(\n                  this,\n                  wrap(handler, {\n                    function: timeFunc,\n                  }),\n                  ...params,\n                )\n              )\n            },\n          false,\n        )(),\n      ),\n    )\n\n  xhr &&\n    xhr.prototype &&\n    restoreFns.push(\n      hookObjectProperty(\n        xhr.prototype,\n        'send',\n        (origin) =>\n          function (this: XMLHttpRequest, ...params) {\n            // filter 防御一个 xhr 实例被多次 send 导致 wrap 多次的情况\n            xmlHttpRequestProps\n              .filter((prop) => this[prop] && !(this[prop] as HookFunction)._hook_)\n              .forEach((prop) => {\n                // never restore xhr instance callback\n                this[prop] = wrap(this[prop] as WrappedFunction, { function: prop }) as any\n              })\n            return origin.apply(this, params)\n          },\n        false,\n      )(),\n    )\n\n  DEFAULT_EVENT_TARGET.forEach((target) => {\n    const proto = window[target] && window[target].prototype\n    if (!proto || !proto[ADD_EVENT_LISTENER]) {\n      return\n    }\n\n    restoreFns.push(\n      hookObjectProperty(\n        proto,\n        ADD_EVENT_LISTENER,\n        (origin: WrappedFunction) =>\n          function (this: any, evName: string, fn: WrappedFunction, options: {}) {\n            try {\n              const handleEventFn = fn.handleEvent\n              if (isFunction(handleEventFn)) {\n                fn.handleEvent = wrap(handleEventFn, { function: 'handleEvent', target })\n              }\n            } catch {\n              //\n            }\n            return origin && origin.call(this, evName, wrap(fn, { function: ADD_EVENT_LISTENER, target }), options)\n          },\n        false,\n      )(),\n    )\n\n    restoreFns.push(\n      hookObjectProperty(\n        proto,\n        REMOVE_EVENT_LISTENER,\n        (origin: WrappedFunction) =>\n          function (this: any, eventName: string, fn: WrappedFunction, options: {}) {\n            if (fn?._w_) {\n              origin.call(this, eventName, fn._w_, options)\n            }\n            return origin.call(this, eventName, fn, options)\n          },\n        false,\n      )(),\n    )\n  })\n\n  return restoreFns\n}\n","import { JsError } from '../../types'\nimport { reportSelfError } from '../../utils'\n\nconst isSameErrorString = (current: string | undefined, previous: string | undefined) =>\n  current && previous && current === previous\n\nconst shouldDropEvent = (currentError: JsError | undefined, previousError: JsError | undefined): boolean => {\n  if (!currentError || !previousError) {\n    return false\n  }\n\n  if (\n    isSameErrorString(currentError.message, previousError.message) &&\n    isSameErrorString(currentError.stack, previousError.stack)\n  ) {\n    return true\n  }\n  return false\n}\n\nexport const dedupe = () => {\n  let __previousError: JsError | undefined\n  return (currentError: JsError | undefined): JsError | undefined => {\n    // just in case something goes wrong\n    try {\n      if (shouldDropEvent(currentError, __previousError)) {\n        __previousError = currentError\n        return undefined\n      }\n    } catch (e) {\n      reportSelfError(e)\n    }\n    __previousError = currentError\n    return currentError\n  }\n}\n","import { SafeObservable, getRegexp } from '@slardar/sdk-template'\n\nimport { ErrorNext, PromiseRejectionNext } from '../../collector/error'\nimport { ReportToReportEvent, JsErrorReport, JsErrorPayload } from '../../types'\nimport { ReactInfo } from '../../types/thrift/browser/collector_v2/js_error'\n\nimport { hookGlobalAsync } from './capture-global'\nimport { dedupe } from './dedupe'\nimport { normalizeError, normalizeException, normalizeUnknownError } from './util'\n\nexport type ReportJsError = (ex: any, extra?: Record<string, string>, react?: ReactInfo) => void\n\nexport interface JsErrorConfig {\n  ignoreErrors: (string | RegExp)[]\n  onerror: boolean\n  onunhandledrejection: boolean\n  captureGlobalAsync?: boolean\n  dedupe?: boolean\n}\n\nexport const JS_ERROR_EV_TYPE = 'js_error'\n\ntype JSErrorGetterWithContext = (\n  report: (ev: ReportToReportEvent<JsErrorReport>) => void,\n  tearDownGroup: (() => void)[],\n  context: [SafeObservable<ErrorNext>, SafeObservable<PromiseRejectionNext>],\n  config: JsErrorConfig,\n) => ReportJsError\n\nexport const jsErrorGetterWithContext: JSErrorGetterWithContext = (\n  report,\n  tearDownGroup,\n  [errorObserver, promiseRejectionObserver],\n  config,\n) => {\n  const { ignoreErrors, onerror, onunhandledrejection, dedupe: dedupeFlag, captureGlobalAsync } = config\n  const ignoreRegExp = getRegexp(ignoreErrors)\n  const dedupeFn = dedupe()\n\n  const reportJsError = ({ error, extra, react, source }: Partial<JsErrorPayload>) => {\n    const err = dedupeFlag ? dedupeFn(error) : error\n    if (!err || (ignoreRegExp && ignoreRegExp.test(err.message))) {\n      return\n    }\n    report({\n      ev_type: JS_ERROR_EV_TYPE,\n      payload: {\n        error: err,\n        breadcrumbs: [],\n        extra,\n        react,\n        source,\n      },\n    })\n  }\n\n  onerror &&\n    tearDownGroup.push(\n      errorObserver[0]((ev: ErrorEvent) => reportJsError({ error: normalizeError(ev), source: { type: 'onerror' } })),\n    )\n\n  onunhandledrejection &&\n    tearDownGroup.push(\n      promiseRejectionObserver[0]((ev: PromiseRejectionEvent) =>\n        reportJsError({ error: normalizeException(ev), source: { type: 'onunhandledrejection' } }),\n      ),\n    )\n\n  captureGlobalAsync && tearDownGroup.push(...hookGlobalAsync(reportJsError))\n\n  return (err, extra, react) =>\n    reportJsError({ error: normalizeUnknownError(err), extra, react, source: { type: 'manual' } })\n}\n","import { WithSubject, initSubjectInGlobal } from '@slardar/sdk-template'\n\nimport { errorSubject, promiseRejectionSubject } from '../../collector/error'\nimport { jsErrorGetterWithContext, JsErrorConfig, ReportJsError } from '../../monitors/js-error'\nimport { WebClient } from '../../types'\n\nimport { WithBreadcrumb } from './breadcrumb'\nimport { getPluginConfig } from './utils'\n\nexport { JS_ERROR_EV_TYPE } from '../../monitors/js-error'\nexport { normalizeUnknownError } from '../../monitors/js-error/util'\n\nexport const JS_ERROR_MONITOR_PLUGIN_NAME = 'jsError'\n\nexport type WithCaptureException<C extends WebClient> = C & {\n  captureException?: ReportJsError\n}\n\nexport type WithJSErrorPrecollect<C extends WebClient> = C & {\n  pcErr?: (e: ErrorEvent) => void // global 预收集error\n  pcRej?: (e: PromiseRejectionEvent) => void // global 预收集 unhandledrejection\n}\n\nexport type JsErrorMonitorConfig = JsErrorConfig\n\nconst defaultConfig: JsErrorMonitorConfig = {\n  ignoreErrors: [],\n  onerror: true,\n  onunhandledrejection: true,\n  captureGlobalAsync: false,\n  dedupe: true,\n}\nexport interface JsErrorMonitorPluginConfig {\n  [JS_ERROR_MONITOR_PLUGIN_NAME]?: Partial<JsErrorMonitorConfig> | boolean\n}\n\nexport function JsErrorMonitorPlugin<C extends WithJSErrorPrecollect<WithBreadcrumb<WithSubject<WebClient>>>>(\n  client: C,\n) {\n  client.on('init', () => {\n    // stop precollect listener no matter what is configured\n    window.removeEventListener('error', client.pcErr as EventListenerOrEventListenerObject, true)\n    window.removeEventListener('unhandledrejection', client.pcRej as EventListenerOrEventListenerObject, true)\n\n    const config = getPluginConfig(client, JS_ERROR_MONITOR_PLUGIN_NAME, defaultConfig)\n    if (!config) {\n      return\n    }\n\n    const tearDownGroup: (() => void)[] = []\n\n    const reportJsError = jsErrorGetterWithContext(\n      (ev) => {\n        client.getBreadcrumbs && (ev.payload.breadcrumbs = client.getBreadcrumbs())\n        client.report(ev)\n      },\n      tearDownGroup,\n      [initSubjectInGlobal(client, errorSubject), initSubjectInGlobal(client, promiseRejectionSubject)],\n      config,\n    )\n\n    client.on('beforeDestroy', () => {\n      tearDownGroup.forEach((e) => e())\n    })\n\n    client.provide('captureException', reportJsError)\n  })\n}\n","import { Observer, noop } from '@slardar/sdk-template'\n\nimport { WebClient, WebConfig } from '../types'\nimport { Common } from '../types/thrift/browser/collector_v2/common'\nimport { getLocationUrl } from '../utils/url'\n\nconst getOverrides = (config: Partial<WebConfig>): Partial<Common> => {\n  return {\n    pid: config.pid,\n    view_id: config.viewId,\n    url: getLocationUrl(),\n  }\n}\n\nexport const PV_SUBJECT_NAME = 'view_0'\n\nexport type PVNext = (args: Partial<Common>) => void\n\n/**\n * 由于跟当前实例强相关 所以不能挂在global上\n */\nexport const applyPV = (client: WebClient): Observer<PVNext> => {\n  return (next, tearDown) => {\n    let currentOverrides = getOverrides(client.config()!)\n    const handleConfig = (newConfig: Partial<WebConfig>) => {\n      if (newConfig.viewId && newConfig.viewId !== client.config()?.viewId) {\n        next(currentOverrides)\n        currentOverrides = getOverrides(newConfig)\n      }\n    }\n    client.on('beforeConfig', handleConfig)\n    tearDown(() => {\n      client.off('beforeConfig', handleConfig)\n    })\n  }\n}\n\nexport const FIRST_PV_SUBJECT_NAME = 'f_view_0'\n/**\n * 由于跟当前实例强相关 所以不能挂在global上\n */\nexport const applyFirstPV = (client: WebClient): Observer<PVNext> => {\n  return (_, tearDown) => {\n    const firstOverrides: Partial<Common> | undefined = getOverrides(client.config()!)\n    tearDown(noop, (subscriber) => {\n      firstOverrides && subscriber(firstOverrides!)\n    })\n  }\n}\n","import { hookObjectProperty, Observer } from '@slardar/sdk-template'\n\nimport { getDefaultBrowser, getDefaultHistory } from '../utils'\n\nexport const HISTORY_SUBJECT_NAME = 'history_0'\n\nexport const HASH_SUBJECT_NAME = 'hash_0'\n\nexport type RouteNext = (args: string) => void\n\nexport const observeHistory: Observer<RouteNext> = (next, tearDown) => {\n  const history = getDefaultHistory()\n  if (!history) return\n\n  const restoreFns: (() => void)[] = []\n\n  const historyChangeListener = () => next(location.href)\n  const hookStateChange = (origin: any) =>\n    function (...params: any) {\n      try {\n        origin.apply(history, params)\n      } finally {\n        historyChangeListener()\n      }\n    }\n  restoreFns.push(\n    hookObjectProperty(history, 'pushState', hookStateChange)(),\n    hookObjectProperty(history, 'replaceState', hookStateChange)(),\n  )\n\n  window.addEventListener('popstate', historyChangeListener, true)\n  restoreFns.push(() => window.removeEventListener('popstate', historyChangeListener, true))\n  tearDown(() => {\n    restoreFns.forEach((fn) => fn())\n  })\n}\n\nexport const observeHash: Observer<(args: string) => void> = (next, tearDown) => {\n  const window = getDefaultBrowser()\n  if (!window) return\n\n  const hashChangeListener = () => next(location.href)\n  window.addEventListener('hashchange', hashChangeListener, true)\n  tearDown(() => window.removeEventListener('hashchange', hashChangeListener, true))\n}\n\nexport const hashSubject: [string, Observer<RouteNext>] = [HASH_SUBJECT_NAME, observeHash]\n\nexport const historySubject: [string, Observer<RouteNext>] = [HISTORY_SUBJECT_NAME, observeHistory]\n","/* eslint-disable @typescript-eslint/prefer-optional-chain */\nimport { WebReportEvent } from '../../types'\nimport { parseUrl } from '../../utils'\n\nimport { PageviewSourceType } from './type'\n\nexport const getDefaultExtractor = (routeMode: 'hash' | 'history' | 'manual') => (url: string) => {\n  if (routeMode === 'hash') {\n    return parseUrl(url).hash?.replace(/^#/, '') || '/'\n  } else {\n    return parseUrl(url).path\n  }\n}\n\nexport const applyOnPidChange = (\n  cb: (source: PageviewSourceType, pid: string) => void,\n  initPid: string,\n  firstOriginPid: string,\n  onPidUpdate?: (pid: string) => void,\n): [(source: PageviewSourceType, newPid: string, customPid?: string) => void, () => void] => {\n  // store originalPid from url\n  let originalPid = firstOriginPid\n  // store finalPid send to server\n  let finalPid = initPid\n  // set init pid in config\n  onPidUpdate && onPidUpdate(initPid)\n  const onPidChange = (source: PageviewSourceType, newPid: string, customPid?: string) => {\n    // newPid is extractPid from url, should send pageview if changed, no matter customPid changed\n    if (source !== PageviewSourceType.user_set && newPid !== originalPid) {\n      originalPid = newPid\n      finalPid = customPid ?? originalPid\n      onPidUpdate && onPidUpdate(finalPid) // update pid in common\n      cb(source, finalPid)\n      // newPid is by user set, should send pageview if not equal to finalPid\n    } else if (source === PageviewSourceType.user_set && newPid !== finalPid) {\n      finalPid = newPid\n      onPidUpdate && onPidUpdate(finalPid) // update pid in common\n      cb(source, finalPid)\n    }\n  }\n  const sendInit = () => {\n    initPid && cb(PageviewSourceType.init, initPid)\n  }\n  return [onPidChange, sendInit]\n}\n\nexport const applyOnUrlChange = (cb: (source: PageviewSourceType, url: string) => void, initUrl: string) => {\n  let url = initUrl\n  const onUrlChange = (source: PageviewSourceType, newUrl: string) => {\n    if (newUrl !== url) {\n      url = newUrl\n      cb(source, url)\n    }\n  }\n  return [onUrlChange]\n}\n\nexport const wrapPageview = (source: PageviewSourceType, pid: string): WebReportEvent => ({\n  ev_type: 'pageview',\n  payload: {\n    pid,\n    source,\n  },\n})\n\nexport const applyReportPageview = (report: (ev: WebReportEvent) => void) => {\n  return (source: PageviewSourceType, pid: string) => {\n    report(wrapPageview(source, pid))\n  }\n}\n\nexport const isManualMode = (routeMode: string) => routeMode === 'manual'\n","import { SafeObservable } from '@slardar/sdk-template'\n\nimport { RouteNext } from '../../collector/route'\nimport { WebReportEvent } from '../../types'\n\nimport { PageviewProps, PageviewSourceType } from './type'\nimport { getDefaultExtractor, applyOnPidChange, applyReportPageview, applyOnUrlChange, isManualMode } from './util'\n\ntype PVGetterWithRouteContext = (\n  report: (ev: WebReportEvent) => void,\n  tearDownGroup: (() => void)[],\n  context: SafeObservable<RouteNext>[] | [],\n  config: PageviewProps,\n) => [(pid: string) => void]\n\nexport const pvGetterWithRouteObserver: PVGetterWithRouteContext = (report, tearDownGroup, routeObservers, config) => {\n  const { sendInit: sendInitFlag, initPid, routeMode, extractPid, onPidUpdate } = config\n\n  const extractPidFromUrl = isManualMode(routeMode) ? () => '' : getDefaultExtractor(routeMode)\n  const customPidFromUrl = extractPid || (() => undefined)\n  const getFinalPid = (url: string): string => customPidFromUrl(url) ?? extractPidFromUrl(url)\n\n  const [onPidChange, sendInit] = applyOnPidChange(\n    applyReportPageview(report),\n    initPid || getFinalPid(location.href),\n    extractPidFromUrl(location.href),\n    onPidUpdate,\n  )\n\n  if (!isManualMode(routeMode)) {\n    const [onUrlChange] = applyOnUrlChange(\n      (sources: PageviewSourceType, url: string) => onPidChange(sources, extractPidFromUrl(url), customPidFromUrl(url)),\n      '',\n    )\n    routeObservers.length &&\n      routeObservers.forEach((routeObserver) =>\n        tearDownGroup.push(routeObserver[0]((value: string) => onUrlChange(routeMode as PageviewSourceType, value))),\n      )\n  }\n\n  if (sendInitFlag) {\n    sendInit()\n  }\n  return [onPidChange.bind(null, PageviewSourceType.user_set)]\n}\n","import { WithSubject, initPrivateSubject } from '@slardar/sdk-template'\n\nimport { FIRST_PV_SUBJECT_NAME, applyFirstPV } from '../../collector/client'\nimport { hashSubject, historySubject } from '../../collector/route'\nimport { pvGetterWithRouteObserver } from '../../monitors/pageview'\nimport { PageviewProps, SendPageview } from '../../monitors/pageview/type'\nimport { isManualMode } from '../../monitors/pageview/util'\nimport { WebClient } from '../../types'\nimport { now } from '../../utils'\n\nimport { getPluginConfig } from './utils'\n\nexport const PAGEVIEW_MONITOR_PLUGIN_NAME = 'pageview'\n\nexport type WithSendPageview<C extends WithSubject<WebClient>> = C & {\n  sendPageview?: SendPageview\n}\n\nexport type PageviewMonitorConfig = Omit<PageviewProps, 'onPidUpdate' | 'initPid'>\n\nconst defaultConfig: PageviewMonitorConfig = {\n  sendInit: true,\n  routeMode: 'history',\n}\nexport interface PageviewMonitorPluginConfig {\n  [PAGEVIEW_MONITOR_PLUGIN_NAME]?: Partial<PageviewMonitorConfig> | boolean\n}\n\nexport function PageviewMonitorPlugin<C extends WithSubject<WebClient>>(client: C) {\n  client.on('init', () => {\n    const config = getPluginConfig(client, PAGEVIEW_MONITOR_PLUGIN_NAME, defaultConfig)\n    if (!config || !location) {\n      return\n    }\n    const tearDownGroup: (() => void)[] = []\n\n    const { routeMode } = config\n    const [sendPageview] = pvGetterWithRouteObserver(\n      client.report.bind(client),\n      tearDownGroup,\n      isManualMode(routeMode) ? [] : [client.initSubject(hashSubject), client.initSubject(historySubject)],\n      {\n        ...config,\n        initPid: client.config()?.pid,\n        onPidUpdate: (pid: string) => {\n          client.set({ pid, viewId: `${pid}_${now()}`, actionId: undefined })\n        },\n      },\n    )\n\n    initPrivateSubject(client, [FIRST_PV_SUBJECT_NAME, applyFirstPV(client)], -1)\n\n    client.on('config', () => {\n      sendPageview(client.config()!.pid)\n    })\n\n    client.on('beforeDestroy', () => {\n      tearDownGroup.forEach((e) => e())\n    })\n    client.provide('sendPageview', sendPageview)\n  })\n}\n","import { Observer } from '@slardar/sdk-template'\n\nimport { applyRequestIdleCallback, invokeCallbackOnce } from '../utils'\nimport { getDefaultBrowser, getDefaultDocument } from '../utils/defaults'\n\nexport const HIDDEN_SUBJECT_NAME = 'hidden_0'\n\n// eslint-disable-next-line @typescript-eslint/no-invalid-void-type\nexport type HiddenNext = (args: void) => void\n\nexport const observeHidden: Observer<HiddenNext> = (next, tearDown) => {\n  const window = getDefaultBrowser()\n  const document = getDefaultDocument()\n  if (!window || !document) return\n\n  const onVisibilityChange = () => {\n    if (document.visibilityState === 'hidden') {\n      next()\n    }\n  }\n  addEventListener('visibilitychange', onVisibilityChange, true)\n\n  const requestIdleCallback = applyRequestIdleCallback(window)\n\n  tearDown(\n    () => {\n      removeEventListener('visibilitychange', onVisibilityChange, true)\n    },\n    (subscriber) => {\n      if (document.visibilityState === 'hidden') {\n        requestIdleCallback(() => {\n          subscriber()\n        })\n      }\n    },\n  )\n}\n\nexport const hiddenSubject: [string, Observer<HiddenNext>] = [HIDDEN_SUBJECT_NAME, observeHidden]\n\nexport const LOAD_SUBJECT_NAME = 'load_0'\n\n// eslint-disable-next-line @typescript-eslint/no-invalid-void-type\nexport type LoadNext = (args: void) => void\n\nexport const observeLoad: Observer<LoadNext> = (next, tearDown) => {\n  const window = getDefaultBrowser()\n  const document = getDefaultDocument()\n  if (!window || !document) return\n\n  const onLoad = () => {\n    setTimeout(() => {\n      next()\n    }, 0)\n  }\n  window.addEventListener('load', onLoad, false)\n\n  const requestIdleCallback = applyRequestIdleCallback(window)\n  tearDown(\n    () => {\n      window.removeEventListener('load', onLoad, false)\n    },\n    (subscriber) => {\n      if (document.readyState === 'complete') {\n        requestIdleCallback(() => {\n          subscriber()\n        })\n      }\n    },\n  )\n}\n\nexport const loadSubject: [string, Observer<LoadNext>] = [LOAD_SUBJECT_NAME, observeLoad]\n\nexport const UNLOAD_SUBJECT_NAME = 'unload_0'\n\n// eslint-disable-next-line @typescript-eslint/no-invalid-void-type\nexport type UnloadNext = (args: void) => void\n\nexport const observeUnload: Observer<UnloadNext> = (next, tearDown) => {\n  const window = getDefaultBrowser()\n  if (!window) return\n\n  // eslint-disable-next-line @typescript-eslint/no-invalid-void-type\n  const [invokeCbOnce] = invokeCallbackOnce<void>(next)\n  const unloadEventList = ['unload', 'beforeunload', 'pagehide']\n\n  const handler = () => {\n    invokeCbOnce()\n  }\n\n  unloadEventList.forEach((ev) => {\n    window.addEventListener(ev, handler)\n  })\n  tearDown(() => {\n    unloadEventList.forEach((ev) => {\n      window.removeEventListener(ev, handler)\n    })\n  })\n}\n\nexport const unloadSubject: [string, Observer<UnloadNext>] = [UNLOAD_SUBJECT_NAME, observeUnload]\n","import { SafeObservable, getRegexp, arrayIncludes } from '@slardar/sdk-template'\n\nimport { LoadNext } from '../../collector/page'\nimport { ResourceNext } from '../../collector/pref'\nimport { WebReportEvent } from '../../types'\nimport { getDefaultPerformance, applyPerformance } from '../../utils'\n\nexport interface ResourceProps {\n  ignoreUrls: (string | RegExp)[]\n  slowSessionThreshold: number\n  ignoreTypes?: string[]\n}\n\ntype ResourceGetterWithContext = (\n  report: (ev: WebReportEvent) => void,\n  tearDownGroup: (() => void)[],\n  context: [SafeObservable<LoadNext>, () => SafeObservable<ResourceNext>],\n  config: ResourceProps,\n) => void\n\nconst RESOURCE_EV_TYPE = 'resource'\nconst RESOURCE_PERFORMANCE_ENTRY_TYPE = 'resource'\nconst RESOURCE_IGNORE_TYPES = ['xmlhttprequest', 'fetch', 'beacon']\n\nexport const resourceGetterWithContext: ResourceGetterWithContext = (\n  report,\n  tearDownGroup,\n  [loadObserver, getResourceObserver],\n  config,\n) => {\n  const performance = getDefaultPerformance()\n  if (!performance) return\n  const { ignoreUrls, slowSessionThreshold, ignoreTypes } = config\n  const ignoreRegExp = getRegexp(ignoreUrls)\n\n  const reportResource = (entry: PerformanceResourceTiming, isSlowSession = false) => {\n    if (\n      arrayIncludes(ignoreTypes || RESOURCE_IGNORE_TYPES, entry.initiatorType) ||\n      (ignoreRegExp && ignoreRegExp.test(entry.name))\n    )\n      return\n\n    const data: WebReportEvent = { ev_type: RESOURCE_EV_TYPE, payload: entry }\n    isSlowSession && (data.extra = { sample_rate: 1 })\n    report(data)\n  }\n\n  tearDownGroup.push(\n    loadObserver[0](() => {\n      const [timing, , getEntriesByType] = applyPerformance(performance)\n\n      const checkSlowSession = () => {\n        if (!timing) {\n          return false\n        }\n        const loadTime = timing.loadEventEnd - timing.navigationStart\n        return loadTime > slowSessionThreshold\n      }\n      const isSlowSession = checkSlowSession()\n      const cacheEntries = getEntriesByType(RESOURCE_PERFORMANCE_ENTRY_TYPE) as PerformanceResourceTiming[]\n      cacheEntries.forEach((e) => reportResource(e, isSlowSession))\n\n      tearDownGroup.push(\n        getResourceObserver()[0]((entry) => {\n          reportResource(entry)\n        }),\n      )\n    }),\n  )\n}\n","import { initSubjectInGlobal, WithSubject } from '@slardar/sdk-template'\n\nimport { loadSubject } from '../../collector/page'\nimport { resourceSubject } from '../../collector/pref'\nimport { resourceGetterWithContext, ResourceProps } from '../../monitors/resource'\nimport { WebClient } from '../../types'\n\nimport { getPluginConfig } from './utils'\n\nexport const RESOURCE_MONITOR_PLUGIN_NAME = 'resource'\n\nexport type ResourceMonitorConfig = ResourceProps\n\nconst defaultConfig: ResourceMonitorConfig = {\n  ignoreUrls: [],\n  slowSessionThreshold: 4000,\n}\nexport interface ResourceMonitorPluginConfig {\n  [RESOURCE_MONITOR_PLUGIN_NAME]?: Partial<ResourceMonitorConfig> | boolean\n}\n\nexport function ResourceMonitorPlugin<C extends WithSubject<WebClient>>(client: C) {\n  client.on('init', () => {\n    const config = getPluginConfig(client, RESOURCE_MONITOR_PLUGIN_NAME, defaultConfig)\n    if (!config) {\n      return\n    }\n\n    const tearDownGroup: (() => void)[] = []\n\n    resourceGetterWithContext(\n      client.report.bind(client),\n      tearDownGroup,\n      [initSubjectInGlobal(client, loadSubject), () => initSubjectInGlobal(client, resourceSubject)],\n      config,\n    )\n\n    client.on('beforeDestroy', () => {\n      tearDownGroup.forEach((e) => e())\n    })\n  })\n}\n","/* eslint-disable @typescript-eslint/prefer-nullish-coalescing */\nimport { isFunction, isString } from '@slardar/sdk-template'\n\nimport { ResourceErrorPayload } from '../../types'\nimport { getFullUrl } from '../../utils'\n\nimport { ResourceErrorData } from './type'\n\nexport type Target = HTMLScriptElement | HTMLLinkElement | HTMLImageElement | HTMLVideoElement\n\nexport function isHTMLLinkElement(target: Target): target is HTMLLinkElement {\n  return target.tagName.toLowerCase() === 'link'\n}\n\nexport function getElementAttr<T extends Target>(target: T, attr: KeysMatching<T, string, string>) {\n  if (isFunction(target.getAttribute)) {\n    // returns what was in the HTML. It may be a relative URL.\n    return target.getAttribute(attr) || ''\n  }\n\n  // target.src returns absoulute path\n  return target[attr] || ''\n}\n\n// 从 T 中获取满足以下条件的属性：属性的类型是 V, 属性的值是 M\ntype KeysMatching<T, V, M> = { [K in keyof T]-?: K extends V ? (T[K] extends M ? K : never) : never }[keyof T]\n\nexport const getSrc = (target: Target): string =>\n  getElementAttr(target, isHTMLLinkElement(target) ? 'href' : ('src' as any))\n\nexport const getDataFromEvent = (e: Event): ResourceErrorData | undefined => {\n  const target = (e.target || e.srcElement) as Target | null\n  if (!target) {\n    return\n  }\n  const tagName = target.tagName\n  if (!tagName || !isString(tagName)) {\n    return\n  }\n  const src = getSrc(target)\n  return {\n    url: src,\n    tagName: tagName,\n  }\n}\n\nexport const buildPayload = (\n  data: ResourceErrorData,\n  getEntriesByName: (name: string) => PerformanceEntryList,\n): ResourceErrorPayload => {\n  const { url, tagName, xpath } = data\n  const fullUrl = getFullUrl(url)\n  const timing = getEntriesByName(fullUrl)[0] as PerformanceResourceTiming | undefined\n\n  return {\n    type: tagName.toLowerCase(),\n    url: fullUrl,\n    xpath,\n    timing,\n  }\n}\n","import { SafeObservable, getRegexp } from '@slardar/sdk-template'\n\nimport { ErrorNext } from '../../collector/error'\nimport { WebReportEvent } from '../../types'\nimport { getDefaultPerformance, applyPerformance, getDefaultBrowser } from '../../utils'\n\nimport { ResourceErrorData, ResourceErrorProps } from './type'\nimport { getDataFromEvent, buildPayload } from './util'\n\ntype ResourceErrorGetterWithContext = (\n  report: (ev: WebReportEvent) => void,\n  tearDownGroup: (() => void)[],\n  context: [SafeObservable<ErrorNext>],\n  config: ResourceErrorProps,\n) => ((data: ResourceErrorData) => void) | undefined\n\nconst RESOURCE_ERROR_EV_TYPE = 'resource_error'\n\nexport const resourceErrorGetterWithContext: ResourceErrorGetterWithContext = (\n  report,\n  tearDownGroup,\n  [errorObserver],\n  config,\n) => {\n  const window = getDefaultBrowser()\n  if (!window) return\n\n  const { ignoreUrls, includeUrls, dedupe } = config\n  const includeRegExp = getRegexp(includeUrls)\n  const ignoreRegExp = getRegexp(ignoreUrls)\n  const [, , , , getEntriesByName] = applyPerformance(getDefaultPerformance())\n\n  let lastErrPath: undefined | string = undefined\n\n  const reportResourceError = (data: ResourceErrorData) => {\n    const locationHref = location && location.href\n    if (locationHref && data.url === locationHref) return\n    if ((includeRegExp && !includeRegExp.test(data.url)) || (ignoreRegExp && ignoreRegExp.test(data.url))) return\n\n    if (!data.url) return\n\n    if (dedupe && data.url === lastErrPath) return\n\n    lastErrPath = data.url\n    // when the error occurs, the timing has been pushed into the buffer pool\n    // so use getEntriesByName instead of resourceObserver\n    const payload = buildPayload(data, getEntriesByName)\n    if (payload) {\n      report({\n        ev_type: RESOURCE_ERROR_EV_TYPE,\n        payload: payload,\n      })\n    }\n  }\n\n  tearDownGroup.push(\n    errorObserver[0]((event) => {\n      const e = event || window.event\n      if (!e) {\n        return\n      }\n      const data = getDataFromEvent(e)\n      data && reportResourceError(data)\n    }),\n  )\n\n  return reportResourceError\n}\n","import { WithSubject, initSubjectInGlobal } from '@slardar/sdk-template'\n\nimport { errorSubject } from '../../collector/error'\nimport { resourceErrorGetterWithContext } from '../../monitors/resource-error'\nimport { ResourceErrorProps, ReportResourceError } from '../../monitors/resource-error/type'\nimport { WebClient } from '../../types'\n\nimport { getPluginConfig } from './utils'\n\nexport const RESOURCE_ERROR_MONITOR_PLUGIN_NAME = 'resourceError'\n\nexport type WithReportResourceError<C extends WebClient> = C & {\n  reportResourceError?: ReportResourceError\n}\nexport type ResourceErrorMonitorConfig = ResourceErrorProps\nconst defaultConfig: ResourceErrorMonitorConfig = {\n  includeUrls: [],\n  ignoreUrls: [],\n  dedupe: true,\n}\n\nexport interface ResourceErrorMonitorPluginConfig {\n  [RESOURCE_ERROR_MONITOR_PLUGIN_NAME]?: Partial<ResourceErrorMonitorConfig> | boolean\n}\n\nexport function ResourceErrorMonitorPlugin<C extends WithSubject<WebClient>>(client: C) {\n  client.on('init', () => {\n    const config = getPluginConfig(client, RESOURCE_ERROR_MONITOR_PLUGIN_NAME, defaultConfig)\n    if (!config) {\n      return\n    }\n\n    const tearDownGroup: (() => void)[] = []\n\n    const reportResourceError = resourceErrorGetterWithContext(\n      client.report.bind(client),\n      tearDownGroup,\n      [initSubjectInGlobal(client, errorSubject)],\n      config,\n    )\n\n    client.on('beforeDestroy', () => {\n      tearDownGroup.forEach((e) => e())\n    })\n\n    reportResourceError && client.provide('reportResourceError', reportResourceError)\n  })\n}\n","/* eslint-disable @typescript-eslint/prefer-optional-chain */\nimport { PerformanceReport } from '../../types/report'\nimport { PerformancePayload } from '../../types/thrift/browser/collector_v2/performance'\n\nexport const defaultMetricContext = {\n  isSupport: true,\n  isPolyfill: false,\n  isBounced: false,\n  isCustom: false,\n  type: 'perf',\n}\n\nexport const initMetric = (name: string, value: number): PerformancePayload => {\n  return {\n    name,\n    value,\n    ...defaultMetricContext,\n  }\n}\n\ntype GetFunction<P, B> = (params?: P) => B\n\nexport const invokeGetOnce = <T, B>(cb: GetFunction<T, B>): [(params?: T) => B | undefined] => {\n  let hasGetted = false\n  const invoke = (params?: T) => {\n    if (hasGetted) return undefined\n\n    // 如果执行后依旧未拿到，直接返回\n    const value = cb && cb(params)\n    if (!value) return undefined\n\n    // 标记【拿到过数据】并返回数据\n    hasGetted = true\n    return value\n  }\n  return [invoke]\n}\n\nexport const buildSingleMetricPayload = (singleMetric: PerformancePayload): PerformanceReport => ({\n  ev_type: 'performance',\n  payload: singleMetric,\n})\n","/* eslint-disable @typescript-eslint/prefer-nullish-coalescing */\nimport { PerformanceMonitor } from '../../monitors/performance'\nimport { CLSMonitor } from '../../monitors/performance/cls-monitor'\nimport { LongtaskMonitor } from '../../monitors/performance/longtask-monitor'\nimport { SPAMonitor } from '../../monitors/performance/spa-monitor'\nimport { PerformanceInit, PerformanceSend } from '../../monitors/performance/spa-monitor/type'\nimport { PerformanceMonitorUserConfig, PerformancePrecollect } from '../../monitors/performance/type'\nimport { defaultMetricContext } from '../../monitors/performance/util'\nimport { PerformancePayload, WebClient, PerformanceLongtaskPayload } from '../../types'\nimport { applyMonitor, onPageUnload, getLocationUrl } from '../../utils'\n\nimport { getPluginConfig, reportOnInitCommonParams } from './utils'\n\nexport { PerformancePrecollect }\n\nexport const PERFORMANCE_MONITOR_PLUGIN_NAME = 'performance'\n\ntype CustomPerformancePayload = Partial<Omit<PerformancePayload, 'name' | 'value'>> &\n  Pick<PerformancePayload, 'name' | 'value'>\n\nexport type WithSendPerformance<C extends WebClient> = C & {\n  sendCustomPerfMetric?: (metric: CustomPerformancePayload) => void\n  performanceInit?: PerformanceInit\n  performanceSend?: PerformanceSend\n}\n\nexport type WithPerformancePrecollect<C extends WebClient> = C & {\n  pp?: PerformancePrecollect\n}\n\nexport const defaultPerformancePrecollect: PerformancePrecollect = {\n  entries: [],\n  observer: undefined,\n}\n\nconst defaultConfig: PerformanceMonitorUserConfig = {\n  fp: true,\n  fcp: true,\n  fid: true,\n  mpfid: true,\n  lcp: true,\n  cls: true,\n  timing: true,\n  longtask: true,\n}\nexport interface PerformanceMonitorPluginConfig {\n  [PERFORMANCE_MONITOR_PLUGIN_NAME]?: Partial<PerformanceMonitorUserConfig> | boolean\n}\n\nexport function PerformanceMonitorPlugin<C extends WithPerformancePrecollect<WebClient>>(client: C) {\n  client.on('init', () => {\n    const precollect = client.pp || defaultPerformancePrecollect\n\n    // clear precollect observer no matter what is configured\n    precollect.observer?.disconnect()\n\n    const config = getPluginConfig(client, PERFORMANCE_MONITOR_PLUGIN_NAME, defaultConfig)\n    if (!config) {\n      return\n    }\n\n    applyMonitor(PerformanceMonitor, { ...config, precollect }, reportOnInitCommonParams(client))\n\n    const sendPrefMetric = (metric: PerformancePayload) => {\n      client.report({ ev_type: 'performance', payload: metric })\n    }\n\n    // spa_load\n    const [performanceInit, performanceSend] = applyMonitor(SPAMonitor, 0, sendPrefMetric)\n\n    client.provide('performanceInit', performanceInit)\n    client.provide('performanceSend', performanceSend)\n\n    // longtasks\n    if (config.longtask) {\n      const sendPerformanceLongtask = (longtaskPayload: PerformanceLongtaskPayload) => {\n        client.report({ ev_type: 'performance_longtask', payload: longtaskPayload })\n      }\n\n      const [longtaskTearDown] = applyMonitor(LongtaskMonitor, { precollect }, sendPerformanceLongtask)\n      client.on('beforeDestroy', longtaskTearDown)\n    }\n\n    // cls\n    if (config.cls) {\n      let originUrl = getLocationUrl()\n      const sendCLS = (metric: PerformancePayload) => {\n        client.report({ ev_type: 'performance', payload: metric, overrides: { url: originUrl } })\n      }\n\n      const [countAndClear, tearDown] = applyMonitor(CLSMonitor, [precollect], sendCLS)\n      client.on('beforeConfig', (newConfig) => {\n        if (newConfig.viewId && newConfig.viewId !== client.config()?.viewId) {\n          countAndClear()\n          originUrl = getLocationUrl()\n        }\n      })\n\n      client.on('beforeDestroy', tearDown)\n      onPageUnload(countAndClear)\n    }\n\n    // clear precollect data after consumed\n    precollect.entries.length = 0\n\n    // provide custom performance API\n    const invokeCustomMetricCb = (customMetric: CustomPerformancePayload) => {\n      const payload = {\n        ...defaultMetricContext,\n        ...customMetric,\n        isCustom: true,\n      }\n      sendPrefMetric(payload)\n    }\n\n    client.provide('sendCustomPerfMetric', invokeCustomMetricCb)\n  })\n}\n","import { WebReportEvent, PerformanceLongTaskReport, CommonContext } from '../../types'\nimport { PerformancePayload } from '../../types/thrift/browser/collector_v2/performance'\nimport { PerformanceLongtask } from '../../types/thrift/browser/collector_v2/performance_longtask'\nimport { now } from '../../utils'\nimport { initMetric } from '../performance/util'\n\nexport const SINGLE_METRIC_EV_TYPE = 'performance'\n\nexport const LONG_TASK_EV_TYPE = 'performance_longtask'\n\nexport const applySendOnceAndTearDown = <T>(\n  wrapPerformanceMetric: (metric: T) => WebReportEvent,\n  report: (ev: WebReportEvent) => void,\n  tearDownGroup: (() => void)[],\n) => {\n  let hasInvoked = false\n  return (metric: T) => {\n    tearDownGroup.length &&\n      tearDownGroup.forEach((v) => {\n        v()\n      })\n    tearDownGroup.length = 0\n    if (hasInvoked) return\n    hasInvoked = true\n    report && report(wrapPerformanceMetric(metric))\n  }\n}\n\nexport const wrapPerformanceMetric = (\n  metric: PerformancePayload,\n  overrides?: Partial<CommonContext>,\n): WebReportEvent => ({\n  ev_type: SINGLE_METRIC_EV_TYPE,\n  payload: metric,\n  overrides: overrides,\n})\n\nexport const wrapLongtask = (entry: PerformanceLongtask): PerformanceLongTaskReport => ({\n  ev_type: LONG_TASK_EV_TYPE,\n  payload: {\n    type: 'perf',\n    longtasks: [entry],\n  },\n})\n\nexport const applyReportMetric = (report: (ev: WebReportEvent) => void) => {\n  return (metric: PerformancePayload, overrides?: Partial<CommonContext>) => {\n    report(wrapPerformanceMetric(metric, overrides))\n  }\n}\n\nexport const SPA_LOAD_METRIC_NAME = 'spa_load'\nexport const getSPA = (report: (ev: WebReportEvent) => void) => {\n  let startTime = 0\n  const metric = initMetric(SPA_LOAD_METRIC_NAME, 0)\n\n  const invokeCb = (load_time: number) => {\n    metric.value = load_time\n    report && report(wrapPerformanceMetric(metric))\n  }\n\n  const performanceInit = () => {\n    startTime = now()\n  }\n  const performanceSend = () => {\n    invokeCb(now() - startTime)\n    startTime = 0\n  }\n\n  return [performanceInit, performanceSend]\n}\n","import { SafeObservable } from '@slardar/sdk-template'\n\nimport { HiddenNext, UnloadNext, observePerf, PVNext } from '../../collector'\nimport { WebReportEvent } from '../../types'\nimport { getDefaultPerformanceObserver, getDefaultPerformance, applyPerformance } from '../../utils'\nimport { MetricEnum } from '../performance/type'\nimport { initMetric } from '../performance/util'\n\nimport { PerfMetricGetterWithHiddenContext } from './type'\nimport { applySendOnceAndTearDown, wrapPerformanceMetric } from './util'\n\nexport const FCP_ENTRY_NAME = 'first-contentful-paint'\nexport const FP_ENTRY_NAME = 'first-paint'\nexport const FP_METRIC_NAME = MetricEnum.fp\nexport const FCP_METRIC_NAME = MetricEnum.fcp\nconst Paint_Type = 'paint'\n\nconst getFP: PerfMetricGetterWithHiddenContext = (report, tearDownGroup, context) => {\n  return getPaint(FP_ENTRY_NAME, FP_METRIC_NAME, report, tearDownGroup, context)\n}\n\nconst getFCP: PerfMetricGetterWithHiddenContext = (report, tearDownGroup, context) => {\n  return getPaint(FCP_ENTRY_NAME, FCP_METRIC_NAME, report, tearDownGroup, context)\n}\n\nexport const getPaint = (\n  entryName: string,\n  metricName: string,\n  report: (ev: WebReportEvent) => void,\n  tearDownGroup: (() => void)[],\n  [hiddenObserver, unloadObserver]: [SafeObservable<HiddenNext>, SafeObservable<UnloadNext>, SafeObservable<PVNext>],\n) => {\n  const PerformanceObserver = getDefaultPerformanceObserver()\n  const performance = getDefaultPerformance()\n\n  const metric = initMetric(metricName, 0)\n  const sendOnceAndTearDown = applySendOnceAndTearDown(wrapPerformanceMetric, report, tearDownGroup)\n\n  if (!performance || !PerformanceObserver) {\n    metric.isSupport = false\n    sendOnceAndTearDown(metric)\n    return\n  }\n\n  const invokePaint = ({ startTime }: PerformanceEntry) => {\n    metric.value = startTime\n    sendOnceAndTearDown(metric)\n  }\n\n  const [, , , , getEntriesByName] = applyPerformance(performance)\n  const paint = getEntriesByName(entryName)[0]\n\n  if (paint) {\n    invokePaint(paint)\n    return\n  }\n\n  tearDownGroup.push(\n    observePerf(\n      PerformanceObserver,\n      (entry: PerformanceEntry) => {\n        entry.name === entryName && invokePaint(entry)\n      },\n      [Paint_Type],\n    ),\n  )\n\n  tearDownGroup.push(\n    hiddenObserver[0](() => {\n      metric.isSupport = false\n      sendOnceAndTearDown(metric)\n    }),\n  )\n\n  tearDownGroup.push(\n    unloadObserver[0](() => {\n      metric.isBounced = true\n      sendOnceAndTearDown(metric)\n    }),\n  )\n}\n\nexport const FP: [MetricEnum, PerfMetricGetterWithHiddenContext] = [FP_METRIC_NAME, getFP]\nexport const FCP: [MetricEnum, PerfMetricGetterWithHiddenContext] = [FCP_METRIC_NAME, getFCP]\n","/* eslint-disable @typescript-eslint/prefer-for-of */\n/* eslint-disable @typescript-eslint/prefer-optional-chain */\n/* eslint-disable @typescript-eslint/prefer-nullish-coalescing */\nimport { SafeObservable, applyRecord, arrayIncludes, noop } from '@slardar/sdk-template'\n\nimport { PVNext } from '../../collector/client'\nimport { XHRNext, FetchNext } from '../../collector/http'\nimport { LongtaskNext, ResourceNext, LONGTASK_TYPE } from '../../collector/pref'\nimport { WebReportEvent } from '../../types'\nimport { PerformanceLongtask } from '../../types/thrift/browser/collector_v2/performance_longtask'\nimport {\n  applyPerformance,\n  getDefaultMutationObserver,\n  applyMutationObserver,\n  now as absoluteNow,\n  getDefaultPerformance,\n} from '../../utils'\nimport { getFetchMethod } from '../http/fetch'\nimport { initMetric } from '../performance/util'\n\nimport { FCP_ENTRY_NAME } from './paint'\nimport { applySendOnceAndTearDown, wrapPerformanceMetric } from './util'\n\nconst TTI_METRIC_NAME = 'tti'\nconst GET_METHOD = 'get'\nconst QUIET_TIME_LIMIT = 5000\n\nexport interface ResourceAndRequestItem {\n  start: number\n  end: number\n}\nexport interface NEWPerformanceLongTask extends PerformanceLongtask {\n  start: number\n  end: number\n}\n\ninterface PerformancePrecollect {\n  entries: PerformanceEntry[]\n  observer?: PerformanceObserver\n}\n\ntype TTIPerfMetricGetterWithLoadContext = (\n  report: (ev: WebReportEvent) => void,\n  tearDownGroup: (() => void)[],\n  context: [\n    SafeObservable<XHRNext>,\n    SafeObservable<FetchNext>,\n    SafeObservable<LongtaskNext>,\n    SafeObservable<ResourceNext>,\n    SafeObservable<PVNext>,\n  ],\n  config: PerformancePrecollect | undefined,\n) => void\n\n/**\n * start 方法开启一个调度器，传入回调和调度时间\n * reschedule 重新以一个更长的时间调度\n * stop 停止调度\n */\nexport const applyScheduler = (now: typeof performance['now']) => {\n  let timerActiveTime = -Infinity\n  let timerId: number | undefined = undefined\n  let callback: (() => void) | undefined\n\n  const clearTime = () => window.clearTimeout(timerId)\n  const reschedule = (futureTime: number) => {\n    if (timerActiveTime > futureTime || !callback) {\n      return\n    }\n    clearTime()\n    timerId = window.setTimeout(callback, futureTime - now())\n    timerActiveTime = futureTime\n  }\n  const start = (cb: () => void, futureTime: number) => {\n    callback = cb\n    reschedule(futureTime)\n  }\n  const stop = () => {\n    clearTime()\n    callback = undefined\n  }\n\n  return [start, stop, reschedule] as const\n}\n\n/**\n * Computes the time (in milliseconds since requestStart) that the network was\n * last known to have >2 requests in-flight.\n */\nexport const calcLastNet2Busy = (\n  undoneReqStarts: number[],\n  observedResReqs: ResourceAndRequestItem[],\n  now: typeof performance['now'],\n) => {\n  if (undoneReqStarts.length > 2) {\n    return now()\n  }\n\n  const enum ENDPOINT_TYPE {\n    S,\n    E,\n  }\n  const endpoints: [number, ENDPOINT_TYPE][] = []\n  for (let i = 0; i < observedResReqs.length; i++) {\n    endpoints.push([observedResReqs[i].start, ENDPOINT_TYPE.S], [observedResReqs[i].end, ENDPOINT_TYPE.E])\n  }\n\n  for (let i = 0; i < undoneReqStarts.length; i++) {\n    endpoints.push([undoneReqStarts[i], ENDPOINT_TYPE.S])\n  }\n\n  endpoints.sort((a, b) => a[0] - b[0])\n\n  let currentActive = undoneReqStarts.length\n\n  for (let i = endpoints.length - 1; i >= 0; i--) {\n    const [timestamp, type] = endpoints[i]\n    switch (type) {\n      case ENDPOINT_TYPE.S:\n        currentActive--\n        break\n      case ENDPOINT_TYPE.E:\n        currentActive++\n        if (currentActive > 2) {\n          return timestamp\n        }\n        break\n    }\n  }\n\n  // If we reach here, we were never network 2-busy.\n  return 0\n}\n\nexport const getRequestTimes = (requestTimes: Record<number, number>) => {\n  const keys = Object.keys(requestTimes)\n  const result: number[] = []\n  // eslint-disable-next-line @typescript-eslint/prefer-for-of\n  for (let i = 0; i < keys.length; i++) {\n    const val = requestTimes[keys[i]]\n    if (typeof val === 'number') {\n      result.push(val)\n    }\n  }\n  return result\n}\n\ninterface NodeWithChildren extends Node {\n  children: NodeList\n}\n\n/**\n * 监听包含 ['img', 'script', 'iframe', 'link', 'audio', 'video', 'source'] 标签的 dom 变更\n */\nexport const observeResFetchMutations = (\n  MutationObserver: typeof window.MutationObserver | null | undefined | false,\n  callback: (mutation: MutationRecord) => void,\n) => {\n  const requestCreatingNodeNames = ['img', 'script', 'iframe', 'link', 'audio', 'video', 'source']\n\n  function subtreeContainsNodeName(nodes: NodeList, nodeNames: string[]) {\n    for (let i = 0; i < nodes.length; i++) {\n      if (\n        arrayIncludes(nodeNames, nodes[i].nodeName.toLowerCase()) ||\n        ((nodes[i] as NodeWithChildren).children &&\n          subtreeContainsNodeName((nodes[i] as NodeWithChildren).children, nodeNames))\n      ) {\n        return true\n      }\n    }\n    return false\n  }\n\n  const [observe, disconnect] = applyMutationObserver(MutationObserver, (mutations) => {\n    for (let i = 0; i < mutations.length; i++) {\n      if (\n        (mutations[i].type === 'childList' &&\n          subtreeContainsNodeName(mutations[i].addedNodes, requestCreatingNodeNames)) ||\n        (mutations[i].type === 'attributes' &&\n          arrayIncludes(requestCreatingNodeNames, mutations[i].target.nodeName.toLowerCase()))\n      ) {\n        callback(mutations[i])\n      }\n    }\n  })\n\n  return [\n    () =>\n      observe(document, {\n        attributes: true,\n        childList: true,\n        subtree: true,\n        attributeFilter: ['href', 'src'],\n      }),\n    disconnect,\n  ] as const\n}\n\n/**\n * Returns either a manually set min value or the time since\n * domContentLoadedEventEnd and navigationStart. If the\n * domContentLoadedEventEnd data isn't available, `null` is returned.\n * @return {number|null}\n */\nexport const getMinValue = (timing?: PerformanceTiming) => {\n  const { domContentLoadedEventEnd, navigationStart = 0 } = timing || {}\n  return domContentLoadedEventEnd ? domContentLoadedEventEnd - navigationStart : null\n}\n\n/**\n * Computes the TTI value...\n * @param {number} searchStart\n * @param {number} minValue\n * @param {number} lastKnownNetwork2Busy\n * @param {number} currentTime\n * @param {!Array<{start: (number), end: (number)}>} longTasks\n * @return {number|null}\n */\nexport const computeTTI = (\n  searchStart: number,\n  minValue: number,\n  lastKnownNetwork2Busy: number,\n  currentTime: number,\n  longTasks: Array<{ start: number; end: number }>,\n) => {\n  // Have not reached network 2-quiet yet.\n  if (currentTime - lastKnownNetwork2Busy < QUIET_TIME_LIMIT) {\n    return null\n  }\n\n  const maybeFCI = longTasks.length === 0 ? searchStart : longTasks[longTasks.length - 1].end\n\n  // Main thread has not been quiet for long enough.\n  if (currentTime - maybeFCI < QUIET_TIME_LIMIT) {\n    return null\n  }\n\n  return Math.max(maybeFCI, minValue)\n}\n\nconst pushLongTaskIntoList = (entry: PerformanceEntry, list: NEWPerformanceLongTask[]) => {\n  const { startTime, duration } = entry\n  ;(entry as any).start = startTime\n  ;(entry as any).end = startTime + duration\n  list.push(entry as any as NEWPerformanceLongTask)\n}\n\nexport const getLastBusyAndLongTasks =\n  (\n    tearDownGroup: (() => void)[],\n    [xhrObserver, fetchObserver, longtaskObserver, resourceObserver, MutationObserver]: [\n      SafeObservable<XHRNext>,\n      SafeObservable<FetchNext>,\n      SafeObservable<LongtaskNext>,\n      SafeObservable<ResourceNext>,\n      typeof window.MutationObserver | undefined,\n    ],\n    entries: PerformanceEntry[],\n  ) =>\n  (reschedule: (futureTime: number) => void, now: () => number): [NEWPerformanceLongTask[], () => number] => {\n    const longTasks: NEWPerformanceLongTask[] = []\n    const networkRequests: ResourceAndRequestItem[] = []\n    const [incompleteInitReqStartTimes, before, after] = applyRecord<number, number>()\n\n    entries.forEach((entry) => {\n      if (entry.entryType === LONGTASK_TYPE[0]) {\n        pushLongTaskIntoList(entry, longTasks)\n      }\n    })\n\n    let uniqId = 0\n    tearDownGroup.push(\n      xhrObserver[0](([_method]) => {\n        if ((_method || '').toLowerCase() !== GET_METHOD) return noop\n        const requestId = (uniqId += 1)\n        before(requestId, absoluteNow())\n        return () => {\n          after(requestId)\n        }\n      }),\n    )\n\n    tearDownGroup.push(\n      fetchObserver[0](([req, options]) => {\n        if (!window.Request || getFetchMethod(req, options, window.Request) !== GET_METHOD) return noop\n        const requestId = (uniqId += 1)\n        before(requestId, absoluteNow())\n        return () => {\n          after(requestId)\n        }\n      }),\n    )\n\n    const [observeRes, stopObserveRes] =\n      (MutationObserver && observeResFetchMutations(MutationObserver, () => reschedule(now() + QUIET_TIME_LIMIT))) || []\n    observeRes && observeRes()\n\n    const getLastBusy = () => calcLastNet2Busy(getRequestTimes(incompleteInitReqStartTimes), networkRequests, now)\n\n    stopObserveRes && tearDownGroup.push(stopObserveRes as () => void)\n\n    tearDownGroup.push(\n      longtaskObserver[0]((entry) => {\n        pushLongTaskIntoList(entry, longTasks)\n        const { startTime, duration } = entry\n        // 遇到 longTask 则在 longTask 5秒后 checkTTI\n        reschedule(startTime + duration + QUIET_TIME_LIMIT)\n      }),\n    )\n\n    tearDownGroup.push(\n      resourceObserver[0](({ fetchStart, responseEnd }) => {\n        networkRequests.push({\n          start: fetchStart,\n          end: responseEnd,\n        })\n        // 遇到 resource 加载，则在最后一次 busy 5 秒后 checkTTI\n        reschedule(getLastBusy() + QUIET_TIME_LIMIT)\n      }),\n    )\n\n    tearDownGroup.push(() => {\n      longTasks.length = 0\n      networkRequests.length = 0\n    })\n\n    return [longTasks, getLastBusy]\n  }\n\nexport const getTTI: TTIPerfMetricGetterWithLoadContext = (\n  report,\n  tearDownGroup,\n  [xhrObserver, fetchObserver, longtaskObserver, resourceObserver, pvObserver],\n  config,\n) => {\n  const metric = initMetric(TTI_METRIC_NAME, 0)\n  const sendOnceAndTearDown = applySendOnceAndTearDown(wrapPerformanceMetric, report, tearDownGroup)\n  const performance = getDefaultPerformance()\n\n  const { entries = [], observer: snippetObserver } = config || {}\n\n  tearDownGroup.push(() => {\n    snippetObserver && snippetObserver.disconnect()\n    entries.length = 0\n  })\n\n  if (\n    !window ||\n    !XMLHttpRequest ||\n    !performance ||\n    !PerformanceObserver ||\n    (PerformanceObserver.supportedEntryTypes &&\n      !arrayIncludes((PerformanceObserver.supportedEntryTypes as string[]) || [], LONGTASK_TYPE[0]))\n  ) {\n    metric.isSupport = false\n    sendOnceAndTearDown(metric)\n    return\n  }\n\n  const [timing, now, , , getEntriesByName] = applyPerformance(performance)\n\n  const [startSchedule, stopSchedule, reschedule] = applyScheduler(now)\n  const [longTasks, getLastBusy] = getLastBusyAndLongTasks(\n    tearDownGroup,\n    [xhrObserver, fetchObserver, longtaskObserver, resourceObserver, getDefaultMutationObserver()],\n    entries,\n  )(reschedule, now)\n\n  tearDownGroup.push(stopSchedule)\n\n  const checkTTI = (ttiCallback: (v: number) => void) => {\n    const firstContentfulPaint = getEntriesByName(FCP_ENTRY_NAME)[0]\n    const maybeFCI = computeTTI(\n      (firstContentfulPaint ? firstContentfulPaint.startTime : getMinValue(timing)) || 0,\n      getMinValue(timing) || 0,\n      getLastBusy(),\n      now(),\n      longTasks,\n    )\n\n    if (!maybeFCI) return reschedule(now() + 1000)\n\n    ttiCallback(maybeFCI)\n  }\n\n  const reportTTI = (value: number) => {\n    metric.value = value\n    sendOnceAndTearDown(metric)\n  }\n\n  const lastLongTask = longTasks[longTasks.length - 1]\n  startSchedule(\n    () => checkTTI(reportTTI),\n    Math.max(getLastBusy() + QUIET_TIME_LIMIT, lastLongTask ? lastLongTask.end : 0),\n  )\n\n  tearDownGroup.push(\n    pvObserver[0](() => {\n      metric.isSupport = false\n      sendOnceAndTearDown(metric)\n    }),\n  )\n}\n","/* eslint-disable @typescript-eslint/prefer-nullish-coalescing */\nimport { initSubjectInGlobal, WithSubject, initPrivateSubject } from '@slardar/sdk-template'\n\nimport { applyPV, PV_SUBJECT_NAME } from '../../collector/client'\nimport { XHR_SUBJECT_NAME, applyXHR, fetchSubject } from '../../collector/http'\nimport { longtaskSubject, resourceSubject } from '../../collector/pref'\nimport { getTTI } from '../../monitors/performance-new/tti'\nimport { WebClient } from '../../types'\n\nimport { WithPerformancePrecollect } from './performance'\nimport { getPluginConfig, reportOnInitCommonParams } from './utils'\n\nexport const TTI_MONITOR_PLUGIN_NAME = 'tti'\n\nexport interface TTIMonitorPluginConfig {\n  [TTI_MONITOR_PLUGIN_NAME]?: boolean | Record<string, unknown>\n}\n\nexport function TTIMonitorPlugin<C extends WithPerformancePrecollect<WithSubject<WebClient>>>(client: C) {\n  client.on('init', () => {\n    const config = getPluginConfig(client, TTI_MONITOR_PLUGIN_NAME, {})\n    if (!config) {\n      return\n    }\n    const tearDownGroup: (() => void)[] = []\n\n    getTTI(\n      reportOnInitCommonParams(client),\n      tearDownGroup,\n      [\n        initSubjectInGlobal(client, [XHR_SUBJECT_NAME, applyXHR(XMLHttpRequest && XMLHttpRequest.prototype)]),\n        initSubjectInGlobal(client, fetchSubject),\n        initSubjectInGlobal(client, longtaskSubject),\n        initSubjectInGlobal(client, resourceSubject),\n        initPrivateSubject(client, [PV_SUBJECT_NAME, applyPV(client)]),\n      ],\n      client.pp,\n    )\n\n    client.on('beforeDestroy', () => {\n      tearDownGroup.forEach((e) => e())\n    })\n  })\n}\n","import { SafeObservable, isFunction } from '@slardar/sdk-template'\n\nimport { LoadNext } from '../../collector/page'\nimport { WebReportEvent } from '../../types'\nimport {\n  getDefaultCaf,\n  getDefaultRaf,\n  applyAnimationFrame,\n  applyMutationObserver,\n  getDefaultPerformance,\n  getDefaultDocument,\n  getDefaultMutationObserver,\n  now,\n} from '../../utils'\nimport { initMetric } from '../performance/util'\n\nimport { applySendOnceAndTearDown, wrapPerformanceMetric } from './util'\n\nconst FMP_METRIC_NAME = 'fmp'\nconst DEFAULT_IGNORE_TAGS = ['SCRIPT', 'STYLE', 'META', 'HEAD']\n\ninterface ScoreItem {\n  score: number\n  time: number\n}\n\ntype FMPPerfMetricGetterWithLoadContext = (\n  report: (ev: WebReportEvent) => void,\n  tearDownGroup: (() => void)[],\n  context: [SafeObservable<LoadNext>],\n) => void\n\nconst getScore = (element: Element | null | undefined | false, depth: number, exist: boolean, ignoreTags: string[]) => {\n  if (!element || ignoreTags.indexOf(element.tagName) > -1) {\n    return 0\n  }\n\n  const { children = [] } = element\n  const score: number = [].slice\n    .call(children)\n    .reduceRight((sum, child) => sum + getScore(child, depth + 1, sum > 0, ignoreTags), 0)\n\n  if (score <= 0 && !exist) {\n    if (!isFunction(element.getBoundingClientRect)) {\n      return 0\n    }\n\n    const { top, height } = element.getBoundingClientRect() || {}\n    if (top > window.innerHeight || height <= 0) {\n      return 0\n    }\n  }\n\n  return score + 1 + 0.5 * depth\n}\n\nconst getFMPInternal = ([first, ...rest]: ScoreItem[] = []) => {\n  return (\n    (rest &&\n      rest.reduce(\n        ([prev, target], cur) => {\n          const diff = cur.score - prev.score\n          return [cur, cur.time >= prev.time && target.rate < diff ? { time: cur.time, rate: diff } : target] as const\n        },\n        [first, { time: first?.time, rate: 0 as number }] as const,\n      )[1].time) ||\n    0\n  )\n}\n\nexport const getFMP: FMPPerfMetricGetterWithLoadContext = (report, tearDownGroup, [loadObserver]) => {\n  const document = getDefaultDocument()\n  const MutationObserver = getDefaultMutationObserver()\n  const performance = getDefaultPerformance()\n  const navigationStart = (performance && performance.timing && performance.timing.navigationStart) || undefined\n\n  const metric = initMetric(FMP_METRIC_NAME, 0)\n  const sendOnceAndTearDown = applySendOnceAndTearDown(wrapPerformanceMetric, report, tearDownGroup)\n\n  if (!document || !MutationObserver || !navigationStart) {\n    metric.isSupport = false\n    sendOnceAndTearDown(metric)\n    return\n  }\n\n  const startTime = now()\n  const list: ScoreItem[] = []\n  const record = () =>\n    list.push({\n      time: now() - startTime,\n      // eslint-disable-next-line compat/compat\n      score: getScore(document && document.body, 1, false, DEFAULT_IGNORE_TAGS),\n    })\n\n  const raf = getDefaultRaf()\n  const caf = getDefaultCaf()\n\n  const [scheduleAF] = applyAnimationFrame(\n    document,\n    raf as Window['requestAnimationFrame'] | undefined,\n    caf as Window['cancelAnimationFrame'] | undefined,\n    true,\n  )\n  // 持续监听 dom 变化，记录下时间和得分\n  // scheduleAF 可以避免强制回流，同时真正的变更是在animationFrame 中\n  const [observe, disconnect] = applyMutationObserver(MutationObserver, () => scheduleAF(record))\n\n  const tirggerFMP = (timeGap = 0) => {\n    const fmp = getFMPInternal(list)\n    metric.value = fmp ? fmp + timeGap : 0\n    sendOnceAndTearDown(metric)\n    list.length = 0\n  }\n  const timeGap = startTime - (navigationStart || 0)\n\n  observe(document, { subtree: true, childList: true })\n\n  tearDownGroup.push(disconnect)\n  tearDownGroup.push(\n    loadObserver[0](() => {\n      setTimeout(() => {\n        tirggerFMP(timeGap)\n      }, 200)\n    }),\n  )\n}\n","import { WithSubject, initSubjectInGlobal } from '@slardar/sdk-template'\n\nimport { loadSubject, unloadSubject, hiddenSubject } from '../../collector/page'\nimport { getFMP } from '../../monitors/performance-new/fmp'\nimport { getPaint, FP_ENTRY_NAME } from '../../monitors/performance-new/paint'\nimport { FMPMonitorConfig } from '../../monitors/performance/fmp-monitor/type'\nimport { WebClient } from '../../types'\n\nimport { getPluginConfig, reportOnInitCommonParams } from './utils'\n\nexport const FMP_MONITOR_PLUGIN_NAME = 'fmp'\n\nconst defaultConfig: FMPMonitorConfig = {\n  renderType: 'CSR',\n}\n\nexport interface FMPMonitorPluginConfig {\n  [FMP_MONITOR_PLUGIN_NAME]?: Partial<FMPMonitorConfig> | boolean\n}\n\nexport function FMPMonitorPlugin<C extends WithSubject<WebClient>>(client: C) {\n  client.on('init', () => {\n    const config = getPluginConfig(client, FMP_MONITOR_PLUGIN_NAME, defaultConfig)\n    if (!config) {\n      return\n    }\n\n    const tearDownGroup: (() => void)[] = []\n    const loadObserver = initSubjectInGlobal(client, loadSubject)\n\n    if (config.renderType === 'SSR') {\n      const hiddenObserver = initSubjectInGlobal(client, hiddenSubject)\n      const unloadObserver = initSubjectInGlobal(client, unloadSubject)\n      // @ts-expect-error\n      getPaint(FP_ENTRY_NAME, FMP_MONITOR_PLUGIN_NAME, reportOnInitCommonParams(client), tearDownGroup, [\n        hiddenObserver,\n        unloadObserver,\n      ])\n    } else {\n      getFMP(reportOnInitCommonParams(client), tearDownGroup, [loadObserver])\n    }\n\n    client.on('beforeDestroy', () => {\n      tearDownGroup.forEach((e) => e())\n    })\n  })\n}\n","import { WebReport, WebReportEvent } from '../../types'\nimport { getDefaultPromise, applyRequestIdleCallback, now } from '../../utils'\n\nimport { BlankRelatedErrorInfo } from './type'\n\nexport const DEFAULT_IGNORE_TAGS = ['SCRIPT', 'STYLE', 'META', 'HEAD']\nexport const ERROR_RELATED_TYPE = ['js_error', 'http', 'resource_error']\nexport const DEFAULT_THRESHOLD = 1.5\n\nexport const MAX_RENDER_TIME = 10000\nexport const MAX_CHECK_TIME = 8000\nexport const DEFAULT_CHECK_TIME = 2000\nexport const MAX_RELATED_TIME = 10000\nexport const DEFAULT_T0_DATA_URL_QUALITY = 0.1\n\nconst CHECK_EXCLUSIVE_EV_TYPES: WebReport['ev_type'][] = [\n  'performance',\n  'performance_longtask',\n  'performance_timing',\n  'custom',\n]\n\nexport const isSkipBeforeCheck = (ev: WebReportEvent) => ~CHECK_EXCLUSIVE_EV_TYPES.indexOf(ev.ev_type)\n\nexport const blankErrorCompare = (\n  relatedError: BlankRelatedErrorInfo | undefined,\n  ev: WebReportEvent,\n): BlankRelatedErrorInfo | undefined => {\n  if (ERROR_RELATED_TYPE.indexOf(ev.ev_type) === -1) return relatedError\n  if (ev.ev_type === 'http' && ev.payload.response.status < 400) {\n    return relatedError\n  }\n  if (relatedError && ERROR_RELATED_TYPE.indexOf(relatedError.type) < ERROR_RELATED_TYPE.indexOf(ev.ev_type)) {\n    return relatedError\n  }\n  let message = ''\n\n  switch (ev.ev_type) {\n    case 'js_error':\n      message = ev.payload.error.message\n      break\n    case 'http':\n      message = ev.payload.request.url\n      break\n    case 'resource_error':\n      message = ev.payload.url\n      break\n    default:\n      break\n  }\n  return { type: ev.ev_type, message, timestamp: now() }\n}\n\nexport const measure = (\n  element: Element | null | undefined | false,\n  depth = 0,\n  sum = 0,\n  threshold = DEFAULT_THRESHOLD,\n  ignoreTags = DEFAULT_IGNORE_TAGS,\n): number => {\n  if (!element || ignoreTags.indexOf(element.tagName) > -1 || sum >= threshold || depth > 4) {\n    return sum\n  }\n\n  const score = (() => {\n    if (!depth) return 0\n    const { top, height } = element.getBoundingClientRect()\n    return top > innerHeight || height <= 0 ? 0 : 1 / Math.pow(2, depth - 1)\n  })()\n\n  return [].reduceRight.call(\n    element.children,\n    (all, child) => measure(child, depth + 1, all as number, threshold, ignoreTags),\n    sum + score,\n  ) as number\n}\n\ndeclare global {\n  interface Window {\n    html2canvas?: (element: HTMLElement, options?: any) => Promise<HTMLCanvasElement>\n  }\n}\n\ninterface TakeScreenshotType {\n  cb: (base64: string) => void\n  screenshotUrl: string\n  window: Window\n  document: Document\n  mask: boolean\n  partialShot: boolean\n  quality: number\n  rootSelector?: string\n}\n\nexport const screenshot = ({\n  cb,\n  screenshotUrl,\n  window,\n  document,\n  mask,\n  partialShot,\n  quality,\n  rootSelector,\n}: TakeScreenshotType) => {\n  if (!getDefaultPromise() || !window || !document) {\n    return\n  }\n\n  function onload() {\n    const requestIdleCallback = applyRequestIdleCallback(window)\n    requestIdleCallback(() => {\n      window.html2canvas &&\n        window.html2canvas!((partialShot && rootSelector && document.querySelector(rootSelector)) || document!.body, {\n          scale: 360 / window!.innerWidth,\n          mask,\n        }).then((canvas) => {\n          cb(canvas.toDataURL('image/jpeg', quality))\n        })\n    })\n  }\n\n  if (window.html2canvas) {\n    return onload()\n  }\n  const script = document.createElement('script')\n  script.src = screenshotUrl\n  // eslint-disable-next-line compat/compat\n  document.head?.appendChild(script)\n  script.onload = onload\n}\n","/* eslint-disable @typescript-eslint/prefer-optional-chain */\nimport { WebReportEvent } from '../../types'\nimport {\n  applyPerformance,\n  applyMutationObserver,\n  applyPerformanceObserver,\n  getDefaultBrowser,\n  getDefaultPerformance,\n  getDefaultDocument,\n  getDefaultMutationObserver,\n  getDefaultPerformanceObserver,\n  onPageUnload,\n  applyRequestIdleCallback,\n  now,\n  onDOMContentLoaded,\n} from '../../utils'\n\nimport { BlankScreenMonitorConstructor, BlankRelatedErrorInfo } from './type'\nimport {\n  screenshot,\n  measure,\n  MAX_RELATED_TIME,\n  blankErrorCompare,\n  MAX_RENDER_TIME,\n  DEFAULT_CHECK_TIME,\n  MAX_CHECK_TIME,\n  isSkipBeforeCheck,\n} from './util'\n\nexport const BlankScreenMonitor: BlankScreenMonitorConstructor = (\n  win = getDefaultBrowser(),\n  document = getDefaultDocument(),\n  performanceObserver = getDefaultPerformanceObserver(),\n  mutationObserver = getDefaultMutationObserver(),\n  performance = getDefaultPerformance(),\n) => {\n  if (!document || !win) {\n    return\n  }\n\n  return (\n    { threshold, screenshot: takeScreenshot, rootSelector, autoDetect, ssUrl, quality, mask, partialShot },\n    cb,\n  ) => {\n    const requestIdleCallback = applyRequestIdleCallback(win)\n    const [, relativeNow] = applyPerformance(performance)\n    let blankInfo: [timestamp: number, score: number] | undefined\n    let errorInfo: BlankRelatedErrorInfo | undefined\n    let otherReportedTimestamp = 0\n    let reported = false\n    let timer: number\n\n    const pureReport = (base64?: string) => {\n      blankInfo &&\n        cb &&\n        cb({\n          ev_type: 'blank_screen',\n          payload: {\n            timestamp: blankInfo[0],\n            score: blankInfo[1],\n            screenshot: base64,\n            error: errorInfo,\n          },\n        })\n    }\n\n    const report = () => {\n      if (!blankInfo || reported) {\n        return\n      }\n      reported = true\n      tearDown()\n\n      takeScreenshot\n        ? screenshot({\n            cb: pureReport,\n            screenshotUrl: ssUrl,\n            window: win,\n            document,\n            mask,\n            partialShot,\n            quality,\n            rootSelector,\n          })\n        : pureReport()\n    }\n\n    const applyOtherReport = (ev: WebReportEvent) => {\n      if (reported || isSkipBeforeCheck(ev)) return\n      otherReportedTimestamp = now()\n      if (errorInfo && otherReportedTimestamp - errorInfo.timestamp > MAX_RELATED_TIME) {\n        errorInfo = undefined\n      }\n      errorInfo = blankErrorCompare(errorInfo, ev)\n    }\n\n    const applyCheck = (cb: () => void) => {\n      let checkTimer: number\n      let checkTimestamp: number\n\n      return () => {\n        if (checkTimer) {\n          return\n        }\n        checkTimestamp = now()\n        checkTimer = win.setTimeout(\n          () => {\n            checkTimer = 0\n            if (otherReportedTimestamp > checkTimestamp) {\n              return\n            }\n            cb()\n          },\n          relativeNow() > MAX_RENDER_TIME ? DEFAULT_CHECK_TIME : MAX_CHECK_TIME,\n        )\n      }\n    }\n\n    const checkAndReport = applyCheck(report)\n\n    onPageUnload(() => {\n      !reported && errorInfo && pureReport()\n    })\n\n    const schedule = () => {\n      timer && clearTimeout(timer)\n      timer = win.setTimeout(() => {\n        requestIdleCallback(() => {\n          win.requestAnimationFrame(() => {\n            // eslint-disable-next-line compat/compat\n            const element = rootSelector ? document.querySelector(rootSelector) : document.body\n            if (!element) {\n              return\n            }\n            const score = measure(element, 0, 0, threshold)\n            if (score < threshold) {\n              blankInfo = [now(), score]\n              checkAndReport()\n            } else {\n              blankInfo = undefined\n            }\n          })\n        })\n      }, 1000)\n    }\n\n    const tearDown = () => {\n      clearTimeout(timer)\n      mutDisconnect && mutDisconnect()\n      perfDisconnect && perfDisconnect()\n    }\n\n    const [mutObserve, mutDisconnect] = applyMutationObserver(mutationObserver, schedule)\n    const [perfObserve, perfDisconnect] = applyPerformanceObserver(\n      performanceObserver,\n      (_a, _i, arr) => timer && arr.length > 1 && schedule(),\n    )\n\n    if (autoDetect)\n      // start observe blank screen after DOMContentLoaded\n      onDOMContentLoaded(() => {\n        mutObserve(getDefaultDocument()?.body, { subtree: true, childList: true })\n        perfObserve('longtask', 'resource')\n        schedule()\n      })\n\n    return [tearDown, applyOtherReport, schedule]\n  }\n}\n","import { BlankScreenMonitor } from '../../monitors/blank-screen'\nimport { BlankScreenMonitorConfig, DetectBlankScreen } from '../../monitors/blank-screen/type'\nimport { DEFAULT_THRESHOLD, DEFAULT_T0_DATA_URL_QUALITY } from '../../monitors/blank-screen/util'\nimport { WebClient, WebReportEvent } from '../../types'\nimport { applyMonitor, getConfig } from '../../utils'\n\nimport { getPluginConfig } from './utils'\n\nexport { BlankScreenMonitorConfig } from '../../monitors/blank-screen/type'\n\nexport const BLANK_SCREEN_MONITOR_PLUGIN_NAME = 'blankScreen'\n\nexport type WithDetectBlankScreen<C extends WebClient> = C & {\n  detectBlankScreen?: DetectBlankScreen\n}\nexport interface BlankScreenMonitorPluginConfig {\n  [BLANK_SCREEN_MONITOR_PLUGIN_NAME]?: Partial<BlankScreenMonitorConfig> | boolean\n}\n\nfunction BlankScreenMonitorBasePlugin<C extends WebClient>(\n  client: C,\n  defaultConfig: BlankScreenMonitorConfig,\n  overrideConfig?: Partial<BlankScreenMonitorConfig>,\n) {\n  client.on('init', () => {\n    const config =\n      getPluginConfig(client, BLANK_SCREEN_MONITOR_PLUGIN_NAME, defaultConfig) ||\n      getConfig(overrideConfig, defaultConfig)\n    if (!config) {\n      return\n    }\n    const [tearDown, applyOtherReport, detectBlankScreen] = applyMonitor(\n      BlankScreenMonitor,\n      config,\n      client.report.bind(client),\n    )\n    const listenOtherReport = (ev: WebReportEvent) => {\n      applyOtherReport(ev)\n      return ev\n    }\n\n    client.on('report', listenOtherReport)\n\n    client.on('beforeDestroy', () => {\n      tearDown()\n      client.off('report', listenOtherReport)\n    })\n\n    client.provide('detectBlankScreen', detectBlankScreen)\n  })\n}\n\nconst defaultByteConfig: BlankScreenMonitorConfig = {\n  autoDetect: true,\n  threshold: DEFAULT_THRESHOLD,\n  screenshot: true,\n  ssUrl: 'https://sf16-short-va.bytedapm.com/slardar/fe/sdk-web/screenshot.min.js',\n  mask: false,\n  partialShot: false,\n  quality: DEFAULT_T0_DATA_URL_QUALITY,\n}\n\nexport function BlankScreenMonitorPlugin<C extends WebClient>(\n  client: C,\n  overrideConfig?: Partial<BlankScreenMonitorConfig>,\n) {\n  BlankScreenMonitorBasePlugin(client, defaultByteConfig, overrideConfig)\n}\n\nconst defaultVolConfig: BlankScreenMonitorConfig = {\n  autoDetect: true,\n  threshold: DEFAULT_THRESHOLD,\n  screenshot: true,\n  ssUrl: 'https://apm.volccdn.com/mars-web/apmplus/web/html2canvas.min.js',\n  mask: false,\n  partialShot: false,\n  quality: DEFAULT_T0_DATA_URL_QUALITY,\n}\n\nexport function BlankScreenMonitorVolPlugin<C extends WebClient>(\n  client: C,\n  overrideConfig?: Partial<BlankScreenMonitorConfig>,\n) {\n  BlankScreenMonitorBasePlugin(client, defaultVolConfig, overrideConfig)\n}\n","const PAGE_ACTIVITY_DELAY = 100\nconst MAX_PAGE_ACTIVITY_DELAY = 10000\nconst ROOT_TAGS = ['BODY', 'HTML', 'HEAD']\n\n/**\n * 控制等待策略和强制结算\n * 结算策略: 没有进行中的请求, 没有dom变更, 没有resource or longTask\n */\nexport const waitActionComplete = (cb: () => void, forceClear: () => void, win: Window) => {\n  let idleTimer: number\n  let maxIdleTimer: number\n  let started = false\n\n  const notify = () => {\n    win.clearTimeout(idleTimer)\n    started &&\n      (idleTimer = win.setTimeout(() => {\n        cb()\n      }, PAGE_ACTIVITY_DELAY))\n  }\n\n  const start = () => {\n    started = true\n    win.clearTimeout(maxIdleTimer)\n    maxIdleTimer = win.setTimeout(() => {\n      cb()\n      forceClear()\n    }, MAX_PAGE_ACTIVITY_DELAY)\n    notify()\n  }\n\n  const complete = () => {\n    started = false\n    win.clearTimeout(idleTimer)\n    win.clearTimeout(maxIdleTimer)\n  }\n  return [start, notify, complete]\n}\n\n/**\n * 从target中获取path\n */\nexport const getDomPath = (element: HTMLElement): string | undefined => {\n  let el = element\n  const stack = []\n  try {\n    while (el.parentNode !== null) {\n      let sibCount = 0\n      let sibIndex = 0\n      // eslint-disable-next-line @typescript-eslint/prefer-for-of\n      for (let i = 0; i < el.parentNode.childNodes.length; i++) {\n        const sib = el.parentNode.childNodes[i]\n        if (sib.nodeName === el.nodeName) {\n          if (sib === el) {\n            sibIndex = sibCount\n          }\n          sibCount++\n        }\n      }\n      if (el.hasAttribute('id') && el.id !== '') {\n        stack.unshift(el.nodeName + '#' + el.id)\n      } else if (sibCount > 1) {\n        stack.unshift(el.nodeName + ':eq(' + sibIndex + ')')\n      } else {\n        stack.unshift(el.nodeName)\n      }\n      el = el.parentNode as HTMLElement\n    }\n    // removes the html element\n    return stack.slice(1).join('>')\n  } catch {\n    return\n  }\n}\n\nexport const isSupportsElementClosest = (() => {\n  let supportsElementClosest: boolean | undefined\n  return () =>\n    supportsElementClosest === undefined\n      ? (supportsElementClosest = 'closest' in HTMLElement.prototype)\n      : supportsElementClosest\n})()\n\nexport const findElementWithAttributeByParents = (target: HTMLElement, attribute: string, maxParentLoops = 10) => {\n  let element: Element | null = target\n  for (let i = 0; i < maxParentLoops && element; i++) {\n    if (~ROOT_TAGS.indexOf(element.nodeName)) return\n    if (element.hasAttribute(attribute)) {\n      return element\n    }\n    element = element.parentElement\n  }\n}\n\nexport const getActionNameByAttribute = (target: HTMLElement, attribute: string) => {\n  let elementWithAttribute\n  if (isSupportsElementClosest()) {\n    elementWithAttribute = target.closest(`[${attribute}]`)\n  } else {\n    elementWithAttribute = findElementWithAttributeByParents(target, attribute)\n  }\n  if (!elementWithAttribute) return\n\n  const name = elementWithAttribute.getAttribute(attribute)!\n  // Possibly length of name is too long to be stored on backend.Let it go for now.Add truncation if someone oncalled\n  return name.trim()\n}\n\nexport const getActionName = (target: HTMLElement, attribute: string) => {\n  return getActionNameByAttribute(target, attribute) || target.innerText\n}\n","import { SafeObservable, applyRecord, arrayIncludes, uuid } from '@slardar/sdk-template'\n\nimport { XHRNext, FetchNext } from '../../collector/http'\nimport { ActionPayload, WebReportEvent } from '../../types'\nimport { applyPerformance, applyMutationObserver, now as absoluteNow } from '../../utils'\n\nimport { waitActionComplete, getDomPath, getActionName } from './util'\n\nexport const enum ActionType {\n  CLICK = 'click',\n}\n\nconst ACTION_EV_TYPE = 'action'\nconst HTTP_EV_TYPE = 'http'\nconst LONGTASK_RV_TYPE = 'performance_longtask'\nconst JS_ERROR_EV_TYPE = 'js_error'\nconst RESOURCE_EV_TYPE = 'resource'\nconst RELATED_EV_TYPES = [LONGTASK_RV_TYPE, HTTP_EV_TYPE, JS_ERROR_EV_TYPE, RESOURCE_EV_TYPE]\nconst SUPPORT_TYPES = [ActionType.CLICK]\nconst EVENT_LISTENER_OPTIONS = { capture: true }\n\nexport const DEFAULT_ATTR_NAME = 'data-apm-action'\n\nexport interface ActionMonitorConfig {\n  types: string[] | false\n  // ignore association for each of action\n  pure?: boolean\n}\nexport interface StartAction {\n  (name: string, type: string): void\n}\nexport interface ApplyOtherReport {\n  (ev: WebReportEvent): string | undefined\n}\n\ntype ActionGetterWithContext = (\n  report: (ev: WebReportEvent) => void,\n  tearDownGroup: (() => void)[],\n  context: [SafeObservable<XHRNext>, SafeObservable<FetchNext>],\n  config: ActionMonitorConfig,\n) => [ApplyOtherReport, StartAction]\n\n/**\n * 劫持 XHR 和 fetch，监听当前页面未完成的 请求数量\n */\nexport const applyIncompleteReq = (\n  tearDownGroup: (() => void)[],\n  [xhrObserver, fetchObserver]: [SafeObservable<XHRNext>, SafeObservable<FetchNext>],\n  notify: () => void,\n) => {\n  const [incompleteReq, before, after] = applyRecord<number, number>()\n\n  let uniqId = 0\n  tearDownGroup.push(\n    xhrObserver[0](([_method]) => {\n      const requestId = (uniqId += 1)\n      before(requestId, absoluteNow())\n      notify()\n      return () => {\n        after(requestId)\n        notify()\n      }\n    }),\n  )\n\n  tearDownGroup.push(\n    fetchObserver[0](() => {\n      const requestId = (uniqId += 1)\n      before(requestId, absoluteNow())\n      notify()\n      return () => {\n        after(requestId)\n        notify()\n      }\n    }),\n  )\n  return incompleteReq\n}\n\nexport const actionGetterWithFetchObserver: ActionGetterWithContext = (\n  report,\n  tearDownGroup,\n  [xhrObserver, fetchObserver],\n  config,\n) => {\n  const { types, pure } = config\n  let currentPayload: ActionPayload | null = null\n  let requestStartAndEnd: number[] = []\n  let longtaskDuration = 0\n\n  const [, now] = applyPerformance(performance)\n  // 结算\n  const reportActionIfAllowed = () => {\n    // 不存在action上下文 || 未收集到相关payload || 依然有进行中的请求\n    if (\n      !currentPayload ||\n      (!pure && !Object.keys(currentPayload.metrics!).length) ||\n      Object.keys(incompleteReq).length\n    ) {\n      return\n    }\n    // longtask duration\n    currentPayload.metrics![LONGTASK_RV_TYPE] && (currentPayload.metrics![LONGTASK_RV_TYPE].duration = longtaskDuration)\n\n    // request duration\n    const requestDuration =\n      requestStartAndEnd.length > 0 ? Math.max(...requestStartAndEnd) - Math.min(...requestStartAndEnd) : 0\n    currentPayload.metrics![HTTP_EV_TYPE] && (currentPayload.metrics![HTTP_EV_TYPE].duration = requestDuration)\n\n    // end time\n    const actionDuration = now() - currentPayload.start_time\n    report({\n      ev_type: ACTION_EV_TYPE,\n      payload: {\n        ...currentPayload,\n        duration: actionDuration,\n        frontend_time: actionDuration - requestDuration,\n      },\n    })\n\n    // 上报后重置数据\n    resetAction()\n  }\n\n  const resetAction = () => {\n    complete()\n    currentPayload = null\n    requestStartAndEnd = []\n    longtaskDuration = 0\n  }\n\n  const [start, notify, complete] = waitActionComplete(reportActionIfAllowed, resetAction, window)\n\n  const incompleteReq = applyIncompleteReq(tearDownGroup, [xhrObserver, fetchObserver], notify)\n\n  const [observe, disconnect] = applyMutationObserver(MutationObserver, notify)\n  observe()\n  tearDownGroup.push(disconnect)\n\n  // 补充数据\n  const applyOtherReport = (ev: WebReportEvent) => {\n    if (!currentPayload) {\n      return\n    }\n    if (!arrayIncludes(RELATED_EV_TYPES, ev.ev_type)) {\n      return\n    }\n    // 通知监听，有相关变更\n    notify()\n\n    if (ev.ev_type === HTTP_EV_TYPE) {\n      if (!ev.payload.response.timing) {\n        return\n      }\n      const { startTime, duration } = ev.payload.response.timing\n      if (startTime < currentPayload.start_time) {\n        return\n      }\n      requestStartAndEnd.push(startTime, startTime + duration)\n    } else if (ev.ev_type === LONGTASK_RV_TYPE) {\n      if (!ev.payload.longtasks.length || ev.payload.longtasks[0].startTime < currentPayload.start_time) {\n        return\n      }\n      ev.payload.longtasks.forEach((e) => {\n        longtaskDuration = longtaskDuration + e.duration\n      })\n      // eslint-disable-next-line sonarjs/no-collapsible-if\n    } else if (ev.ev_type === RESOURCE_EV_TYPE) {\n      if ((ev.payload as PerformanceResourceTiming).startTime < currentPayload.start_time) {\n        return\n      }\n    }\n    currentPayload.metrics![ev.ev_type] = {\n      count: (currentPayload.metrics![ev.ev_type]?.count ?? 0) + 1,\n    }\n    return currentPayload.id\n  }\n\n  const initAction = (target: { name: string; path?: string }, type: string) => {\n    // refresh action id in common\n    const actionId = uuid()\n    const [, now] = applyPerformance(performance)\n\n    // init payload\n    currentPayload = {\n      start_time: now(),\n      id: actionId,\n      type,\n      target: target,\n      metrics: {},\n    }\n    start()\n  }\n\n  const handleEvent = (e: Event) => {\n    reportActionIfAllowed()\n    resetAction()\n\n    if (!(e.target instanceof HTMLElement)) {\n      return\n    }\n\n    const name = getActionName(e.target, DEFAULT_ATTR_NAME)\n    if (!name) {\n      return\n    }\n    initAction({ name, path: getDomPath(e.target) }, e.type)\n  }\n\n  types &&\n    types.forEach((t) => {\n      if (arrayIncludes(SUPPORT_TYPES, t)) {\n        document.addEventListener(t, handleEvent, EVENT_LISTENER_OPTIONS)\n        tearDownGroup.push(() => document.removeEventListener(t, handleEvent, EVENT_LISTENER_OPTIONS))\n      }\n    })\n\n  const startAction = (name: string, type: string) => {\n    reportActionIfAllowed()\n    resetAction()\n    initAction({ name }, type)\n  }\n\n  return [applyOtherReport, startAction]\n}\n","import { WithSubject, initSubjectInGlobal } from '@slardar/sdk-template'\n\nimport { fetchSubject, XHR_SUBJECT_NAME, applyXHR } from '../../collector/http'\nimport { ActionType, ActionMonitorConfig, StartAction, actionGetterWithFetchObserver } from '../../monitors/action'\nimport { WebClient, WebReportEvent } from '../../types'\nimport { getDefaultDocument, getDefaultBrowser } from '../../utils'\n\nimport { getPluginConfig } from './utils'\n\nexport const ACTION_MONITOR_PLUGIN_NAME = 'action'\n\nexport { ActionMonitorConfig } from '../../monitors/action'\n\nexport type WithAction<C extends WebClient> = C & {\n  startAction?: StartAction\n}\nexport interface ActionMonitorPluginConfig {\n  [ACTION_MONITOR_PLUGIN_NAME]?: boolean | Partial<ActionMonitorConfig>\n}\n\nconst defaultConfig: ActionMonitorConfig = {\n  types: [ActionType.CLICK],\n}\n\nexport function ActionMonitorBasePlugin<C extends WithSubject<WebClient>>(\n  client: C,\n  config: ActionMonitorConfig = defaultConfig,\n) {\n  const tearDownGroup: (() => void)[] = []\n  const document = getDefaultDocument()\n  const window = getDefaultBrowser()\n  if (!document || !window) return\n\n  const [applyOtherReport, startAction] = actionGetterWithFetchObserver(\n    client.report.bind(client),\n    tearDownGroup,\n    [\n      initSubjectInGlobal(client, [XHR_SUBJECT_NAME, applyXHR(XMLHttpRequest && XMLHttpRequest.prototype)]),\n      initSubjectInGlobal(client, fetchSubject),\n    ],\n    config,\n  )\n  const listenOtherReport = (ev: WebReportEvent) => {\n    const actionId = applyOtherReport(ev)\n    actionId && ev.extra && (ev.extra.action_id = actionId)\n    return ev\n  }\n\n  client.on('report', listenOtherReport)\n\n  client.provide('startAction', startAction)\n\n  client.on('beforeDestroy', () => {\n    tearDownGroup.forEach((e) => e())\n    client.off('report', listenOtherReport)\n  })\n}\n\nexport function ActionMonitorPlugin<C extends WithSubject<WebClient>>(client: C) {\n  client.on('init', () => {\n    const config = getPluginConfig(client, ACTION_MONITOR_PLUGIN_NAME, defaultConfig)\n    if (!config) {\n      return\n    }\n    ActionMonitorBasePlugin(client, config)\n  })\n}\n","import { HeatMapConfig } from '../../types/thrift/web/site/sdk_setting'\n\nexport const HEATMAP_MONITOR_PLUGIN_NAME = 'heatmap'\n\ntype HeatmapMonitorConfig = HeatMapConfig\n\nexport interface HeatmapMonitorPluginConfig {\n  [HEATMAP_MONITOR_PLUGIN_NAME]?: Partial<HeatmapMonitorConfig> | boolean\n}\n","import { SafeObservable } from '@slardar/sdk-template'\n\nimport { HiddenNext, UnloadNext, observePerfWithBuffer, PVNext } from '../../collector'\nimport { getDefaultPerformanceObserver } from '../../utils'\nimport { MetricEnum } from '../performance/type'\nimport { initMetric } from '../performance/util'\n\nimport { PerfMetricGetterWithHiddenContext } from './type'\nimport { applySendOnceAndTearDown, wrapPerformanceMetric } from './util'\n\nexport const LCP_ENTRY_NAME = 'largest-contentful-paint'\nexport const LCP_METRIC_NAME = MetricEnum.lcp\n\nconst LCPListenerEventTypes = ['keydown', 'click']\n\nconst getLCP: PerfMetricGetterWithHiddenContext = (\n  report,\n  tearDownGroup,\n  [hiddenObserver, unloadObserver]: [SafeObservable<HiddenNext>, SafeObservable<UnloadNext>, SafeObservable<PVNext>],\n) => {\n  const PerformanceObserver = getDefaultPerformanceObserver()\n\n  const metric = initMetric(LCP_METRIC_NAME, 0)\n  const sendOnceAndTearDown = applySendOnceAndTearDown(wrapPerformanceMetric, report, tearDownGroup)\n\n  if (!PerformanceObserver) {\n    metric.isSupport = false\n    sendOnceAndTearDown(metric)\n    return\n  }\n\n  tearDownGroup.push(\n    observePerfWithBuffer(\n      PerformanceObserver,\n      ({ startTime }) => {\n        metric.value = startTime\n      },\n      LCP_ENTRY_NAME,\n    ),\n  )\n\n  const inputEventHandler = () => {\n    sendOnceAndTearDown(metric)\n  }\n\n  LCPListenerEventTypes.forEach((type) => {\n    window.addEventListener(type, inputEventHandler, true)\n    tearDownGroup.push(() => {\n      window.removeEventListener(type, inputEventHandler, true)\n    })\n  })\n\n  tearDownGroup.push(\n    hiddenObserver[0](() => {\n      metric.isSupport = false\n      sendOnceAndTearDown(metric)\n    }),\n  )\n\n  tearDownGroup.push(\n    unloadObserver[0](() => {\n      metric.isBounced = true\n      sendOnceAndTearDown(metric)\n    }),\n  )\n}\n\nexport const LCP: [MetricEnum, PerfMetricGetterWithHiddenContext] = [LCP_METRIC_NAME, getLCP]\n","import { observePerf } from '../../collector/pref'\nimport { getDefaultPerformanceObserver, getDefaultPerformance, applyPerformance } from '../../utils'\nimport { MetricEnum } from '../performance/type'\nimport { initMetric } from '../performance/util'\n\nimport { PerfMetricGetterWithoutContext } from './type'\nimport { applySendOnceAndTearDown, wrapPerformanceMetric } from './util'\n\nexport const FI_ENTRY_NAME = 'first-input'\nexport const FID_METRIC_NAME = MetricEnum.fid\n\nconst getFID: PerfMetricGetterWithoutContext = (report, tearDownGroup) => {\n  const PerformanceObserver = getDefaultPerformanceObserver()\n  const performance = getDefaultPerformance()\n\n  const metric = initMetric(FID_METRIC_NAME, 0)\n  const sendOnceAndTearDown = applySendOnceAndTearDown(wrapPerformanceMetric, report, tearDownGroup)\n\n  if (!performance || !PerformanceObserver) {\n    metric.isSupport = false\n    sendOnceAndTearDown(metric)\n    return\n  }\n\n  const invokePaint = ({ processingStart, startTime }: PerformanceEventTiming) => {\n    metric.value = processingStart - startTime\n    sendOnceAndTearDown(metric)\n  }\n\n  const [, , getEntriesByType] = applyPerformance(performance)\n  const paint = getEntriesByType(FI_ENTRY_NAME)[0] as PerformanceEventTiming | undefined\n\n  if (paint) {\n    invokePaint(paint)\n    return\n  }\n\n  tearDownGroup.push(observePerf(PerformanceObserver, invokePaint, [FI_ENTRY_NAME]))\n}\n\nexport const FID: [MetricEnum, PerfMetricGetterWithoutContext] = [FID_METRIC_NAME, getFID]\n","import { SafeObservable } from '@slardar/sdk-template'\n\nimport { PVNext, HiddenNext, UnloadNext } from '../../collector'\nimport { observePerfWithBuffer } from '../../collector/pref'\nimport { getDefaultPerformanceObserver } from '../../utils'\nimport { MetricEnum } from '../performance/type'\nimport { initMetric } from '../performance/util'\n\nimport { PerfMetricGetterWithHiddenContext } from './type'\nimport { applyReportMetric } from './util'\n\ninterface LayoutShift extends PerformanceEntry {\n  value: number\n  hadRecentInput: boolean\n}\n\nexport const LS_ENTRY_NAME = 'layout-shift'\nexport const CLS_METRIC_NAME = MetricEnum.cls\n\nexport const applyHandleEntries = () => {\n  let sessionValue = 0\n  let sessionTimes: number[] = []\n  const resetSessionValue = () => {\n    sessionValue = 0\n  }\n  const handleEntriesWithMetric = (callback: (currentSessionValue: number) => void, entry: LayoutShift) => {\n    // Only count layout shifts without recent user input.\n    if (!entry.hadRecentInput) {\n      const firstSessionTime = sessionTimes[0]\n      const lastSessionTime = sessionTimes[sessionTimes.length - 1]\n\n      if (sessionValue && entry.startTime - lastSessionTime < 1000 && entry.startTime - firstSessionTime < 5000) {\n        sessionValue += entry.value\n        sessionTimes.push(entry.startTime)\n      } else {\n        sessionValue = entry.value\n        sessionTimes = [entry.startTime]\n      }\n      callback(sessionValue)\n    }\n  }\n  return [resetSessionValue, handleEntriesWithMetric] as const\n}\n\nconst getCLS: PerfMetricGetterWithHiddenContext = (\n  report,\n  tearDownGroup,\n  [hiddenObserver, unloadObserver, pvObserver]: [\n    SafeObservable<HiddenNext>,\n    SafeObservable<UnloadNext>,\n    SafeObservable<PVNext>,\n  ],\n) => {\n  const PerformanceObserver = getDefaultPerformanceObserver()\n\n  let metric = initMetric(CLS_METRIC_NAME, 0)\n\n  const reportMetric = applyReportMetric(report)\n\n  if (!PerformanceObserver) {\n    metric.isSupport = false\n    reportMetric(metric)\n    return\n  }\n\n  const [resetSessionValue, handleEntriesWithMetric] = applyHandleEntries()\n\n  const handleEntries = handleEntriesWithMetric.bind(null, (sessionValue) => {\n    sessionValue > metric.value && (metric.value = sessionValue)\n  })\n\n  tearDownGroup.push(observePerfWithBuffer(PerformanceObserver, handleEntries, LS_ENTRY_NAME))\n\n  tearDownGroup.push(hiddenObserver[0](resetSessionValue))\n\n  tearDownGroup.push(\n    pvObserver[0]((overrides) => {\n      reportMetric(metric, overrides)\n      resetSessionValue()\n      metric = initMetric(CLS_METRIC_NAME, 0)\n    }),\n  )\n\n  tearDownGroup.push(\n    unloadObserver[0](() => {\n      reportMetric(metric)\n    }),\n  )\n}\n\nexport const CLS: [MetricEnum, PerfMetricGetterWithHiddenContext] = [CLS_METRIC_NAME, getCLS]\n","import { SafeObservable } from '@slardar/sdk-template'\n\nimport { LoadNext, UnloadNext } from '../../collector/page'\nimport { LongtaskNext } from '../../collector/pref'\nimport { PerformanceLongtask } from '../../types/thrift/browser/collector_v2/performance_longtask'\nimport { MetricEnum } from '../performance/type'\n\nimport { PerfMetricGetterWithLoadContext } from './type'\nimport { wrapLongtask } from './util'\n\nexport const LONGTASK_METRIC_NAME = MetricEnum.longtask\n\nconst getLongtask: PerfMetricGetterWithLoadContext = (\n  report,\n  tearDownGroup,\n  [, , longtaskObserver]: [SafeObservable<LoadNext>, SafeObservable<UnloadNext>, SafeObservable<LongtaskNext>],\n) => {\n  tearDownGroup.push(\n    longtaskObserver[0]((entry: PerformanceLongtask) => {\n      report(wrapLongtask(entry))\n    }),\n  )\n}\n\nexport const LONGTASK: [MetricEnum, PerfMetricGetterWithLoadContext] = [LONGTASK_METRIC_NAME, getLongtask]\n","import { SafeObservable } from '@slardar/sdk-template'\n\nimport { LoadNext, UnloadNext } from '../../collector/page'\nimport { LongtaskNext } from '../../collector/pref'\nimport { PerformanceTimingReport } from '../../types'\nimport { applyPerformance, getDefaultPerformance } from '../../utils'\nimport { MetricEnum } from '../performance/type'\n\nimport { PerfMetricGetterWithLoadContext } from './type'\nimport { applySendOnceAndTearDown } from './util'\n\nexport const TIMING_METRIC_NAME = MetricEnum.timing\n\nconst getTiming: PerfMetricGetterWithLoadContext = (\n  report,\n  tearDownGroup,\n  [loadObserver, unloadObserver]: [SafeObservable<LoadNext>, SafeObservable<UnloadNext>, SafeObservable<LongtaskNext>],\n) => {\n  const performance = getDefaultPerformance()\n  const [, , getEntriesByType] = applyPerformance(performance)\n  const wrapTiming = (isBounced: boolean): PerformanceTimingReport => {\n    const timing = (performance && performance.timing) || undefined\n    const navigation = getEntriesByType('navigation')[0] as PerformanceNavigationTiming | undefined\n    return {\n      ev_type: 'performance_timing',\n      payload: {\n        isBounced,\n        timing,\n        navigation_timing: navigation,\n      },\n    }\n  }\n\n  const sendOnceAndTearDown = applySendOnceAndTearDown(wrapTiming, report, tearDownGroup)\n\n  tearDownGroup.push(\n    loadObserver[0](() => {\n      sendOnceAndTearDown(false)\n    }),\n  )\n\n  tearDownGroup.push(\n    unloadObserver[0](() => {\n      sendOnceAndTearDown(true)\n    }),\n  )\n}\n\nexport const TIMING: [MetricEnum, PerfMetricGetterWithLoadContext] = [TIMING_METRIC_NAME, getTiming]\n","import { SafeObservable } from '@slardar/sdk-template'\n\nimport { LoadNext, UnloadNext } from '../../collector/page'\nimport { LongtaskNext } from '../../collector/pref'\nimport { getDefaultPerformanceObserver, getDefaultPerformance, applyPerformance } from '../../utils'\nimport { MetricEnum } from '../performance/type'\nimport { initMetric } from '../performance/util'\n\nimport { FCP_ENTRY_NAME } from './paint'\nimport { PerfMetricGetterWithLoadContext } from './type'\nimport { applySendOnceAndTearDown, wrapPerformanceMetric } from './util'\n\nexport const MPFID_METRIC_NAME = MetricEnum.mpfid\n\nconst getMPFID: PerfMetricGetterWithLoadContext = (\n  report,\n  tearDownGroup,\n  [loadObserver, , longtaskObserver]: [\n    SafeObservable<LoadNext>,\n    SafeObservable<UnloadNext>,\n    SafeObservable<LongtaskNext>,\n  ],\n) => {\n  const PerformanceObserver = getDefaultPerformanceObserver()\n  const performance = getDefaultPerformance()\n\n  const metric = initMetric(MPFID_METRIC_NAME, 0)\n  const list: PerformanceEntry[] = []\n  const sendOnceAndTearDown = applySendOnceAndTearDown(wrapPerformanceMetric, report, tearDownGroup)\n\n  if (!PerformanceObserver) {\n    metric.isSupport = false\n    sendOnceAndTearDown(metric)\n    return\n  }\n\n  tearDownGroup.push(\n    longtaskObserver[0]((entry: PerformanceEntry) => {\n      list.push(entry)\n    }),\n  )\n\n  const calculateAndSendMetric = () => {\n    const [, , , , getEntriesByName] = applyPerformance(performance)\n    const paint = getEntriesByName(FCP_ENTRY_NAME)[0]\n    const FCPStartTime = (paint && paint.startTime) || 0\n    metric.value = list.reduce(\n      (res, { duration, startTime }) => (res < duration && startTime > FCPStartTime ? duration : res),\n      0,\n    )\n    list.length = 0\n    sendOnceAndTearDown(metric)\n  }\n\n  tearDownGroup.push(\n    loadObserver[0](() => {\n      setTimeout(calculateAndSendMetric, 200)\n    }),\n  )\n}\n\nexport const MPFID: [MetricEnum, PerfMetricGetterWithLoadContext] = [MPFID_METRIC_NAME, getMPFID]\n","import { initSubjectInGlobal, WithSubject, initPrivateSubject } from '@slardar/sdk-template'\n\nimport { applyPV, applyFirstPV, FIRST_PV_SUBJECT_NAME, PV_SUBJECT_NAME } from '../../collector/client'\nimport { hiddenSubject, unloadSubject, loadSubject } from '../../collector/page'\nimport { longtaskSubject } from '../../collector/pref'\nimport { FP, FCP, LCP, FID, CLS, LONGTASK, TIMING, MPFID } from '../../monitors/performance-new'\nimport {\n  wrapPerformanceMetric,\n  getSPA,\n  SINGLE_METRIC_EV_TYPE,\n  LONG_TASK_EV_TYPE,\n} from '../../monitors/performance-new/util'\nimport { defaultMetricContext } from '../../monitors/performance/util'\nimport { WebClient, PerformancePayload, CommonContext, WebReportEvent } from '../../types'\n\nimport { WithPerformancePrecollect, PERFORMANCE_MONITOR_PLUGIN_NAME, defaultPerformancePrecollect } from './performance'\nimport { getPluginConfig } from './utils'\n\ntype CustomPerformancePayload = Partial<Omit<PerformancePayload, 'name' | 'value'>> &\n  Pick<PerformancePayload, 'name' | 'value'>\n\nexport function PerformanceMonitorPlugin<C extends WithPerformancePrecollect<WithSubject<WebClient>>>(client: C) {\n  client.on('init', () => {\n    const precollect = client.pp || defaultPerformancePrecollect\n\n    // clear precollect observer no matter what is configured\n    precollect.observer?.disconnect()\n\n    const config = getPluginConfig(client, PERFORMANCE_MONITOR_PLUGIN_NAME, {})\n    if (!config) return\n\n    const hiddenObserver = initSubjectInGlobal(client, hiddenSubject)\n    const unloadObserver = initSubjectInGlobal(client, unloadSubject)\n    const loadObserver = initSubjectInGlobal(client, loadSubject)\n    const longtaskObserver = initSubjectInGlobal(client, longtaskSubject)\n    const tearDownGroup: (() => void)[][] = []\n\n    let overrides: Partial<CommonContext> | undefined = undefined\n    const firstPVObserver = initPrivateSubject(client, [FIRST_PV_SUBJECT_NAME, applyFirstPV(client)], -1)\n    firstPVObserver[0]((o) => {\n      overrides = o\n    })()\n\n    const reportMetric = (data: WebReportEvent) => {\n      // every first screen metrics needs to be associated with the context when client init, but CLS and long task are not included\n      const payloadWithOverrides =\n        (data.ev_type === SINGLE_METRIC_EV_TYPE && (data.payload as PerformancePayload).name === CLS[0]) ||\n        data.ev_type === LONG_TASK_EV_TYPE\n          ? data\n          : {\n              ...data,\n              overrides,\n            }\n      client.report(payloadWithOverrides)\n    }\n\n    const pvObserver = initPrivateSubject(client, [PV_SUBJECT_NAME, applyPV(client)])\n    ;[FP, FCP, LCP, FID, CLS].forEach((cur) => {\n      if (config[cur[0]] !== false) {\n        const tearDown: (() => void)[] = []\n        cur[1](reportMetric, tearDown, [hiddenObserver, unloadObserver, pvObserver])\n        tearDownGroup.push(tearDown)\n      }\n    })\n    ;[LONGTASK, TIMING, MPFID].forEach((cur) => {\n      if (config[cur[0]] !== false) {\n        const tearDown: (() => void)[] = []\n        cur[1](reportMetric, tearDown, [loadObserver, unloadObserver, longtaskObserver])\n        tearDownGroup.push(tearDown)\n      }\n    })\n\n    // spa_load\n    const [performanceInit, performanceSend] = getSPA(client.report.bind(client))\n\n    client.provide('performanceInit', performanceInit)\n    client.provide('performanceSend', performanceSend)\n\n    // clear precollect data after consumed\n    precollect.entries.length = 0\n\n    // provide custom performance API\n    const sendPref = (customMetric: CustomPerformancePayload) => {\n      const payload = {\n        ...defaultMetricContext,\n        ...customMetric,\n        isCustom: true,\n      }\n      client.report(wrapPerformanceMetric(payload))\n    }\n    client.provide('sendCustomPerfMetric', sendPref)\n\n    client.on('beforeDestroy', () => {\n      tearDownGroup\n        .reduce((pre, cur) => {\n          return pre.concat(cur)\n        }, [])\n        .forEach((fn) => fn())\n      tearDownGroup.length = 0\n    })\n  })\n}\n","import { SafeObservable } from '@slardar/sdk-template'\n\nimport { PVNext } from '../../collector/client'\nimport { XHRNext, FetchNext } from '../../collector/http'\nimport { LongtaskNext, ResourceNext } from '../../collector/pref'\nimport { WebReportEvent } from '../../types'\nimport { applyMutationObserver } from '../../utils'\nimport { now } from '../../utils/date'\nimport { applyIncompleteReq } from '../action'\nimport { waitActionComplete } from '../action/util'\nimport { initMetric } from '../performance/util'\n\nimport { SPA_LOAD_METRIC_NAME, applyReportMetric } from './util'\n\nexport type SPAGetterWithContext = (\n  report: (ev: WebReportEvent) => void,\n  tearDownGroup: (() => void)[],\n  context: [\n    SafeObservable<PVNext>,\n    SafeObservable<XHRNext>,\n    SafeObservable<FetchNext>,\n    SafeObservable<ResourceNext>,\n    SafeObservable<LongtaskNext>,\n    typeof MutationObserver,\n  ],\n) => void\n\nexport const getSPA: SPAGetterWithContext = (\n  report,\n  tearDownGroup,\n  [pvObserver, xhrObserver, fetchObserver, resourceObserver, longtaskObserver, MutationObserver],\n) => {\n  let spa_load_start = 0\n  const reportMetric = applyReportMetric(report)\n\n  const startSPA = () => {\n    spa_load_start = now()\n    observe(document, {\n      childList: true,\n      subtree: true,\n    })\n    start()\n  }\n\n  const reportSPAIfAllowed = () => {\n    if (Object.keys(incompleteReq).length || !spa_load_start) {\n      return\n    }\n    reportMetric(initMetric(SPA_LOAD_METRIC_NAME, now() - spa_load_start))\n    endSPA()\n  }\n\n  const endSPA = () => {\n    complete()\n    spa_load_start = 0\n    disconnect()\n  }\n\n  const [start, notify, complete] = waitActionComplete(reportSPAIfAllowed, endSPA, window)\n\n  // request\n  const incompleteReq = applyIncompleteReq(tearDownGroup, [xhrObserver, fetchObserver], notify)\n\n  // resource\n  tearDownGroup.push(resourceObserver[0](notify))\n  // longtask\n  tearDownGroup.push(longtaskObserver[0](notify))\n  // dom\n  const [observe, disconnect] = applyMutationObserver(MutationObserver, notify)\n\n  tearDownGroup.push(disconnect)\n\n  let isFirstPV = true\n  // start SPA when PV change\n  tearDownGroup.push(\n    pvObserver[0](() => {\n      if (isFirstPV) {\n        isFirstPV = false\n        return\n      }\n      // force end last SPA if not report\n      endSPA()\n      // start a new SPA metric\n      startSPA()\n    }),\n  )\n  // reset SPA status when tear down\n  tearDownGroup.push(endSPA)\n}\n","import { WithSubject, initSubjectInGlobal, initPrivateSubject } from '@slardar/sdk-template'\n\nimport { PV_SUBJECT_NAME, applyPV } from '../../collector/client'\nimport { fetchSubject, XHR_SUBJECT_NAME, applyXHR } from '../../collector/http'\nimport { resourceSubject, longtaskSubject } from '../../collector/pref'\nimport { getSPA } from '../../monitors/performance-new/spa'\nimport { WebClient } from '../../types'\nimport { getDefaultDocument, getDefaultMutationObserver } from '../../utils'\n\nexport function SPALoadMonitorPlugin<C extends WithSubject<WebClient>>(client: C) {\n  client.on('init', () => {\n    const tearDownGroup: (() => void)[] = []\n    const document = getDefaultDocument()\n    const MutationObserver = getDefaultMutationObserver()\n    if (!document || !MutationObserver) return\n    getSPA(client.report.bind(client), tearDownGroup, [\n      initPrivateSubject(client, [PV_SUBJECT_NAME, applyPV(client)]),\n      initSubjectInGlobal(client, [XHR_SUBJECT_NAME, applyXHR(XMLHttpRequest && XMLHttpRequest.prototype)]),\n      initSubjectInGlobal(client, fetchSubject),\n      initSubjectInGlobal(client, resourceSubject),\n      initSubjectInGlobal(client, longtaskSubject),\n      MutationObserver,\n    ])\n\n    client.on('beforeDestroy', () => {\n      tearDownGroup.forEach((e) => e())\n    })\n  })\n}\n","import { AnyClient, isNumber, isObject, isString, safeStringify } from '@slardar/sdk-template'\n\nimport { CustomReport } from '../types'\nimport { now } from '../utils'\n\nexport type CustomEventData = {\n  name: string\n  metrics?: { [key: string]: number }\n  categories?: { [key: string]: string }\n}\n\nexport type CustomLogData = {\n  content: string\n  level?: string // 'debug' | 'info' | 'warn' | 'error'\n  extra?: { [key: string]: number | string }\n}\n\nexport type SendCustomEvent = (data: CustomEventData) => void\nexport type SendCustomLog = (data: CustomLogData) => void\n\nexport type WithSendCustom<C extends AnyClient> = C & {\n  sendEvent?: SendCustomEvent\n  sendLog?: SendCustomLog\n}\n\nconst CUSTOM_EV_TYPE = 'custom'\nconst CUSTOM_EVENT_TYPE = 'event'\nconst CUSTOM_LOG_TYPE = 'log'\n\nexport const normalizeCustomEventData = (raw: unknown): CustomReport['payload'] | undefined => {\n  if (!raw || !isObject(raw)) {\n    return\n  }\n\n  // name is required\n  if (!raw['name'] || !isString(raw['name'])) {\n    return\n  }\n\n  const res = {\n    name: raw['name'],\n    type: CUSTOM_EVENT_TYPE,\n  } as CustomReport['payload']\n\n  if ('metrics' in raw && isObject(raw['metrics'])) {\n    const rMetrics = raw['metrics']\n    const metrics = {} as Record<string, number>\n    for (const k in rMetrics) {\n      if (isNumber(rMetrics[k])) {\n        metrics[k] = rMetrics[k]\n      }\n    }\n    res.metrics = metrics\n  }\n\n  if ('categories' in raw && isObject(raw['categories'])) {\n    const rCategories = raw['categories']\n    const categories = {} as Record<string, string>\n    for (const k in rCategories) {\n      categories[k] = safeStringify(rCategories[k])\n    }\n    res.categories = categories\n  }\n\n  return res\n}\n\nexport const normalizeCustomLogData = (raw: unknown): CustomReport['payload'] | undefined => {\n  if (!raw || !isObject(raw)) {\n    return\n  }\n\n  // content is required\n  if (!raw['content'] || !isString(raw['content'])) {\n    return\n  }\n\n  const rContent = raw['content']\n\n  const res = {\n    content: safeStringify(rContent),\n    type: CUSTOM_LOG_TYPE,\n    level: 'info',\n  } as CustomReport['payload']\n\n  if ('level' in raw) {\n    res.level = raw['level']\n  }\n\n  if ('extra' in raw && isObject(raw['extra'])) {\n    const rExtra = raw['extra']\n    const metrics = {} as Record<string, number>\n    const categories = {} as Record<string, string>\n    for (const k in rExtra) {\n      if (isNumber(rExtra[k])) {\n        metrics[k] = rExtra[k]\n      } else {\n        categories[k] = safeStringify(rExtra[k])\n      }\n    }\n    res.metrics = metrics\n    res.categories = categories\n  }\n\n  return res\n}\n\nexport const CustomPlugin = (client: AnyClient) => {\n  const sendEvent = (data: CustomEventData) => {\n    const normalized = normalizeCustomEventData(data)\n\n    if (normalized) {\n      client.report({\n        ev_type: CUSTOM_EV_TYPE,\n        payload: normalized,\n        extra: {\n          timestamp: now(),\n        },\n      })\n    }\n  }\n\n  const sendLog = (data: CustomLogData) => {\n    const normalized = normalizeCustomLogData(data)\n\n    if (normalized) {\n      client.report({\n        ev_type: CUSTOM_EV_TYPE,\n        payload: normalized,\n        extra: {\n          timestamp: now(),\n        },\n      })\n    }\n  }\n\n  client.provide('sendEvent', sendEvent)\n  client.provide('sendLog', sendLog)\n}\n","/* eslint-disable @typescript-eslint/prefer-nullish-coalescing */\nimport { WebReportEvent, WebClient } from '../types'\nimport { getDefaultNetworkInformation, NetworkInformation } from '../utils'\n\nexport function getNetworkType(netInfo?: NetworkInformation) {\n  return netInfo?.effectiveType || netInfo?.type || ''\n}\n\nexport const InjectNetworkTypePlugin = (client: WebClient) => {\n  const netInfo = getDefaultNetworkInformation()\n  let network_type = getNetworkType(netInfo)\n  if (netInfo) {\n    netInfo.onchange = () => {\n      network_type = getNetworkType(netInfo)\n    }\n  }\n\n  client.on('report', (ev: WebReportEvent) => {\n    return {\n      ...ev,\n      extra: {\n        ...(ev.extra || {}),\n        network_type,\n      },\n    }\n  })\n}\n","/* eslint-disable @typescript-eslint/prefer-for-of */\n/* eslint-disable @typescript-eslint/prefer-nullish-coalescing */\nimport {\n  arrayIncludes,\n  isHitBySampleRate,\n  isHitByRandom,\n  isBoolean,\n  isNumber,\n  safeVisit,\n  log,\n  id,\n} from '@slardar/sdk-template'\n\nimport { WebReport, WebClient, SampleConfig, EventSampleRule, ConditionalSampleRule, Filter } from '../types'\nimport { reportSelfError } from '../utils'\n\ninterface HitBySampleRateFn {\n  (sampleRate: number): boolean\n}\ninterface HitByRandomFn {\n  (random: number, sampleRate: number): boolean\n}\n\ntype EventHitRule = Omit<EventSampleRule, 'name' | 'conditional_sample_rules'> & {\n  hit: () => boolean\n  effectiveSampleRate: number\n  conditional_hit_rules?: ConditionalHitRule[]\n}\n\ntype ConditionalHitRule = ConditionalSampleRule & {\n  hit: () => boolean\n  effectiveSampleRate: number\n}\n\ntype SendEvent = WebReport & { common?: any }\n\nconst withSampleRate = (ev: SendEvent, sampleRate: number) => {\n  const common = ev.common || {}\n  common.sample_rate = sampleRate\n  ev.common = common\n  return ev\n}\n\nconst hitFnWithRandom = (\n  preCalc: boolean,\n  sampleRate: number,\n  isHitBySampleRate: HitBySampleRateFn,\n  random: number,\n  isHitByRandom: HitByRandomFn,\n) => {\n  return preCalc\n    ? (\n        (h) => () =>\n          h\n      )(isHitByRandom(random, sampleRate))\n    : () => isHitBySampleRate(sampleRate)\n}\n\nexport const parseValues = (values: string[], type: string) => {\n  return values.map((v) => {\n    switch (type) {\n      case 'number':\n        return Number(v)\n      case 'boolean':\n        return v === '1'\n      case 'string': // default to string\n      default:\n        return String(v)\n    }\n  })\n}\n\nexport const checkVal = (val: any, values: any[], op: string): boolean => {\n  switch (op) {\n    case 'eq':\n      return arrayIncludes(values, val)\n    case 'neq':\n      return !arrayIncludes(values, val)\n    case 'gt':\n      return val > values[0]\n    case 'gte':\n      return val >= values[0]\n    case 'lt':\n      return val < values[0]\n    case 'lte':\n      return val <= values[0]\n    case 'regex':\n      return Boolean(val.match(new RegExp(values.join('|') as string)))\n    case 'not_regex':\n      return !val.match(new RegExp(values.join('|') as string))\n    default: {\n      // unknown op\n      return false\n    }\n  }\n}\n\nexport const checkFilter = (ev: SendEvent, field: string, op: string, values: string[]): boolean => {\n  const val = safeVisit(ev, field, (t, p) => {\n    return t[p]\n  })\n  if (val === undefined) {\n    return false\n  }\n  const field_type = isBoolean(val) ? 'bool' : isNumber(val) ? 'number' : 'string'\n  return checkVal(val, parseValues(values, field_type), op)\n}\n\nexport const matchFilter = (ev: SendEvent, filter: Filter): boolean => {\n  try {\n    return filter.type === 'rule'\n      ? checkFilter(ev, filter.field!, filter.op!, filter.values!)\n      : filter.type === 'and'\n      ? filter.children!.every((f) => matchFilter(ev, f))\n      : filter.children!.some((f) => matchFilter(ev, f))\n  } catch (e) {\n    reportSelfError(e)\n    return false\n  }\n}\n\nexport const getHitMap = (\n  rules: SampleConfig['rules'],\n  preCalcHit: boolean,\n  baseRate: number,\n  isHitBySampleRate: HitBySampleRateFn,\n  random: number,\n  isHitByRandom: HitByRandomFn,\n) => {\n  const hitMap = {} as Record<string, EventHitRule>\n  Object.keys(rules).forEach((name) => {\n    const { enable, sample_rate, conditional_sample_rules } = rules[name]\n    if (enable) {\n      hitMap[name] = {\n        enable,\n        sample_rate,\n        effectiveSampleRate: sample_rate * baseRate,\n        hit: hitFnWithRandom(preCalcHit, sample_rate, isHitBySampleRate, random, isHitByRandom),\n      }\n      if (conditional_sample_rules) {\n        hitMap[name].conditional_hit_rules = conditional_sample_rules.map(\n          ({ sample_rate: s, filter }) =>\n            ({\n              sample_rate: s,\n              hit: hitFnWithRandom(preCalcHit, s, isHitBySampleRate, random, isHitByRandom),\n              effectiveSampleRate: s * baseRate,\n              filter,\n            } as ConditionalHitRule),\n        )\n      }\n    } else {\n      hitMap[name] = {\n        enable,\n        hit: () => {\n          /* istanbul ignore next */\n          return false\n        },\n        sample_rate: 0,\n        effectiveSampleRate: 0,\n      }\n    }\n  })\n  return hitMap\n}\n\nexport const getSampler = (\n  userId: string,\n  config: SampleConfig | undefined,\n  isHitBySampleRate: HitBySampleRateFn,\n  isHitByRandom: HitByRandomFn,\n): ((ev: SendEvent) => SendEvent | false) => {\n  if (!config) return id\n  // r的设计是为了允许外部传入随机数，用于彻底实现按用户采样\n  const { sample_rate: baseRate, include_users, sample_granularity, rules, r: random = Math.random() } = config\n\n  // 用户名单采样\n  const userHit = arrayIncludes(include_users, userId)\n  if (userHit) {\n    return (ev: SendEvent) => withSampleRate(ev, 1)\n  }\n\n  // should pre calculate hit\n  const preCalcHit = sample_granularity === 'session'\n  const baseHit = hitFnWithRandom(preCalcHit, baseRate, isHitBySampleRate, random, isHitByRandom)\n\n  const hitMap = getHitMap(rules, preCalcHit, baseRate, isHitBySampleRate, random, isHitByRandom)\n\n  return (ev: SendEvent) => {\n    log('[sample]', ev)\n    // 总采样必须命中才有后续\n    if (!baseHit()) {\n      log('[sample] base miss')\n      return false\n    }\n\n    // 未配置的事件类型\n    if (!(ev.ev_type in hitMap)) {\n      log('[sample] base hit')\n      return withSampleRate(ev, baseRate)\n    }\n\n    // 忽略未开启的事件类型\n    if (!hitMap[ev.ev_type].enable) {\n      log('[sample] ev_type disabled', ev.ev_type)\n      return false\n    }\n\n    // 跳过采样配置\n    if (ev.common?.sample_rate) {\n      log('[sample] skip')\n      return ev\n    }\n\n    const hitConfig = hitMap[ev.ev_type]\n    const conditions = hitConfig.conditional_hit_rules\n    if (conditions) {\n      // 先判断条件采样\n      for (let i = 0; i < conditions.length; i++) {\n        if (matchFilter(ev, conditions[i].filter)) {\n          log('[sample] filter matched')\n          if (conditions[i].hit()) {\n            log('[sample] filter hit')\n            return withSampleRate(ev, conditions[i].effectiveSampleRate)\n          }\n          log('[sample] filter miss')\n          // 条件匹配后不再搜索\n          return false\n        }\n      }\n    }\n\n    // 事件类型采样\n    if (!hitConfig.hit()) {\n      log('[sample] ev_type miss')\n      return false\n    }\n\n    log('[sample] ev_type hit')\n    // 事件类型默认采样已经命中\n    return withSampleRate(ev, hitConfig.effectiveSampleRate)\n  }\n}\n\nexport const SamplePlugin = <C extends WebClient>(client: C) => {\n  client.on('start', () => {\n    const { userId, sample } = client.config()!\n    if (sample && sample.sample_rate === 0) {\n      client.destroy()\n    }\n    const sampler = getSampler(userId, sample, isHitBySampleRate, isHitByRandom)\n    client.on('build', sampler)\n  })\n}\n","/* eslint-disable @typescript-eslint/prefer-optional-chain */\nimport { noop } from '@slardar/sdk-template'\n\nimport { getDefaultBrowser } from '../utils'\n\nexport const getBeaconTransport = () => {\n  const window = getDefaultBrowser()\n  // eslint-disable-next-line compat/compat\n  return window && window.navigator.sendBeacon\n    ? {\n        get() {},\n        post(url: string, data: string) {\n          // eslint-disable-next-line compat/compat\n          window.navigator.sendBeacon(url, data)\n        },\n      }\n    : {\n        get: noop,\n        post: noop,\n      }\n}\n","import { noop } from '@slardar/sdk-template'\n\nimport { getDefaultXMLHttpRequest } from '../utils'\n\nexport type SuccessCallback<T> = (res: T) => void\nexport type FailureCallback = (err: Error) => void\n\nexport interface XhrGetOptions<T> {\n  url: string\n  success?: SuccessCallback<T>\n  fail?: FailureCallback\n  withCredentials?: boolean\n  getResponseText?: (responseText: XMLHttpRequest['responseText']) => void\n}\nexport interface XhrPostOptions<T> {\n  url: string\n  data?: string\n  success?: SuccessCallback<T>\n  fail?: FailureCallback\n}\n\ninterface XhrTransportOptions<T> {\n  url: string\n  data?: string\n  success?: SuccessCallback<T>\n  fail?: FailureCallback\n  getResponseText?: (responseText: XMLHttpRequest['responseText']) => void\n  withCredentials?: boolean\n}\nconst request = <T>(\n  method: 'GET' | 'POST',\n  options: XhrTransportOptions<T>,\n  XMLHttpRequest: typeof window['XMLHttpRequest'],\n) => {\n  const { url, data, success = noop, fail = noop, getResponseText = noop, withCredentials = false } = options\n\n  const xhr = new XMLHttpRequest()\n  xhr.withCredentials = withCredentials\n  xhr.open(method, url, true)\n  xhr.setRequestHeader('Content-Type', 'application/json')\n  xhr.onload = function () {\n    getResponseText?.(this.responseText)\n    try {\n      if (this.responseText) {\n        const result = JSON.parse(this.responseText)\n        success(result)\n      } else {\n        success({} as T)\n      }\n    } catch (e) {\n      fail(e)\n    }\n  }\n  xhr.onerror = function () {\n    fail(new Error('Network request failed'))\n  }\n  xhr.onabort = function () {\n    /* istanbul ignore next */\n    fail(new Error('Network request aborted'))\n  }\n  xhr.send(data)\n}\n\nexport const getXhrTransport = () => {\n  const XMLHttpRequest = getDefaultXMLHttpRequest()\n  return XMLHttpRequest\n    ? {\n        get(options: XhrGetOptions<any>) {\n          request('GET', options, XMLHttpRequest)\n        },\n        post(options: XhrPostOptions<any>) {\n          request('POST', options, XMLHttpRequest)\n        },\n      }\n    : {\n        get: noop,\n        post: noop,\n      }\n}\n","import { createBatchSender, BatchSender, BatchSenderConfig, stringifyBatch } from '@slardar/sdk-template'\n\nimport { getBeaconTransport } from './transports'\nimport { WebSendEvent } from './types'\nimport { onPageUnload } from './utils'\n\n// istanbul ignore not working for export { ... } from statements\n// https://github.com/istanbuljs/nyc/issues/1209\n/* istanbul ignore next */\nexport { createBatchSender, BatchSender, BatchSenderConfig } from '@slardar/sdk-template'\n\nexport type BrowserSender = BatchSender<WebSendEvent>\n\n// createSender has side effects(register onClose behaviour)\n// so it must be create lazily\nexport function createBrowserSender(config: BatchSenderConfig): BrowserSender {\n  const sender = createBatchSender<WebSendEvent>(config)\n  const beaconTransport = getBeaconTransport()\n\n  const sendOnClose = (data: WebSendEvent) => {\n    beaconTransport.post(sender.getEndpoint(), stringifyBatch([data]))\n  }\n\n  onPageUnload(() => {\n    const data = sender.getBatchData()\n    if (data) {\n      beaconTransport.post(sender.getEndpoint(), data)\n      sender.clear()\n    }\n    sender.send = sendOnClose\n  })\n\n  return sender\n}\n"],"names":["__assign","__read","applyPerformanceObserver","getEventParams","defaultConfig","JS_ERROR_EV_TYPE","RESOURCE_EV_TYPE","getSPA","now","absoluteNow","DEFAULT_IGNORE_TAGS"],"mappings":"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"}