import ava from 'ava';
import * as Sinon from 'sinon';
import { getDataFromEvent } from '../resource-error/util';
var browserEnv = require('browser-env');
var test = ava;
test.before(function () {
    browserEnv();
});
test.beforeEach(function (t) {
    t.context.map = {};
    Sinon.restore();
    Sinon.stub(window, 'addEventListener').callsFake(function (event, cb) {
        t.context.map[event] = cb;
    });
});
test.afterEach(function () {
    Sinon.restore();
});
test('getDataFromEvent', function (t) {
    t.deepEqual(getDataFromEvent({}), undefined);
    t.deepEqual(getDataFromEvent({ target: {} }), undefined);
    t.deepEqual(getDataFromEvent({
        target: { href: 'https://www.toutiao.com/1.js', tagName: 'script' },
    }), {
        tagName: 'script',
        url: '',
    });
    t.deepEqual(getDataFromEvent({
        target: { href: 'https://www.toutiao.com/main.css', tagName: 'LINK' },
    }), {
        tagName: 'LINK',
        url: 'https://www.toutiao.com/main.css',
    });
    t.deepEqual(getDataFromEvent({
        target: { src: 'https://www.toutiao.com/main.css', tagName: 'LINK' },
    }), {
        tagName: 'LINK',
        url: '',
    });
    t.deepEqual(getDataFromEvent({
        target: {
            tagName: 'LINK',
            getAttribute: function (attr) {
                if (attr === 'href') {
                    return '/main.css';
                }
            },
        },
    }), {
        tagName: 'LINK',
        url: '/main.css',
    });
    t.deepEqual(getDataFromEvent({
        target: {
            tagName: 'LINK',
            getAttribute: function (attr) {
                if (attr === 'href') {
                    return 'https://www.toutiao.com/main.css';
                }
            },
        },
    }), {
        tagName: 'LINK',
        url: 'https://www.toutiao.com/main.css',
    });
    t.deepEqual(getDataFromEvent({
        target: {
            tagName: 'LINK',
            getAttribute: function (attr) {
                if (attr === 'href') {
                    return location.href;
                }
            },
        },
    }), {
        tagName: 'LINK',
        url: 'about:blank',
    });
});
//# sourceMappingURL=resource-error.spec.js.map