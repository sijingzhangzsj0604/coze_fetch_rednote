import test from 'ava';
import { createTestWebClient } from '../../../utils/__test__/util';
import { BreadcrumbMonitorPlugin } from '../breadcrumb';
var browserEnv = require('browser-env');
test.before(function () {
    browserEnv();
});
test('BreadcrumbMonitorPlugin - disabled', function (t) {
    var client = createTestWebClient();
    BreadcrumbMonitorPlugin(client);
    t.falsy(client.getBreadcrumbs);
    t.falsy(client.addBreadcrumb);
    client.init({});
    t.falsy(client.getBreadcrumbs);
    t.falsy(client.addBreadcrumb);
});
test('BreadcrumbMonitorPlugin', function (t) {
    var _a, _b, _c, _d, _e;
    var client = createTestWebClient();
    BreadcrumbMonitorPlugin(client);
    t.falsy(client.getBreadcrumbs);
    t.falsy(client.addBreadcrumb);
    client.init({
        plugins: {
            breadcrumb: true,
        },
    });
    t.assert(client.getBreadcrumbs);
    t.assert(client.addBreadcrumb);
    t.deepEqual((_a = client.getBreadcrumbs) === null || _a === void 0 ? void 0 : _a.call(client), []);
    (_b = client.addBreadcrumb) === null || _b === void 0 ? void 0 : _b.call(client, {
        type: 'dom',
        category: 'ui.click',
        message: 'body',
    });
    t.like((_c = client.getBreadcrumbs) === null || _c === void 0 ? void 0 : _c.call(client)[0], {
        type: 'dom',
        category: 'ui.click',
        message: 'body',
    });
    client.report({
        ev_type: 'http',
        payload: {
            api: 'fetch',
            request: {
                method: 'GET',
                url: 'http://www.toutiao.com/login?uid=jack',
                timestamp: 0,
            },
            response: {
                status: 233,
                is_custom_error: false,
                timestamp: 333,
            },
            duration: 333,
        },
    });
    t.like((_d = client.getBreadcrumbs) === null || _d === void 0 ? void 0 : _d.call(client)[0], {
        type: 'dom',
        category: 'ui.click',
        message: 'body',
    });
    t.like((_e = client.getBreadcrumbs) === null || _e === void 0 ? void 0 : _e.call(client)[1], {
        type: 'http',
        category: 'fetch',
        message: '',
        data: {
            method: 'GET',
            url: 'http://www.toutiao.com/login?uid=jack',
            status_code: '233',
        },
    });
});
//# sourceMappingURL=breadcrumb.spec.js.map