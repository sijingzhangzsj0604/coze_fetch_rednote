"use strict";var __awaiter=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(o,f){function a(e){try{r(i.next(e))}catch(e){f(e)}}function u(e){try{r(i.throw(e))}catch(e){f(e)}}function r(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,u)}r((i=i.apply(e,t||[])).next())}))},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.envSet=exports.setEnv=exports.getEnv=void 0;const defaultConfig_1=require("../default/defaultConfig"),config_json_1=__importDefault(require("./config.json"));let isInit=!1;function getEnv(){return __awaiter(this,void 0,void 0,(function*(){const e=require("ping");if(!defaultConfig_1.defaultConfig.private&&!defaultConfig_1.defaultConfig.oversea&&"inhouse"!==defaultConfig_1.defaultConfig.name&&!isInit){isInit=!0;let t="";try{const n="open.feishu-boe.cn",{alive:i}=yield e.promise.probe(n,{timeout:3});if(!i)throw new Error(n+" is dead");t="SaaS-internal"}catch(e){t="SaaS"}defaultConfig_1.defaultConfig.name=t,defaultConfig_1.defaultConfig.environments=config_json_1.default[t].environments||[],defaultConfig_1.defaultConfig.id=defaultConfig_1.defaultConfig.environments[0].id}return defaultConfig_1.defaultConfig}))}function setEnv(e){return Object.assign(defaultConfig_1.defaultConfig,e),defaultConfig_1.defaultConfig}exports.getEnv=getEnv,exports.setEnv=setEnv,exports.default=defaultConfig_1.defaultConfig,exports.envSet=Object.keys(config_json_1.default).reduce((e,t)=>((config_json_1.default[t].environments||[]).forEach(t=>{e.add(t.domain)}),e),new Set);